import{r as s,j as e,b as Qe,R as Ye}from"./react-vendor-COVWjgAu.js";import{C as ce,D as je,B as De,U as ee,L as Me,X as se,a as We,b as Ve,F as te,P as Ie,c as Ze,R as et,W as Oe,d as Be,S as tt,T as st,e as at,A as ie,f as xe,g as de,h as Ke,i as Ae,j as ae,k as $e,l as ue,m as be,E as Ge,n as he,o as Re,p as Fe,q as qe,r as lt,s as rt,t as nt,u as it,v as fe,w as dt,x as ot,y as Ne,z as Pe,M as Ce,G as ct,H as xt,I as mt,J as Ue}from"./lucide-vendor-CszYYT_a.js";import{R as ut,B as bt,C as ht,X as pt,Y as gt,T as jt,a as ft,b as Nt}from"./vendor-DHdvcyt0.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))x(d);new MutationObserver(d=>{for(const r of d)if(r.type==="childList")for(const N of r.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&x(N)}).observe(document,{childList:!0,subtree:!0});function o(d){const r={};return d.integrity&&(r.integrity=d.integrity),d.referrerPolicy&&(r.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?r.credentials="include":d.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function x(d){if(d.ep)return;d.ep=!0;const r=o(d);fetch(d.href,r)}})();const M=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),le=a=>{if(!a)return"-";const h=a.split("-");if(h.length===3){const x=h[0],d=parseInt(h[1])-1,r=h[2],N=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(N[d])return`${r} ${N[d]} ${x}`}const o={day:"numeric",month:"long",year:"numeric"};return new Date(a).toLocaleDateString("id-ID",o)},Je=()=>{const a={weekday:"long",day:"numeric",month:"long",year:"numeric"};return new Date().toLocaleDateString("id-ID",a)},ke=()=>Math.random().toString(36).substr(2,9),q="",kt=({user:a,onLogoutClick:h,toggleSidebar:o,isDbConnected:x,onProfileClick:d})=>{var S;const[r,N]=s.useState(0);s.useEffect(()=>{(a==null?void 0:a.role)==="admin"&&w()},[a]);const w=async()=>{try{const T=await fetch(`${q}/api/notifications`,{headers:{Authorization:`Bearer ${localStorage.getItem("rdr_token")}`}});if(T.ok){const P=await T.json();N(P.count)}}catch{console.error("Failed to fetch admin notifications")}};return e.jsxs("header",{className:"h-16 bg-white border-b border-slate-200 fixed top-0 left-0 right-0 z-40 px-4 md:px-6 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"md:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"RDR Finance",className:"h-10 w-auto object-contain"}),e.jsxs("span",{className:"font-bold text-lg text-slate-800 tracking-tight hidden md:block",children:["KEUANGAN ",e.jsx("span",{className:"text-blue-600",children:"RDR"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-xs font-medium text-slate-500 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100",children:[e.jsx(ce,{size:14,className:"text-slate-400"}),Je()]}),e.jsxs("div",{className:`hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium ${x?"bg-emerald-50 border-emerald-100 text-emerald-700":"bg-rose-50 border-rose-100 text-rose-700"}`,title:x?"Database Terhubung":"Database Terputus",children:[e.jsx(je,{size:14}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${x?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),x?"DB Online":"DB Offline"]})]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"relative p-2 text-slate-500 hover:bg-slate-100 rounded-lg cursor-pointer",children:[e.jsx(De,{size:20}),r>0&&e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"})]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-3 px-3 py-1.5 rounded-full bg-slate-50 border border-slate-100 hover:bg-blue-50 hover:border-blue-100 transition-colors cursor-pointer group",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors overflow-hidden",children:a!=null&&a.photo_url?e.jsx("img",{src:`${q}${a.photo_url}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(ee,{size:16})}),e.jsxs("div",{className:"hidden md:block pr-2 text-left",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700 group-hover:text-blue-700 transition-colors",children:(a==null?void 0:a.role)==="employee"?(S=a.details)==null?void 0:S.name:(a==null?void 0:a.full_name)||(a==null?void 0:a.username)||"Admin"}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase leading-none group-hover:text-blue-500 transition-colors",children:(a==null?void 0:a.role)||"User"})]})]}),e.jsx("button",{onClick:h,className:"p-2 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Keluar Sistem",children:e.jsx(Me,{size:20})})]})]})},vt=()=>e.jsx("footer",{className:"bg-white border-t border-slate-200 py-4 px-6 text-center md:text-left",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center text-sm text-slate-500",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",e.jsx("span",{className:"font-semibold text-slate-700",children:"RDR Finance"}),". All rights reserved."]}),e.jsx("p",{className:"mt-1 md:mt-0",children:"Build in Garuda Cyber"})]})}),wt=({activePage:a,setActivePage:h,isOpen:o,setIsOpen:x})=>{const d=[{title:"Menu Utama",items:[{id:"DASHBOARD",label:"Dashboard",icon:We},{id:"JOURNAL_LIST",label:"Semua Jurnal",icon:Ve},{id:"REPORT",label:"Laporan Umum",icon:te}]},{title:"Pengeluaran",items:[{id:"STAT_EXPENSE",label:"Dashboard Cash Out",icon:Ie},{id:"ADD_EXPENSE",label:"Tambah Pengeluaran",icon:Ze},{id:"REIMBURSE",label:"Tambah Reimburse",icon:et},{id:"REPORT_EXPENSE",label:"Laporan Pengeluaran",icon:te}]},{title:"Pemasukan",items:[{id:"ADD_INCOME",label:"Tambah Pemasukan",icon:Oe},{id:"STAT_INCOME",label:"Statistik Pemasukan",icon:Ie}]},{title:"Lainnya",items:[{id:"EMPLOYEES",label:"Data Pegawai",icon:Be},{id:"SETTINGS",label:"Pengaturan",icon:tt}]}];return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden",onClick:()=>x(!1)}),e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-slate-200 text-slate-700 transform transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:inset-0 ${o?"translate-x-0":"-translate-x-full"} flex flex-col pt-0`,children:[e.jsx("div",{className:"flex md:hidden items-center justify-end p-4 border-b border-slate-100",children:e.jsx("button",{onClick:()=>x(!1),className:"text-slate-500 hover:text-slate-800",children:e.jsx(se,{size:24})})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-6 px-4 space-y-6",children:d.map((r,N)=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3 px-2",children:r.title}),e.jsx("div",{className:"space-y-1",children:r.items.map(w=>{const S=w.icon,T=a===w.id;return e.jsxs("button",{onClick:()=>{h(w.id),x(!1)},className:`w-full flex items-center gap-3 px-4 py-2.5 rounded-lg transition-all duration-200 text-sm ${T?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-600 hover:bg-blue-50 hover:text-blue-600"}`,children:[e.jsx(S,{size:18}),e.jsx("span",{className:"font-medium",children:w.label})]},w.id)})})]},N))}),e.jsx("div",{className:"p-4 text-xs text-center text-slate-400 border-t border-slate-100",children:"v1.0.0 Stable"})]})]})},ge=({transactions:a,reimbursements:h,isDarkMode:o,filterType:x="ALL"})=>{const[d,r]=s.useState(null),[N,w]=s.useState(null),S=s.useMemo(()=>{const n=a.filter(C=>C.type==="PEMASUKAN").reduce((C,L)=>C+L.grandTotal,0),b=a.filter(C=>C.type==="PENGELUARAN").reduce((C,L)=>C+L.grandTotal,0),j=h.filter(C=>C.status==="PENDING").reduce((C,L)=>C+L.grandTotal,0),$=n-b;return{totalIncome:n,totalExpense:b,totalReimbursePending:j,balance:$}},[a,h]),T=s.useMemo(()=>{let n=a;x==="INCOME"?n=a.filter(j=>j.type==="PEMASUKAN"):x==="EXPENSE"&&(n=a.filter(j=>j.type==="PENGELUARAN"));const b={};return n.forEach(j=>{b[j.category]||(b[j.category]=0),b[j.category]+=j.grandTotal}),Object.keys(b).map(j=>({name:j,value:b[j]})).slice(0,5)},[a,x]),P=()=>x==="INCOME"?"Statistik Pemasukan":x==="EXPENSE"?"Statistik Pengeluaran":"Dashboard Ringkasan",k=()=>x==="INCOME"?"Pemasukan per Kategori":x==="EXPENSE"?"Pengeluaran per Kategori":"Transaksi per Kategori";return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:P()}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(x==="ALL"||x==="INCOME")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pemasukan"}),e.jsx("h3",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:M(S.totalIncome)})]}),e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400",children:e.jsx(st,{size:24})})]})}),(x==="ALL"||x==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pengeluaran"}),e.jsx("h3",{className:"text-2xl font-bold text-rose-600 dark:text-rose-400",children:M(S.totalExpense)})]}),e.jsx("div",{className:"p-2 bg-rose-100 dark:bg-rose-900/30 rounded-lg text-rose-600 dark:text-rose-400",children:e.jsx(at,{size:24})})]})}),(x==="ALL"||x==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Reimburse (Pending)"}),e.jsx("h3",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:M(S.totalReimbursePending)})]}),e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-400",children:e.jsx(ie,{size:24})})]})}),x==="ALL"&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Saldo Akhir"}),e.jsx("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:M(S.balance)})]}),e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(Oe,{size:24})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"Transaksi Terakhir"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:[e.jsx("th",{className:"pb-3 px-3",children:"Tanggal"}),e.jsx("th",{className:"pb-3 px-3",children:"Kategori"}),e.jsx("th",{className:"pb-3 px-3 text-right",children:"Nominal"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[a.filter(n=>x==="ALL"||x==="INCOME"&&n.type==="PEMASUKAN"||x==="EXPENSE"&&n.type==="PENGELUARAN").slice(0,5).map(n=>e.jsxs("tr",{onClick:()=>r(n),className:"text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"py-3 px-3 text-slate-600 dark:text-slate-300",children:le(n.date)}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${n.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:n.category})}),e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${n.type==="PEMASUKAN"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:[n.type==="PEMASUKAN"?"+":"-"," ",M(n.grandTotal)]})]},n.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data transaksi"})})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:k()}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(ut,{width:"100%",height:"100%",children:e.jsxs(bt,{data:T,children:[e.jsx(ht,{strokeDasharray:"3 3",vertical:!1,stroke:o?"#334155":"#e2e8f0"}),e.jsx(pt,{dataKey:"name",fontSize:12,tickLine:!1,axisLine:!1,tick:{fill:o?"#94a3b8":"#64748b"}}),e.jsx(gt,{fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:n=>`${n/1e3}k`,tick:{fill:o?"#94a3b8":"#64748b"}}),e.jsx(jt,{formatter:n=>M(n),cursor:{fill:o?"#334155":"#f8fafc"},contentStyle:{backgroundColor:o?"#1e293b":"#fff",borderColor:o?"#334155":"#e2e8f0",color:o?"#f1f5f9":"#1e293b"},itemStyle:{color:o?"#e2e8f0":"#1e293b"}}),e.jsx(ft,{dataKey:"value",fill:x==="INCOME"?"#10b981":x==="EXPENSE"?"#f43f5e":"#3b82f6",radius:[4,4,0,0],children:T.map((n,b)=>e.jsx(Nt,{fill:x==="INCOME"?b%2===0?"#10b981":"#34d399":x==="EXPENSE"?b%2===0?"#f43f5e":"#fb7185":b%2===0?"#3b82f6":"#60a5fa"},`cell-${b}`))})]})})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",d.id]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),r(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(se,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${d.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[d.type==="PEMASUKAN"?e.jsx(xe,{size:24}):e.jsx(de,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[d.type," ",d.expenseType?`(${d.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:M(d.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ce,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:le(d.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(de,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:d.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:d.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:d.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(te,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:d.items.map((n,b)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:n.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:n.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:M(n.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:M(n.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:n.filePreviewUrl?e.jsxs("button",{onClick:()=>w(n.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(Ke,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},b))})]})})]})]})]})}),N&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>w(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>w(null),children:e.jsx(se,{size:32})}),e.jsxs("div",{className:"relative",onClick:n=>n.stopPropagation(),children:[e.jsx("img",{src:N,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:n=>{var j;const b=n.target;b.onerror=null,b.style.display="none",(j=b.nextElementSibling)==null||j.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ie,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},Ee=({onAddTransaction:a,onUpdateTransaction:h,onDeleteTransaction:o,transactions:x,defaultType:d="PENGELUARAN",filterType:r,initialView:N="LIST",categories:w,authToken:S})=>{const[T,P]=s.useState(N),[k,n]=s.useState(!1),[b,j]=s.useState(null),[$,C]=s.useState(null),[L,E]=s.useState(new Date().toISOString().split("T")[0]),[z,y]=s.useState(d),[O,i]=s.useState("NORMAL"),[c,B]=s.useState(""),[F,G]=s.useState(""),[I,J]=s.useState(""),[f,A]=s.useState([]),[K,W]=s.useState(null),[Z,g]=s.useState(null);s.useEffect(()=>{P(N),y(d),d==="PENGELUARAN"&&i("NORMAL")},[N,d]);const V=s.useMemo(()=>r?x.filter(l=>l.type===r):x,[x,r]),Q=()=>{const l=ke();A([...f,{id:l,name:"",qty:1,price:0,total:0}]),W(l)},m=l=>{A(f.filter(p=>p.id!==l)),K===l&&W(null)},v=l=>{const p=f.find(U=>U.id===l);if(p){if(!p.name.trim()||p.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}W(null)}},D=(l,p,U)=>{A(f.map(Y=>{if(Y.id===l){const t={...Y,[p]:U};return(p==="qty"||p==="price")&&(t.total=Number(t.qty)*Number(t.price)),t}return Y}))},H=(l,p)=>{A(f.map(U=>{if(U.id===l){const Y=p?URL.createObjectURL(p):void 0;return{...U,file:p,filePreviewUrl:Y}}return U}))},_=()=>f.reduce((l,p)=>l+p.total,0),me=async l=>{if(!S)return alert("Sesi habis. Silakan login ulang."),"";const p=new FormData;p.append("file",l);try{const Y=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${S}`},body:p})).json();if(Y.status==="success")return Y.url;throw new Error(Y.message||"Upload gagal")}catch(U){return console.error("Upload Error:",U),""}},ve=async l=>{if(l.preventDefault(),K){const p=f.find(U=>U.id===K);if(p&&(!p.name.trim()||p.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(!c||!F||f.length===0){alert("Mohon lengkapi data wajib dan minimal 1 item.");return}n(!0);try{const p=await Promise.all(f.map(async Y=>{let t=Y.filePreviewUrl;if(Y.file){const X=await me(Y.file);X&&(t=X)}const{file:u,...R}=Y;return{...R,filePreviewUrl:t}})),U={id:$||ke(),date:L,type:z,expenseType:z==="PENGELUARAN"?O:void 0,category:c,activityName:F,description:I,items:p,grandTotal:_(),timestamp:Date.now()};$?(h(U),alert("Transaksi berhasil diperbarui")):a(U),P("LIST"),re()}catch(p){console.error("Gagal menyimpan transaksi:",p),alert("Terjadi kesalahan saat menyimpan transaksi.")}finally{n(!1)}},re=()=>{E(new Date().toISOString().split("T")[0]),B(""),G(""),J(""),A([]),W(null),C(null)},pe=(l,p)=>{l.stopPropagation(),C(p.id),E(p.date),y(p.type),i(p.expenseType||"NORMAL"),B(p.category),G(p.activityName),J(p.description),A(p.items.map(U=>({...U}))),P("FORM")},we=(l,p)=>{l.stopPropagation(),window.confirm("Apakah Anda yakin ingin menghapus transaksi ini? Data yang dihapus tidak dapat dikembalikan.")&&o(p)},oe=()=>T==="FORM"?$?"Edit Transaksi":z==="PEMASUKAN"?"Tambah Pemasukan":"Tambah Pengeluaran":r==="PENGELUARAN"?"Data Pengeluaran":r==="PEMASUKAN"?"Data Pemasukan":"Daftar Jurnal Transaksi",ye=()=>r==="PENGELUARAN"?"+ Tambah Pengeluaran":r==="PEMASUKAN"?"+ Tambah Pemasukan":"+ Tambah Transaksi",Se=!!r;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:oe()}),T==="LIST"?e.jsx("button",{onClick:()=>{re(),P("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:ye()}):e.jsx("button",{onClick:()=>{re(),P("LIST")},className:"bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),T==="FORM"?e.jsxs("form",{onSubmit:ve,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal"}),e.jsx("input",{type:"date",required:!0,value:L,onChange:l=>E(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"})]}),(!Se||$)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Transaksi"}),e.jsxs("select",{value:z,onChange:l=>y(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"})]})]}),z==="PENGELUARAN"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Pengeluaran"}),e.jsxs("select",{value:O,onChange:l=>i(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"NORMAL",children:"Normal"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori Kegiatan"}),e.jsxs("select",{required:!0,value:c,onChange:l=>B(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),w.map((l,p)=>e.jsx("option",{value:l,children:l},p))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,placeholder:"Contoh: Pembelian ATK Bulanan",value:F,onChange:l=>G(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan Tambahan"}),e.jsx("textarea",{rows:2,value:I,onChange:l=>J(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item"}),e.jsx("button",{type:"button",onClick:Q,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsxs("div",{className:"space-y-4",children:[f.map(l=>{const p=K===l.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center relative transition-colors ${p?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Nama Item"}),e.jsx("input",{type:"text",placeholder:"Nama barang/jasa",value:l.name,onChange:U=>D(l.id,"name",U.target.value),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:l.qty,onChange:U=>D(l.id,"qty",parseInt(U.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga Satuan"}),e.jsx("input",{type:"number",min:"0",value:l.price,onChange:U=>D(l.id,"price",parseInt(U.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-between items-end",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 rounded border border-slate-200 dark:border-slate-600 text-sm font-medium text-slate-700 dark:text-slate-200",children:M(l.total)})]})}),e.jsxs("div",{className:"md:col-span-12 flex items-center justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(Ae,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:U=>H(l.id,U.target.files?U.target.files[0]:null)})]}),l.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:l.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m(l.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ae,{size:16})}),e.jsx("button",{type:"button",onClick:()=>v(l.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx($e,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:l.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:l.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:M(l.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:M(l.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[l.filePreviewUrl&&e.jsx("button",{type:"button",onClick:U=>{U.preventDefault(),U.stopPropagation(),g(l.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(te,{size:16})}),e.jsx("button",{type:"button",onClick:()=>W(l.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(ue,{size:16})}),e.jsx("button",{type:"button",onClick:()=>m(l.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ae,{size:16})})]})]})]})},l.id)}),f.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 dark:text-slate-500 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-lg",children:"Belum ada item ditambahkan"})]}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:M(_())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",disabled:k,onClick:()=>{re(),P("LIST")},className:"px-6 py-2.5 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:k,className:"px-6 py-2.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium shadow-sm shadow-blue-200 dark:shadow-none transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:k?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," ",$?"Update Transaksi":"Simpan Transaksi"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),!r&&e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:V.length>0?V.sort((l,p)=>p.timestamp-l.timestamp).map(l=>e.jsxs("tr",{onClick:()=>j(l),className:"hover:bg-blue-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer even:bg-slate-50 dark:even:bg-slate-800",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:le(l.date)}),!r&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:l.type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:l.category}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"font-medium",children:l.activityName}),e.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[200px]",children:l.description})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[l.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-800 dark:text-slate-200 text-right",children:M(l.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:p=>pe(p,l),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded transition-colors",title:"Edit",children:e.jsx(ue,{size:16})}),e.jsx("button",{onClick:p=>we(p,l.id),className:"p-1.5 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Hapus",children:e.jsx(ae,{size:16})})]})})]},l.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:r?6:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:["Belum ada data ",r?r.toLowerCase():"jurnal"]})})})]})})}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",b.id]})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),j(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(se,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${b.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[b.type==="PEMASUKAN"?e.jsx(xe,{size:24}):e.jsx(de,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[b.type," ",b.expenseType?`(${b.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:M(b.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ce,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:le(b.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(de,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:b.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:b.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:b.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(te,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:b.items.map((l,p)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:l.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:l.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:M(l.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:M(l.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:l.filePreviewUrl?e.jsxs("button",{onClick:()=>g(l.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(Ke,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},p))})]})})]})]})]})})]}),Z&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>g(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>g(null),children:e.jsx(se,{size:32})}),e.jsxs("div",{className:"relative",onClick:l=>l.stopPropagation(),children:[e.jsx("img",{src:Z,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:l=>{var U;const p=l.target;p.onerror=null,p.style.display="none",(U=p.nextElementSibling)==null||U.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ie,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},He=({reimbursements:a,onAddReimbursement:h,onUpdateReimbursement:o,onDeleteReimbursement:x,onUpdateReimbursementDetails:d,categories:r,authToken:N,isEmployeeView:w=!1,currentUser:S})=>{const[T,P]=s.useState("LIST"),[k,n]=s.useState(null),[b,j]=s.useState(!1),[$,C]=s.useState(null),[L,E]=s.useState(new Date().toISOString().split("T")[0]),[z,y]=s.useState(""),[O,i]=s.useState(""),[c,B]=s.useState(""),[F,G]=s.useState(""),[I,J]=s.useState([]),[f,A]=s.useState(null),[K,W]=s.useState(null),[Z,g]=s.useState(null),[V,Q]=s.useState(""),[m,v]=s.useState(null),D=()=>{const t=ke();J([...I,{id:t,name:"",qty:1,price:0,total:0}]),A(t)},H=t=>{J(I.filter(u=>u.id!==t)),f===t&&A(null)},_=t=>{const u=I.find(R=>R.id===t);if(u){if(!u.name.trim()||u.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}A(null)}},me=(t,u,R)=>{J(I.map(X=>{if(X.id===t){const ne={...X,[u]:R};return(u==="qty"||u==="price")&&(ne.total=Number(ne.qty)*Number(ne.price)),ne}return X}))},ve=(t,u)=>{J(I.map(R=>R.id===t?{...R,file:u,filePreviewUrl:u?URL.createObjectURL(u):void 0}:R))},re=()=>I.reduce((t,u)=>t+u.total,0),pe=async t=>{if(!N)return alert("Sesi habis. Silakan login ulang."),"";const u=new FormData;u.append("file",t);try{const X=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${N}`},body:u})).json();if(X.status==="success")return X.url;throw new Error(X.message||"Upload gagal")}catch(R){return console.error("Upload Error:",R),""}},we=async t=>{if(t.preventDefault(),f){const u=I.find(R=>R.id===f);if(u&&(!u.name.trim()||u.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(I.length===0)return alert("Minimal 1 item reimburse.");if(!O)return alert("Silakan pilih kategori.");j(!0);try{const u=await Promise.all(I.map(async X=>{let ne=X.filePreviewUrl;if(X.file){const Te=await pe(X.file);Te&&(ne=Te)}const{file:Tt,...Xe}=X;return{...Xe,filePreviewUrl:ne}})),R={id:$||ke(),date:L,requestorName:z,category:O,activityName:c,description:F,items:u,grandTotal:re(),status:"PENDING",timestamp:Date.now()};$?(d(R),alert("Data reimburse berhasil diperbarui")):h(R),P("LIST"),oe()}catch(u){console.error("Gagal menyimpan reimburse:",u),alert("Terjadi kesalahan.")}finally{j(!1)}},oe=()=>{var t;if(n(null),C(null),E(new Date().toISOString().split("T")[0]),w&&S){const u=((t=S.details)==null?void 0:t.name)||S.full_name||S.username||"";y(u)}else y("");i(""),B(""),G(""),J([]),A(null),j(!1)},ye=(t,u)=>{if(t.stopPropagation(),u.status!=="PENDING"&&u.status!=="DITOLAK"){alert("Hanya pengajuan berstatus PENDING atau DITOLAK yang dapat diedit.");return}C(u.id),E(u.date),y(u.requestorName),i(u.category),B(u.activityName),G(u.description),J(u.items.map(R=>({...R}))),P("FORM")},Se=(t,u)=>{if(t.stopPropagation(),u.status!=="PENDING"){alert("Hanya pengajuan berstatus PENDING yang dapat dihapus.");return}window.confirm("Yakin ingin menghapus pengajuan reimburse ini?")&&x(u.id)},l=t=>{switch(t){case"PENDING":return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";case"PROSES":return"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300";case"BERHASIL":return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300";case"DITOLAK":return"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300";default:return"bg-slate-100 text-slate-800"}},p=t=>{switch(t){case"PENDING":return e.jsx(lt,{size:14,className:"mr-1"});case"PROSES":return e.jsx(Re,{size:14,className:"mr-1 animate-spin-slow"});case"BERHASIL":return e.jsx(qe,{size:14,className:"mr-1"});case"DITOLAK":return e.jsx(Fe,{size:14,className:"mr-1"})}},U=t=>{n(t),W(t.status),g(null),Q(t.rejectionReason||"")},Y=async()=>{if(!(!k||!K)){if(K==="BERHASIL"&&!Z&&!k.transferProofUrl){alert("Wajib upload bukti transfer untuk mengubah status menjadi Berhasil.");return}if(K==="DITOLAK"&&!V.trim()){alert("Wajib mengisi alasan penolakan jika status Ditolak.");return}j(!0);try{let t=k.transferProofUrl;if(Z){const R=await pe(Z);R&&(t=R)}const u={...k,status:K,transferProofUrl:t,rejectionReason:K==="DITOLAK"?V:void 0};o(u),n(null)}catch{alert("Gagal update status")}finally{j(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Tambah Reimburse"}),T==="LIST"?e.jsxs("button",{onClick:()=>{oe(),P("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:[e.jsx(xe,{size:18})," Ajukan Reimburse"]}):e.jsx("button",{onClick:()=>{oe(),P("LIST")},className:"bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),T==="FORM"?e.jsxs("form",{onSubmit:we,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal Pengajuan"}),e.jsx("input",{type:"date",required:!0,value:L,onChange:t=>E(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Pengaju"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,placeholder:"Nama Lengkap",value:z,onChange:t=>y(t.target.value),className:`w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 pl-10 focus:ring-blue-500 outline-none transition-colors ${w?"bg-slate-100 text-slate-500 cursor-not-allowed":""}`,readOnly:w})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori"}),e.jsxs("select",{required:!0,value:O,onChange:t=>i(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),r.map((t,u)=>e.jsx("option",{value:t,children:t},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,value:c,onChange:t=>B(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan"}),e.jsx("textarea",{rows:2,value:F,onChange:t=>G(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item Reimburse"}),e.jsx("button",{type:"button",onClick:D,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsx("div",{className:"space-y-4",children:I.map(t=>{const u=f===t.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center transition-colors ${u?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Keterangan Barang/Jasa"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:R=>me(t.id,"name",R.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",required:!0,min:"1",value:t.qty,onChange:R=>me(t.id,"qty",parseInt(R.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga"}),e.jsx("input",{type:"number",required:!0,min:"0",value:t.price,onChange:R=>me(t.id,"price",parseInt(R.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-200 rounded text-sm font-medium",children:M(t.total)})]}),e.jsxs("div",{className:"md:col-span-12 flex justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(Ae,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:R=>{var X;return ve(t.id,((X=R.target.files)==null?void 0:X[0])||null)}})]}),t.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:t.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>H(t.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ae,{size:16})}),e.jsx("button",{type:"button",onClick:()=>_(t.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx($e,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:t.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:t.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:M(t.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:M(t.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[t.filePreviewUrl&&e.jsx("button",{type:"button",onClick:R=>{R.preventDefault(),R.stopPropagation(),v(t.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(te,{size:16})}),e.jsx("button",{type:"button",onClick:()=>A(t.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(ue,{size:16})}),e.jsx("button",{type:"button",onClick:()=>H(t.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ae,{size:16})})]})]})]})},t.id)})}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total Reimburse"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:M(re())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",disabled:b,onClick:()=>{oe(),P("LIST")},className:"px-6 py-2.5 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm shadow-blue-200 dark:shadow-none transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:b?"Memproses...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," ",$?"Update Pengajuan":"Simpan Pengajuan"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px] md:min-w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Pengaju"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:a.length>0?a.sort((t,u)=>u.timestamp-t.timestamp).map(t=>e.jsxs("tr",{onClick:()=>U(t),className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:le(t.date)}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-700 dark:text-slate-300",children:t.requestorName}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:[e.jsx("div",{children:t.activityName}),e.jsx("div",{className:"text-xs text-slate-400",children:t.category})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[t.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-slate-800 dark:text-slate-200",children:M(t.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${l(t.status)}`,children:[p(t.status)," ",t.status]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),U(t)},className:"text-blue-500 hover:text-blue-700 dark:hover:text-blue-400 p-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg transition-colors",title:"Lihat Detail",children:e.jsx(Ge,{size:18})}),(t.status==="PENDING"||t.status==="DITOLAK")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u=>ye(u,t),className:"text-slate-500 hover:text-blue-600 p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Edit",children:e.jsx(ue,{size:18})}),!w&&e.jsx("button",{onClick:u=>Se(u,t),className:"text-slate-500 hover:text-rose-600 p-1 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Hapus",children:e.jsx(ae,{size:18})})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data reimburse"})})})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:["Detail Reimburse",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold border ${l(k.status)}`,children:k.status})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",k.id]})]}),e.jsx("button",{onClick:()=>n(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(se,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[k.status==="DITOLAK"&&k.rejectionReason&&e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-200 dark:border-rose-800 flex gap-3",children:[e.jsx(ie,{className:"text-rose-600 dark:text-rose-400 shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-rose-700 dark:text-rose-300",children:"Pengajuan Ditolak"}),e.jsx("p",{className:"text-sm text-rose-600 dark:text-rose-400 mt-1",children:k.rejectionReason})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-700/30 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Pengaju"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:k.requestorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Tanggal"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:le(k.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:k.activityName}),e.jsx("p",{className:"text-xs text-slate-500",children:k.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Keterangan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:k.description||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-white mb-3",children:"Item Pengajuan"}),e.jsx("div",{className:"border rounded-lg border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800",children:k.items.map((t,u)=>e.jsxs("tr",{className:"even:bg-slate-50 dark:even:bg-slate-700",children:[e.jsx("td",{className:"px-4 py-2 text-slate-700 dark:text-slate-300",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-600 dark:text-slate-400",children:t.qty}),e.jsx("td",{className:"px-4 py-2 text-right text-slate-600 dark:text-slate-400",children:M(t.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium text-slate-800 dark:text-slate-200",children:M(t.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:t.filePreviewUrl?e.jsx("button",{onClick:()=>v(t.filePreviewUrl||null),className:"text-blue-500 hover:underline flex justify-center",children:e.jsx(te,{size:16})}):"-"})]},u))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700/50 font-bold text-slate-800 dark:text-white border-t border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Grand Total"}),e.jsx("td",{className:"px-4 py-3 text-right",children:M(k.grandTotal)}),e.jsx("td",{})]})})]})})]}),!w&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-5 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{size:18})," Aksi Admin"]}),k.status==="BERHASIL"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 dark:text-emerald-400 font-medium p-3 bg-emerald-50 dark:bg-emerald-900/30 rounded-lg border border-emerald-200 dark:border-emerald-800",children:[e.jsx(he,{size:18})," Status Final: BERHASIL"]}),e.jsx("p",{className:"text-xs text-slate-500 ml-1",children:"Data yang sudah berhasil tidak dapat diubah kembali."}),k.transferProofUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Bukti Transfer:"}),e.jsxs("button",{onClick:()=>v(k.transferProofUrl||null),className:"inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(te,{size:16})," Lihat Bukti Transfer"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:["PENDING","PROSES","BERHASIL","DITOLAK"].map(t=>e.jsx("button",{onClick:()=>W(t),className:`px-4 py-2 rounded-lg text-sm font-medium border transition-colors ${K===t?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:t},t))}),K==="BERHASIL"&&e.jsxs("div",{className:"animate-fade-in p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Upload Bukti Transfer ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm transition-colors shadow-sm font-medium",children:[e.jsx(Ae,{size:16})," Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:t=>g(t.target.files?t.target.files[0]:null)})]}),e.jsx("span",{className:"text-sm text-slate-500 truncate max-w-[200px]",children:Z?Z.name:k.transferProofUrl?"File sudah ada (ganti jika perlu)":"Belum ada file dipilih"})]})]}),K==="DITOLAK"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Alasan Penolakan ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("textarea",{value:V,onChange:t=>Q(t.target.value),placeholder:"Contoh: Bukti struk kurang jelas / Nominal tidak sesuai.",rows:3,className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-3 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("button",{onClick:Y,disabled:b,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-sm transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[b?e.jsx(Re,{size:18,className:"animate-spin"}):e.jsx(be,{size:18})," Simpan Perubahan"]})})]})]})]})]})}),m&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>v(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>v(null),children:e.jsx(se,{size:32})}),e.jsxs("div",{className:"relative",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:m,alt:"Bukti Reimburse",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:t=>{var R;const u=t.target;u.onerror=null,u.style.display="none",(R=u.nextElementSibling)==null||R.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ie,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})]})},Le=({transactions:a,reimbursements:h,fixedFilterType:o,categories:x})=>{const[d,r]=s.useState("ALL"),[N,w]=s.useState(""),[S,T]=s.useState(""),[P,k]=s.useState(""),[n,b]=s.useState(null),[j,$]=s.useState("ALL");s.useEffect(()=>{r(o||"ALL")},[o]);const C=s.useMemo(()=>{let i=[...a.map(c=>({id:c.id,date:c.date,type:c.type,subType:c.expenseType||"NORMAL",category:c.category,activity:c.activityName,total:c.grandTotal,desc:c.description,timestamp:c.timestamp,source:"JURNAL",raw:c})),...h.filter(c=>c.status==="BERHASIL").map(c=>({id:c.id,date:c.date,type:"PENGELUARAN",subType:"REIMBURSE",category:c.category,activity:c.activityName,total:c.grandTotal,desc:`Reimburse oleh: ${c.requestorName} - ${c.description}`,timestamp:c.timestamp,source:"REIMBURSE_MODULE",raw:c}))];return N&&(i=i.filter(c=>c.date>=N)),S&&(i=i.filter(c=>c.date<=S)),d!=="ALL"&&(i=i.filter(c=>c.type===d||d==="REIMBURSE"&&c.subType==="REIMBURSE")),o==="PENGELUARAN"&&j!=="ALL"&&(i=i.filter(c=>c.subType===j)),P&&(i=i.filter(c=>c.category===P)),i.sort((c,B)=>B.timestamp-c.timestamp)},[a,h,N,S,d,P,o,j]),L=s.useMemo(()=>({income:C.filter(i=>i.type==="PEMASUKAN").reduce((i,c)=>i+c.total,0),expense:C.filter(i=>i.type==="PENGELUARAN").reduce((i,c)=>i+c.total,0),reimburse:C.filter(i=>i.subType==="REIMBURSE").reduce((i,c)=>i+c.total,0)}),[C]),E=()=>{window.print()},z=()=>{const i=["Tanggal","Jenis","Sub Jenis","Kategori","Kegiatan","Deskripsi","Total"],c=C.map(I=>[I.date,I.type,I.subType,I.category,I.activity,`"${I.desc}"`,I.total]),B="data:text/csv;charset=utf-8,"+i.join(",")+`
`+c.map(I=>I.join(",")).join(`
`),F=encodeURI(B),G=document.createElement("a");G.setAttribute("href",F),G.setAttribute("download",`laporan_keuangan_${new Date().toISOString()}.csv`),document.body.appendChild(G),G.click(),document.body.removeChild(G)},y=()=>o==="PENGELUARAN"?"Laporan Pengeluaran (Cash Out)":"Laporan Keuangan",O=()=>new Date().toLocaleString("id-ID",{dateStyle:"full",timeStyle:"medium"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1.5cm; }
          body { 
            background: white; 
            color: black; 
            font-size: 12px;
          }
          /* Hide non-printable areas */
          .no-print, nav, header, footer, .sidebar, button, input, select, .summary-cards {
            display: none !important;
          }
          /* Show print specific areas */
          .print-header, .print-footer {
            display: block !important;
          }
          /* Ensure table looks good */
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          thead { background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; }
          tr.even { background-color: #f9f9f9 !important; -webkit-print-color-adjust: exact; }
          
          /* Main container adjustment */
          .main-content { margin: 0; padding: 0; overflow: visible; }
        }
        /* Default hide print areas */
        .print-header, .print-footer { display: none; }
      `}),e.jsxs("div",{className:"print-header mb-6 text-center border-b-2 border-slate-800 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold uppercase tracking-wider text-slate-900",children:"System Informasi Finance"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:"Ruang Dimensi Records"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 no-print",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:y()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors",children:[e.jsx(rt,{size:18})," Excel"]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 bg-slate-800 dark:bg-slate-700 text-white px-4 py-2 rounded-lg hover:bg-slate-900 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(nt,{size:18})," Print / PDF"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 grid grid-cols-1 md:grid-cols-4 gap-4 transition-colors no-print",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Dari Tanggal"}),e.jsx("input",{type:"date",value:N,onChange:i=>w(i.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Sampai Tanggal"}),e.jsx("input",{type:"date",value:S,onChange:i=>T(i.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),o?o==="PENGELUARAN"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Jenis"}),e.jsxs("select",{value:j,onChange:i=>$(i.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua (Cash & Reimburse)"}),e.jsx("option",{value:"NORMAL",children:"Pengeluaran (Cash/Tunai)"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse (Ganti Uang)"})]})]}):null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Jenis Laporan"}),e.jsxs("select",{value:d,onChange:i=>r(i.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua Transaksi"}),e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"}),e.jsx("option",{value:"REIMBURSE",children:"Khusus Reimburse"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Kategori"}),e.jsxs("div",{className:"relative",children:[e.jsx(it,{className:"absolute left-2.5 top-2.5 text-slate-400",size:14}),e.jsxs("select",{value:P,onChange:i=>k(i.target.value),className:"w-full p-2 pl-8 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500 appearance-none",children:[e.jsx("option",{value:"",children:"Semua Kategori"}),x.map((i,c)=>e.jsx("option",{value:i,children:i},c))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 summary-cards no-print",children:[(!o||o==="PEMASUKAN")&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg border border-emerald-100 dark:border-emerald-800",children:[e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold uppercase",children:"Total Pemasukan"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-300",children:M(L.income)})]}),(!o||o==="PENGELUARAN")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-100 dark:border-rose-800",children:[e.jsx("p",{className:"text-xs text-rose-600 dark:text-rose-400 font-semibold uppercase",children:"Total Pengeluaran (Cash)"}),e.jsx("p",{className:"text-xl font-bold text-rose-700 dark:text-rose-300",children:M(L.expense-L.reimburse)})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-100 dark:border-amber-800",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 font-semibold uppercase",children:"Total Reimburse (Cair)"}),e.jsx("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:M(L.reimburse)})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-semibold uppercase",children:"Total Cash Out"}),e.jsx("p",{className:"text-xl font-bold text-slate-700 dark:text-slate-200",children:M(L.expense)})]})]}),!o&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold uppercase",children:"Saldo Periode Ini"}),e.jsx("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:M(L.income-L.expense)})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori & Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:C.length>0?C.map((i,c)=>e.jsxs("tr",{onClick:()=>b(i),className:`hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer ${c%2===0?"even":"odd"}`,children:[e.jsx("td",{className:"px-6 py-3 text-sm text-slate-600 dark:text-slate-300 whitespace-nowrap",children:le(i.date)}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase ${i.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:i.type}),i.subType==="REIMBURSE"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border border-amber-200 dark:border-amber-800",children:"REIMBURSE"}),i.subType==="NORMAL"&&i.type==="PENGELUARAN"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600",children:"TUNAI"})]})}),e.jsxs("td",{className:"px-6 py-3 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:i.activity}),e.jsx("div",{className:"text-xs text-slate-400",children:i.category})]}),e.jsx("td",{className:"px-6 py-3 text-sm text-slate-500 dark:text-slate-400 max-w-xs truncate",children:i.desc}),e.jsx("td",{className:`px-6 py-3 text-sm font-bold text-right ${i.type==="PEMASUKAN"?"text-emerald-700 dark:text-emerald-400":"text-rose-700 dark:text-rose-400"}`,children:M(i.total)})]},i.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Tidak ada data laporan yang sesuai filter"})})})]})})}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in no-print",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",n.id]})]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),b(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(se,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${n.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[n.type==="PEMASUKAN"?e.jsx(xe,{size:24}):e.jsx(de,{size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[n.type,n.subType==="REIMBURSE"?" (REIMBURSE)":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total"}),e.jsx("p",{className:"font-bold text-lg",children:M(n.total)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ce,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:le(n.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(de,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:n.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:n.activity})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 dark:text-white bg-slate-50 dark:bg-slate-700 p-3 rounded-lg border border-slate-100 dark:border-slate-600",children:n.desc||"-"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Sumber Data"}),e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-mono bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:n.source})]})]}),n.raw&&n.raw.items&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(te,{size:16})," Items"]}),e.jsx("div",{className:"text-sm border rounded overflow-hidden dark:border-slate-600",children:n.raw.items.map((i,c)=>e.jsxs("div",{className:"flex justify-between p-2 border-b last:border-0 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50",children:[e.jsxs("span",{children:[i.name," ",e.jsxs("span",{className:"text-slate-400",children:["x",i.qty]})]}),e.jsx("span",{className:"font-medium",children:M(i.total)})]},c))})]})]})]})}),e.jsx("div",{className:"print-footer mt-10 pt-4 border-t border-slate-400 text-right text-sm text-slate-600",children:e.jsxs("p",{children:["Dicetak / Didownload Tanggal : ",O()]})})]})},yt=({settings:a,onUpdateSettings:h,authToken:o})=>{const[x,d]=s.useState("GENERAL"),[r,N]=s.useState(""),[w,S]=s.useState(a.database),[T,P]=s.useState([]),[k,n]=s.useState(""),[b,j]=s.useState(""),[$,C]=s.useState(!1),[L,E]=s.useState(!1),[z,y]=s.useState(!1),[O,i]=s.useState(null);s.useEffect(()=>{x==="USERS"&&o&&c()},[x,o]);const c=async()=>{if(o)try{const A=await(await fetch(`${q}/api/users`,{headers:{Authorization:`Bearer ${o}`}})).json();Array.isArray(A)&&P(A)}catch{console.error("Failed to fetch users")}},B=async f=>{f.preventDefault();const A=r.trim();if(!(!A||a.categories.includes(A))){if(o){E(!0);try{const W=await(await fetch(`${q}/api/categories`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({name:A})})).json();if(!W.success){alert(W.message||"Gagal menambahkan kategori ke server"),E(!1);return}}catch{alert("Gagal menghubungi server"),E(!1);return}E(!1)}h({...a,categories:[...a.categories,A]}),N("")}},F=async f=>{if(confirm(`Hapus kategori "${f}"?`)){if(o)try{if(!(await(await fetch(`${q}/api/categories/${encodeURIComponent(f)}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}})).json()).success){alert("Gagal menghapus kategori di server");return}}catch{alert("Gagal menghubungi server");return}h({...a,categories:a.categories.filter(A=>A!==f)})}},G=async f=>{if(f.preventDefault(),!(!k.trim()||!b.trim())){if(!o)return alert("Sesi habis");C(!0);try{const K=await(await fetch(`${q}/api/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({username:k,password:b})})).json();K.success?(n(""),j(""),c(),alert("User berhasil dibuat!")):alert(K.message)}catch{alert("Gagal membuat user")}finally{C(!1)}}},I=async f=>{if(confirm("Yakin ingin menghapus user ini?")){if(!o)return alert("Sesi habis");try{(await(await fetch(`${q}/api/users/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}})).json()).success&&c()}catch{alert("Gagal hapus user")}}},J=async()=>{y(!0),i(null);try{const A=await(await fetch(`${q}/api/test-db`)).json();if(A.status==="success")S(K=>({...K,isConnected:!0})),i({type:"success",text:A.message}),h({...a,database:{...w,isConnected:!0}});else throw new Error(A.message)}catch(f){i({type:"error",text:f.message||"Gagal terkoneksi ke server."})}finally{y(!1)}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Pengaturan Aplikasi"}),e.jsxs("div",{className:"flex space-x-1 bg-slate-100 p-1 rounded-xl w-fit overflow-x-auto",children:[e.jsx("button",{onClick:()=>d("GENERAL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="GENERAL"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Kategori"}),e.jsx("button",{onClick:()=>d("USERS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="USERS"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Manajemen User"}),e.jsx("button",{onClick:()=>d("DATABASE"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="DATABASE"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Database"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[x==="GENERAL"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(de,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Kategori Kegiatan"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Kelola kategori untuk dropdown input."})]})]}),e.jsxs("form",{onSubmit:B,className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Nama Kategori Baru...",value:r,onChange:f=>N(f.target.value),className:"flex-1 rounded-lg border-slate-300 bg-slate-50 text-slate-900 border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none",disabled:L}),e.jsxs("button",{type:"submit",disabled:!r.trim()||L,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[L?e.jsx(fe,{size:18,className:"animate-spin"}):e.jsx(xe,{size:18})," Tambah"]})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:a.categories.map((f,A)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100 group hover:border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-slate-700 font-medium",children:f}),e.jsx("button",{onClick:()=>F(f),className:"text-slate-400 hover:text-rose-500 p-1",children:e.jsx(ae,{size:16})})]},A))})]}),x==="USERS"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(Be,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Manajemen User"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Tambah atau hapus akses pengguna sistem."})]})]}),e.jsxs("form",{onSubmit:G,className:"bg-slate-50 p-4 rounded-lg border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(dt,{size:16})," Tambah User Baru"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Username",required:!0,value:k,onChange:f=>n(f.target.value),className:"p-2 rounded border border-slate-300 text-sm"}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,value:b,onChange:f=>j(f.target.value),className:"p-2 rounded border border-slate-300 text-sm"})]}),e.jsx("button",{disabled:$,className:"w-full bg-blue-600 text-white py-2 rounded text-sm font-medium hover:bg-blue-700 transition",children:$?"Memproses...":"Buat User"})]}),e.jsx("div",{className:"overflow-hidden border border-slate-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-600 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Username"}),e.jsx("th",{className:"p-3",children:"Role"}),e.jsx("th",{className:"p-3 text-right",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:T.map((f,A)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"p-3 text-slate-800",children:f.username}),e.jsx("td",{className:"p-3 text-slate-500 uppercase text-xs font-bold",children:f.role}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>I(f.id),className:"text-rose-500 hover:text-rose-700 p-1",children:e.jsx(ae,{size:16})})})]},f.id))})]})})]}),x==="DATABASE"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(je,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Koneksi MySQL"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Konfigurasi database server."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200 text-sm",children:[e.jsx("p",{className:"mb-2 font-semibold",children:"Status Koneksi:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${w.isConnected?"bg-emerald-500":"bg-rose-500"}`}),e.jsx("span",{className:"text-slate-700",children:w.isConnected?"Terhubung":"Terputus"})]})]}),O&&e.jsxs("div",{className:`p-3 rounded-lg text-sm flex items-center gap-2 ${O.type==="success"?"bg-emerald-100 text-emerald-800":"bg-rose-100 text-rose-800"}`,children:[O.type==="success"?e.jsx(qe,{size:16}):e.jsx(Fe,{size:16}),O.text]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{onClick:J,disabled:z,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white px-6 py-2.5 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[z?e.jsx(fe,{size:18,className:"animate-spin"}):e.jsx(je,{size:18}),"Test Koneksi"]})})]})]})]})})]})},St=({onLogin:a,isDbConnected:h=!0})=>{const[o,x]=s.useState(""),[d,r]=s.useState(""),[N,w]=s.useState(""),[S,T]=s.useState(!1),P=async n=>{if(n.preventDefault(),!!h){T(!0),w("");try{const j=await(await fetch(`${q}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,password:d})})).json();j.success&&j.token?a(j.user,j.token):w(j.message||"Login gagal")}catch{w("Gagal menghubungi server")}finally{T(!1)}}},k=()=>{window.location.reload()};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-slate-900",children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("img",{src:"https://ruangdimensirecords.com/img/bg.jpg",alt:"Background",className:"w-full h-full object-cover opacity-50"}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-[2px]"})]}),e.jsxs("div",{className:`absolute top-4 right-4 z-10 inline-flex items-center gap-2 px-4 py-2 rounded-full text-xs font-medium border shadow-sm transition-all duration-300 ${h?"bg-white text-emerald-700 border-emerald-100":"bg-white text-rose-700 border-rose-100"}`,children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${h?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),h?"Database Terhubung":"Database Offline"]}),!h&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center border-t-4 border-rose-500",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-6 text-rose-600 animate-pulse",children:e.jsx(je,{size:40})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Koneksi Database Terputus"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"Sistem tidak dapat terhubung ke database server. Mohon periksa koneksi internet Anda atau hubungi Administrator Sistem."}),e.jsxs("button",{onClick:k,className:"px-6 py-3 rounded-xl bg-rose-600 text-white font-bold hover:bg-rose-700 shadow-lg shadow-rose-200 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(fe,{size:20})," Coba Hubungkan Ulang"]})]})}),e.jsxs("div",{className:`relative z-10 bg-white/90 backdrop-blur-md p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100 transition-all duration-300 ${h?"":"filter blur-sm pointer-events-none"}`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"RDR Logo",className:"h-24 w-auto mx-auto mb-6 object-contain drop-shadow-md"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Selamat Datang"}),e.jsx("p",{className:"text-slate-500",children:"Sistem Informasi Keuangan RDR"})]}),N&&e.jsxs("div",{className:"mb-4 p-3 bg-rose-50 border border-rose-200 text-rose-600 text-sm rounded-lg text-center font-medium flex items-center justify-center gap-2",children:[e.jsx(ie,{size:16})," ",N]}),e.jsxs("form",{onSubmit:P,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"text",value:o,onChange:n=>x(n.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan username",required:!0,disabled:!h})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"password",value:d,onChange:n=>r(n.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan password",required:!0,disabled:!h})]})]}),e.jsx("button",{type:"submit",disabled:S||!h,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-all shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed",children:S?"Memproses...":"Masuk Sistem"})]}),e.jsxs("div",{className:"mt-6 text-center text-xs text-slate-400",children:["Â© ",new Date().getFullYear()," RDR Finance System"]})]})]})},Et=({authToken:a})=>{const[h,o]=s.useState([]),[x,d]=s.useState(!1),[r,N]=s.useState(!1),[w,S]=s.useState(!1),[T,P]=s.useState(""),[k,n]=s.useState(null),[b,j]=s.useState(null),[$,C]=s.useState(""),[L,E]=s.useState(""),[z,y]=s.useState(""),[O,i]=s.useState(""),[c,B]=s.useState(""),[F,G]=s.useState("");s.useEffect(()=>{a&&I()},[a]);const I=async()=>{n(null);try{const g=await fetch(`${q}/api/employees`,{headers:{Authorization:`Bearer ${a}`}});if(!g.ok){const Q=await g.text();throw new Error(`Server Error (${g.status}): ${Q.substring(0,100)}`)}const V=await g.json();Array.isArray(V)?o(V):o([])}catch(g){console.error("Gagal load pegawai",g),n(g.message||"Gagal memuat data pegawai.")}},J=()=>{C(""),E(""),y(""),i(""),B(""),G(""),j(null),N(!1)},f=()=>{J(),d(!0)},A=g=>{C(g.name),E(g.position),y(g.phone),i(g.email),B(g.username),G(""),j(g.id),N(!0),d(!0)},K=async g=>{if(g.preventDefault(),!a)return;S(!0);const V={name:$,position:L,phone:z,email:O,username:c,password:F};try{let Q=`${q}/api/employees`,m="POST";r&&b&&(Q=`${q}/api/employees/${b}`,m="PUT");const v=await fetch(Q,{method:m,headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(V)});if(!v.ok){const H=await v.text();try{const _=JSON.parse(H);throw new Error(_.message||`Gagal menyimpan (${v.status})`)}catch{throw new Error(`Server Error: ${H.substring(0,150)}...`)}}const D=await v.json();D.success?(I(),d(!1),J(),alert(r?"Data berhasil diperbarui":"Pegawai berhasil ditambahkan")):alert(D.message||"Gagal menyimpan data.")}catch(Q){console.error("Submit Error:",Q),alert(Q.message||"Terjadi kesalahan sistem saat menghubungi server.")}finally{S(!1)}},W=async g=>{if(confirm("Yakin ingin menghapus data pegawai ini?")&&a)try{const Q=await(await fetch(`${q}/api/employees/${g}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).json();Q.success?I():alert(Q.message||"Gagal menghapus")}catch{alert("Gagal menghubungi server untuk menghapus.")}},Z=h.filter(g=>g.name.toLowerCase().includes(T.toLowerCase())||g.position.toLowerCase().includes(T.toLowerCase()));return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Data Pegawai"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Kelola akses dan informasi pegawai."})]}),e.jsxs("button",{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm font-medium transition-colors",children:[e.jsx(xe,{size:18})," Tambah Pegawai"]})]}),k&&e.jsxs("div",{className:"bg-rose-50 border border-rose-200 text-rose-700 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:20}),e.jsxs("span",{children:["Error: ",k]})]}),e.jsxs("button",{onClick:I,className:"text-sm font-bold underline hover:text-rose-900 flex items-center gap-1",children:[e.jsx(fe,{size:14})," Coba Lagi"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ot,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Cari nama atau jabatan...",value:T,onChange:g=>P(g.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-100 transition-all"})]}),e.jsxs("div",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Total: ",h.length," Pegawai"]})]}),Z.length===0&&!k?e.jsxs("div",{className:"text-center py-12 text-slate-400 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-200",children:[e.jsx(ee,{size:48,className:"mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Belum ada data pegawai."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Z.map(g=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 group hover:border-blue-200 dark:hover:border-blue-800 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg",children:g.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>A(g),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-slate-50 rounded",children:e.jsx(ue,{size:16})}),e.jsx("button",{onClick:()=>W(g.id),className:"p-1.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded",children:e.jsx(ae,{size:16})})]})]}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white mb-1",children:g.name}),e.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-medium text-sm mb-4 flex items-center gap-1",children:[e.jsx(Ne,{size:14})," ",g.position]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400 border-t border-slate-100 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{size:14,className:"text-slate-400"})," ",g.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{size:14,className:"text-slate-400"})," ",g.email]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:14,className:"text-slate-400"})," Login: ",e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-slate-900 px-1 rounded",children:g.username})]})]})]},g.id))}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:r?"Edit Data Pegawai":"Tambah Pegawai Baru"}),e.jsx("button",{onClick:()=>d(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(se,{size:24})})]}),e.jsxs("form",{onSubmit:K,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:$,onChange:g=>C(g.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jabatan"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:L,onChange:g=>E(g.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"No. HP / WA"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:z,onChange:g=>y(g.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"email",required:!0,value:O,onChange:g=>i(g.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-4 mt-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:"Akses Login"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:c,onChange:g=>B(g.target.value),className:"w-full p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password ",r&&"(Opsional)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"password",required:!r,value:F,onChange:g=>G(g.target.value),placeholder:r?"Biarkan kosong jika tetap":"",className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Batal"}),e.jsx("button",{type:"submit",disabled:w,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:w?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," Simpan Data"]})})]})]})]})})]})},At=({user:a,authToken:h,categories:o,onLogout:x,onProfileClick:d})=>{const r=a.details,[N,w]=s.useState("DASHBOARD"),[S,T]=s.useState([]),[P,k]=s.useState([]);s.useEffect(()=>{b(),n()},[h]);const n=async()=>{if(h)try{const E=await fetch(`${q}/api/notifications`,{headers:{Authorization:`Bearer ${h}`}});if(E.ok){const z=await E.json();k(z.notifications)}}catch(E){console.error("Failed to fetch notifications",E)}},b=async()=>{if(h)try{const E=await fetch(`${q}/api/reimbursements`,{headers:{Authorization:`Bearer ${h}`}});if(E.ok){const z=await E.json();T(z)}}catch(E){console.error("Failed to fetch reimbursements",E)}},j=async E=>{try{const z=await fetch(`${q}/api/reimbursements`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(E)});if(z.ok)alert("Pengajuan berhasil disimpan"),b();else{const y=await z.json();alert("Gagal menyimpan: "+y.message)}}catch{alert("Terjadi kesalahan saat menyimpan")}},$=async E=>{try{const z=await fetch(`${q}/api/reimbursements/${E.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(E)});if(z.ok)alert("Pengajuan berhasil diupdate"),b();else{const y=await z.json();alert("Gagal update: "+y.message)}}catch{alert("Terjadi kesalahan saat update")}},C=E=>{console.warn("Employees cannot update status")},L=E=>{console.warn("Employees cannot delete reimbursements")};return N==="REIMBURSEMENT"?e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-4 shadow-md sticky top-0 z-30 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>w("DASHBOARD"),className:"p-1 hover:bg-white/20 rounded-full transition-colors",children:e.jsx(ct,{size:24})}),e.jsx("h1",{className:"text-lg font-bold",children:"Reimbursement"})]}),e.jsx("div",{className:"p-4",children:e.jsx(He,{reimbursements:S,onAddReimbursement:j,onUpdateReimbursement:C,onDeleteReimbursement:L,onUpdateReimbursementDetails:$,categories:o,authToken:h,isEmployeeView:!0,currentUser:a})})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(Ne,{size:120})}),e.jsx("div",{className:"absolute top-6 left-6 z-20",children:e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"Logo",className:"h-8 w-auto brightness-0 invert"})}),e.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10 pt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm mb-1",children:Je()}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Halo, ",(r==null?void 0:r.name)||a.username]}),e.jsx("p",{className:"text-blue-100 opacity-90",children:(r==null?void 0:r.position)||"Staff"})]}),e.jsx("button",{onClick:x,className:"bg-white/20 p-2 rounded-full hover:bg-white/30 backdrop-blur-sm transition-colors",children:e.jsx(Me,{size:20})})]}),e.jsxs("div",{className:"flex gap-4 relative z-10",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1",children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"})," Aktif"]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1 relative",onClick:d,children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Notifikasi"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx(De,{size:16})," ",P.length>0?`${P.length} Baru`:"0 Baru"]}),P.length>0&&e.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-ping"})]})]})]}),e.jsxs("div",{className:"p-6 -mt-6 relative z-10 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center gap-4 cursor-pointer hover:shadow-md transition-shadow",onClick:d,children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-100 overflow-hidden border-2 border-white shadow-sm flex-shrink-0",children:a.photo_url?e.jsx("img",{src:`http://localhost:5000${a.photo_url}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:e.jsx(ee,{size:32})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"font-bold text-slate-800",children:(r==null?void 0:r.name)||a.username}),e.jsx("p",{className:"text-sm text-slate-500",children:(r==null?void 0:r.position)||"Employee"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Edit Profil & Upload Foto"})]}),e.jsx("div",{className:"bg-slate-50 p-2 rounded-full text-slate-400",children:e.jsx(ee,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>w("REIMBURSEMENT"),className:"bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 hover:bg-blue-50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx(xt,{size:24})}),e.jsx("span",{className:"font-semibold text-slate-700 group-hover:text-blue-700",children:"Reimbursement"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 opacity-50 cursor-not-allowed",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(ce,{size:24})}),e.jsx("span",{className:"font-semibold text-slate-400",children:"Absensi"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100 relative group",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ee,{size:18,className:"text-blue-600"})," Data Diri"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(Ne,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Jabatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:(r==null?void 0:r.position)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600",children:e.jsx(Pe,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telepon / WhatsApp"}),e.jsx("p",{className:"font-medium text-slate-800",children:(r==null?void 0:r.phone)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600",children:e.jsx(Ce,{size:18})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("p",{className:"font-medium text-slate-800 truncate",children:(r==null?void 0:r.email)||"-"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100",children:[e.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(te,{size:18,className:"text-amber-500"})," Informasi"]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl text-center text-slate-500 text-sm",children:[e.jsx(ce,{size:32,className:"mx-auto mb-2 text-slate-300"}),e.jsx("p",{children:"Belum ada pengumuman atau tugas khusus untuk Anda saat ini."})]})]})]})]})},ze=({user:a,isOpen:h,onClose:o,onUpdateProfile:x})=>{const[d,r]=s.useState(""),[N,w]=s.useState(""),[S,T]=s.useState(""),[P,k]=s.useState(!1),[n,b]=s.useState(!1),[j,$]=s.useState(""),[C,L]=s.useState(!1);if(s.useEffect(()=>{var y;if(h&&a){const O=a.role==="employee"?(y=a.details)==null?void 0:y.name:a.full_name||"";r(O||""),w(""),T(""),$(a.photo_url||"")}},[h,a]),!h)return null;const E=async y=>{var c;const O=(c=y.target.files)==null?void 0:c[0];if(!O)return;const i=new FormData;i.append("file",O),L(!0);try{const F=await(await fetch(`${q}/api/upload`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("rdr_token")}`},body:i})).json();F.status==="success"?$(F.url):alert("Gagal upload foto: "+F.message)}catch(B){console.error("Upload error:",B),alert("Gagal upload foto")}finally{L(!1)}},z=async y=>{if(y.preventDefault(),N&&N!==S){alert("Konfirmasi password tidak sesuai");return}b(!0);try{await x(d,N,j),o()}catch(O){console.error(O)}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(ee,{size:24,className:"text-blue-600"})," Edit Profil"]}),e.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(se,{size:24})})]}),e.jsxs("form",{onSubmit:z,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsxs("div",{className:"w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center overflow-hidden mb-2 relative group",children:[j?e.jsx("img",{src:`${q}${j}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(ee,{size:40,className:"text-slate-400"}),e.jsxs("label",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity",children:[e.jsx("span",{className:"text-white text-xs",children:"Ubah Foto"}),e.jsx("input",{type:"file",accept:"image/*",onChange:E,className:"hidden"})]})]}),C&&e.jsx("p",{className:"text-xs text-blue-500",children:"Mengupload..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a.username,disabled:!0,className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 dark:text-slate-400 cursor-not-allowed"}),e.jsx(he,{size:16,className:"absolute left-3 top-3 text-slate-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Role"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a.role.toUpperCase(),disabled:!0,className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 dark:text-slate-400 cursor-not-allowed"}),e.jsx(he,{size:16,className:"absolute left-3 top-3 text-slate-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsx("input",{type:"text",required:!0,value:d,onChange:y=>r(y.target.value),className:"w-full p-2.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-colors",placeholder:"Masukkan nama lengkap"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password Baru ",e.jsx("span",{className:"text-slate-400 font-normal text-xs",children:"(Kosongkan jika tidak diubah)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:P?"text":"password",value:N,onChange:y=>w(y.target.value),className:"w-full p-2.5 pr-10 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-colors",placeholder:"******"}),e.jsx("button",{type:"button",onClick:()=>k(!P),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:P?e.jsx(mt,{size:18}):e.jsx(Ge,{size:18})})]})]}),N&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Konfirmasi Password"}),e.jsx("input",{type:"password",value:S,onChange:y=>T(y.target.value),className:`w-full p-2.5 bg-white dark:bg-slate-800 border rounded-lg text-slate-900 dark:text-white focus:ring-2 outline-none transition-colors ${N===S?"border-emerald-500 focus:ring-emerald-500":"border-rose-500 focus:ring-rose-500"}`,placeholder:"Ulangi password baru"}),S&&N!==S&&e.jsx("p",{className:"text-xs text-rose-500 mt-1",children:"Password tidak cocok"})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",disabled:n||N!==""&&N!==S,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm disabled:opacity-70 disabled:cursor-not-allowed transition-colors",children:n?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," Simpan Perubahan"]})})]})]})]})})},Pt=()=>{const[a,h]=s.useState(!1),[o,x]=s.useState(null),[d,r]=s.useState(null),[N,w]=s.useState(!1),[S,T]=s.useState(!1),[P,k]=s.useState(!0),[n,b]=s.useState("DASHBOARD"),[j,$]=s.useState(!1);s.useEffect(()=>{const m=localStorage.getItem("rdr_user"),v=localStorage.getItem("rdr_token");m&&v&&(x(JSON.parse(m)),r(v),h(!0))},[]);const C=async()=>{try{const D=(await(await fetch(`${q}/api/test-db`)).json()).status==="success";return k(D),D}catch{return k(!1),!1}};s.useEffect(()=>{C();const m=setInterval(async()=>{!await C()&&a&&E()},3e4);return()=>clearInterval(m)},[a]);const L=(m,v)=>{x(m),r(v),h(!0),localStorage.setItem("rdr_user",JSON.stringify(m)),localStorage.setItem("rdr_token",v)},E=()=>{localStorage.removeItem("rdr_user"),localStorage.removeItem("rdr_token"),h(!1),x(null),r(null),w(!1)},z=async(m,v,D)=>{const H=await y("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:m,password:v,photoUrl:D})});if(H&&H.ok){const _=await H.json();_.user&&(x(_.user),localStorage.setItem("rdr_user",JSON.stringify(_.user))),alert("Profil berhasil diperbarui!")}else alert("Gagal memperbarui profil.")},y=async(m,v={})=>{if(!d)return null;const D={...v.headers,Authorization:`Bearer ${d}`};try{const H=m.startsWith("/api")?`${q}${m}`:m,_=await fetch(H,{...v,headers:D});return _.status===401||_.status===403?(E(),null):_}catch(H){return console.error("Fetch Error:",H),null}},[O,i]=s.useState({categories:[],database:{host:"",user:"",password:"",name:"",port:"3306",isConnected:!1}}),c=m=>i(m),[B,F]=s.useState([]),[G,I]=s.useState([]),J=async m=>{const v=await y(m);if(!v)return null;const D=await v.text();try{return JSON.parse(D)}catch{return null}};s.useEffect(()=>{a&&P&&d&&(o==null?void 0:o.role)!=="employee"&&(async()=>{const v=await J("/api/transactions");Array.isArray(v)&&F(v);const D=await J("/api/reimbursements");Array.isArray(D)&&I(D);const H=await J("/api/categories");await J("/api/settings"),i(_=>({..._,categories:Array.isArray(H)?H:[],database:{..._.database,isConnected:!0}}))})()},[a,P,d,o]);const f=async m=>{F(v=>[m,...v]),await y("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})},A=async m=>{F(v=>v.filter(D=>D.id!==m)),await y(`/api/transactions/${m}`,{method:"DELETE"})},K=async m=>{F(v=>v.map(D=>D.id===m.id?m:D)),await y(`/api/transactions/${m.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})},W=async m=>{I(v=>[m,...v]),await y("/api/reimbursements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})},Z=async m=>{I(v=>v.filter(D=>D.id!==m)),await y(`/api/reimbursements/${m}`,{method:"DELETE"})},g=async m=>{I(v=>v.map(D=>D.id===m.id?m:D)),await y(`/api/reimbursements/${m.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})},V=async m=>{I(v=>v.map(D=>D.id===m.id?m:D)),await y(`/api/reimbursements/${m.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:m.status,rejectionReason:m.rejectionReason})})},Q=()=>{const m={authToken:d};switch(n){case"DASHBOARD":return e.jsx(ge,{transactions:B,reimbursements:G,isDarkMode:!1,filterType:"ALL"});case"STAT_EXPENSE":return e.jsx(ge,{transactions:B,reimbursements:G,isDarkMode:!1,filterType:"EXPENSE"});case"ADD_EXPENSE":return e.jsx(Ee,{onAddTransaction:f,onDeleteTransaction:A,onUpdateTransaction:K,transactions:B,defaultType:"PENGELUARAN",filterType:"PENGELUARAN",initialView:"LIST",categories:O.categories,...m});case"REIMBURSE":return e.jsx(He,{reimbursements:G,onAddReimbursement:W,onDeleteReimbursement:Z,onUpdateReimbursementDetails:g,onUpdateReimbursement:V,categories:O.categories,...m});case"REPORT_EXPENSE":return e.jsx(Le,{transactions:B,reimbursements:G,fixedFilterType:"PENGELUARAN",categories:O.categories});case"ADD_INCOME":return e.jsx(Ee,{onAddTransaction:f,onDeleteTransaction:A,onUpdateTransaction:K,transactions:B,defaultType:"PEMASUKAN",filterType:"PEMASUKAN",initialView:"LIST",categories:O.categories,...m});case"STAT_INCOME":return e.jsx(ge,{transactions:B,reimbursements:G,isDarkMode:!1,filterType:"INCOME"});case"JOURNAL_LIST":return e.jsx(Ee,{onAddTransaction:f,onDeleteTransaction:A,onUpdateTransaction:K,transactions:B,defaultType:"PENGELUARAN",initialView:"LIST",categories:O.categories,...m});case"REPORT":return e.jsx(Le,{transactions:B,reimbursements:G,categories:O.categories});case"EMPLOYEES":return e.jsx(Et,{...m});case"SETTINGS":return e.jsx(yt,{settings:O,onUpdateSettings:c,...m});default:return e.jsx(ge,{transactions:B,reimbursements:G,isDarkMode:!1})}};return a?(o==null?void 0:o.role)==="employee"?e.jsxs(e.Fragment,{children:[e.jsx(At,{user:o,authToken:d,categories:O.categories,onLogout:()=>w(!0),onProfileClick:()=>T(!0)}),e.jsx(ze,{user:o,isOpen:S,onClose:()=>T(!1),onUpdateProfile:z}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-600",children:e.jsx(Ue,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Anda yakin ingin keluar?"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:E,className:"px-5 py-2.5 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-md shadow-rose-200 transition-colors",children:"Keluar"})]})]})})]}):e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 text-slate-900 font-sans",children:[e.jsx(kt,{user:o,onLogoutClick:()=>w(!0),toggleSidebar:()=>$(!j),isDbConnected:P,onProfileClick:()=>T(!0)}),e.jsxs("div",{className:"flex flex-1 pt-16 overflow-hidden",children:[e.jsx(wt,{activePage:n,setActivePage:b,isOpen:j,setIsOpen:$}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:Q()})}),e.jsx("div",{className:"shrink-0 z-20",children:e.jsx(vt,{})})]})]}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-600",children:e.jsx(Ue,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Apakah Anda yakin ingin keluar dari sistem?"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:E,className:"px-5 py-2.5 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-md shadow-rose-200 transition-colors",children:"Ya, Keluar"})]})]})}),e.jsx(ze,{user:o,isOpen:S,onClose:()=>T(!1),onUpdateProfile:z})]}):e.jsx(St,{onLogin:L,isDbConnected:P})},_e=document.getElementById("root");if(!_e)throw new Error("Could not find root element to mount to");const Ct=Qe.createRoot(_e);Ct.render(e.jsx(Ye.StrictMode,{children:e.jsx(Pt,{})}));
