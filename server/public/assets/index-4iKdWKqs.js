import{r as s,j as e,u as Be,L as Ze,b as et,B as ze,d as Re,e as W,N as Ee,O as tt,f as st,R as at}from"./react-vendor-D6nftT1D.js";import{C as ue,D as fe,B as $e,U as se,L as Oe,X as re,a as lt,b as rt,F as le,P as Ue,c as nt,R as it,W as Ge,d as Fe,S as dt,T as ot,e as ct,A as ce,f as be,g as xe,h as qe,i as Ce,j as ne,k as Je,l as he,m as pe,E as He,n as ge,o as De,p as _e,q as Xe,r as xt,s as mt,t as ut,u as bt,v as Ne,w as ht,x as pt,y as ke,z as Te,M as Ie,G as gt,H as jt,I as ft,J as Nt}from"./lucide-vendor-CgerI2x7.js";import{R as kt,B as vt,C as wt,X as yt,Y as St,T as Et,a as Pt,b as At}from"./vendor-Ab_lsx1n.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))x(d);new MutationObserver(d=>{for(const c of d)if(c.type==="childList")for(const v of c.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&x(v)}).observe(document,{childList:!0,subtree:!0});function i(d){const c={};return d.integrity&&(c.integrity=d.integrity),d.referrerPolicy&&(c.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?c.credentials="include":d.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function x(d){if(d.ep)return;d.ep=!0;const c=i(d);fetch(d.href,c)}})();const U=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),ie=a=>{if(!a)return"-";const p=a.split("-");if(p.length===3){const x=p[0],d=parseInt(p[1])-1,c=p[2],v=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(v[d])return`${c} ${v[d]} ${x}`}const i={day:"numeric",month:"long",year:"numeric"};return new Date(a).toLocaleDateString("id-ID",i)},Qe=()=>{const a={weekday:"long",day:"numeric",month:"long",year:"numeric"};return new Date().toLocaleDateString("id-ID",a)},ve=()=>Math.random().toString(36).substr(2,9),q="",Ct=({user:a,onLogoutClick:p,toggleSidebar:i,isDbConnected:x,onProfileClick:d})=>{var u;const[c,v]=s.useState(0);s.useEffect(()=>{(a==null?void 0:a.role)==="admin"&&S()},[a]);const S=async()=>{try{const I=await fetch(`${q}/api/notifications`,{headers:{Authorization:`Bearer ${localStorage.getItem("rdr_token")}`}});if(I.ok){const A=await I.json();v(A.count)}}catch{console.error("Failed to fetch admin notifications")}};return e.jsxs("header",{className:"h-16 bg-white border-b border-slate-200 fixed top-0 left-0 right-0 z-40 px-4 md:px-6 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:i,className:"md:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"RDR Finance",className:"h-10 w-auto object-contain"}),e.jsxs("span",{className:"font-bold text-lg text-slate-800 tracking-tight hidden md:block",children:["KEUANGAN ",e.jsx("span",{className:"text-blue-600",children:"RDR"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-xs font-medium text-slate-500 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100",children:[e.jsx(ue,{size:14,className:"text-slate-400"}),Qe()]}),e.jsxs("div",{className:`hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium ${x?"bg-emerald-50 border-emerald-100 text-emerald-700":"bg-rose-50 border-rose-100 text-rose-700"}`,title:x?"Database Terhubung":"Database Terputus",children:[e.jsx(fe,{size:14}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${x?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),x?"DB Online":"DB Offline"]})]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"relative p-2 text-slate-500 hover:bg-slate-100 rounded-lg cursor-pointer",children:[e.jsx($e,{size:20}),c>0&&e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"})]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-3 px-3 py-1.5 rounded-full bg-slate-50 border border-slate-100 hover:bg-blue-50 hover:border-blue-100 transition-colors cursor-pointer group",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors overflow-hidden",children:a!=null&&a.photo_url?e.jsx("img",{src:`${q}${a.photo_url}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(se,{size:16})}),e.jsxs("div",{className:"hidden md:block pr-2 text-left",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700 group-hover:text-blue-700 transition-colors",children:(a==null?void 0:a.role)==="employee"?(u=a.details)==null?void 0:u.name:(a==null?void 0:a.full_name)||(a==null?void 0:a.username)||"Admin"}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase leading-none group-hover:text-blue-500 transition-colors",children:(a==null?void 0:a.role)||"User"})]})]}),e.jsx("button",{onClick:p,className:"p-2 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Keluar Sistem",children:e.jsx(Oe,{size:20})})]})]})},Tt=()=>e.jsx("footer",{className:"bg-white border-t border-slate-200 py-4 px-6 text-center md:text-left",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center text-sm text-slate-500",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",e.jsx("span",{className:"font-semibold text-slate-700",children:"RDR Finance"}),". All rights reserved."]}),e.jsx("p",{className:"mt-1 md:mt-0",children:"Build in Garuda Cyber"})]})}),It=({isOpen:a,setIsOpen:p})=>{const x=Be().pathname,d=[{title:"Menu Utama",items:[{path:"/dashboard",label:"Dashboard",icon:lt},{path:"/jurnal",label:"Semua Jurnal",icon:rt},{path:"/laporan",label:"Laporan Umum",icon:le}]},{title:"Pengeluaran",items:[{path:"/pengeluaran/dashboard",label:"Dashboard Cash Out",icon:Ue},{path:"/pengeluaran/tambah",label:"Tambah Pengeluaran",icon:nt},{path:"/reimburse",label:"Tambah Reimburse",icon:it},{path:"/pengeluaran/laporan",label:"Laporan Pengeluaran",icon:le}]},{title:"Pemasukan",items:[{path:"/pemasukan/tambah",label:"Tambah Pemasukan",icon:Ge},{path:"/pemasukan/statistik",label:"Statistik Pemasukan",icon:Ue}]},{title:"Lainnya",items:[{path:"/pegawai",label:"Data Pegawai",icon:Fe},{path:"/pengaturan",label:"Pengaturan",icon:dt}]}];return e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden",onClick:()=>p(!1)}),e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-slate-200 text-slate-700 transform transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:inset-0 ${a?"translate-x-0":"-translate-x-full"} flex flex-col pt-0`,children:[e.jsx("div",{className:"flex md:hidden items-center justify-end p-4 border-b border-slate-100",children:e.jsx("button",{onClick:()=>p(!1),className:"text-slate-500 hover:text-slate-800",children:e.jsx(re,{size:24})})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-6 px-4 space-y-6",children:d.map((c,v)=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3 px-2",children:c.title}),e.jsx("div",{className:"space-y-1",children:c.items.map(S=>{const u=S.icon,I=x===S.path;return e.jsxs(Ze,{to:S.path,onClick:()=>p(!1),className:`w-full flex items-center gap-3 px-4 py-2.5 rounded-lg transition-all duration-200 text-sm ${I?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-600 hover:bg-blue-50 hover:text-blue-600"}`,children:[e.jsx(u,{size:18}),e.jsx("span",{className:"font-medium",children:S.label})]},S.path)})})]},v))})]})]})},Pe=({transactions:a,reimbursements:p,isDarkMode:i,filterType:x="ALL"})=>{const[d,c]=s.useState(null),[v,S]=s.useState(null),u=s.useMemo(()=>{const n=a.filter(E=>E.type==="PEMASUKAN").reduce((E,R)=>E+R.grandTotal,0),h=a.filter(E=>E.type==="PENGELUARAN").reduce((E,R)=>E+R.grandTotal,0),f=p.filter(E=>E.status==="PENDING").reduce((E,R)=>E+R.grandTotal,0),B=n-h;return{totalIncome:n,totalExpense:h,totalReimbursePending:f,balance:B}},[a,p]),I=s.useMemo(()=>{let n=a;x==="INCOME"?n=a.filter(f=>f.type==="PEMASUKAN"):x==="EXPENSE"&&(n=a.filter(f=>f.type==="PENGELUARAN"));const h={};return n.forEach(f=>{h[f.category]||(h[f.category]=0),h[f.category]+=f.grandTotal}),Object.keys(h).map(f=>({name:f,value:h[f]})).slice(0,5)},[a,x]),A=()=>x==="INCOME"?"Statistik Pemasukan":x==="EXPENSE"?"Statistik Pengeluaran":"Dashboard Ringkasan",k=()=>x==="INCOME"?"Pemasukan per Kategori":x==="EXPENSE"?"Pengeluaran per Kategori":"Transaksi per Kategori";return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:A()}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(x==="ALL"||x==="INCOME")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pemasukan"}),e.jsx("h3",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:U(u.totalIncome)})]}),e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400",children:e.jsx(ot,{size:24})})]})}),(x==="ALL"||x==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pengeluaran"}),e.jsx("h3",{className:"text-2xl font-bold text-rose-600 dark:text-rose-400",children:U(u.totalExpense)})]}),e.jsx("div",{className:"p-2 bg-rose-100 dark:bg-rose-900/30 rounded-lg text-rose-600 dark:text-rose-400",children:e.jsx(ct,{size:24})})]})}),(x==="ALL"||x==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Reimburse (Pending)"}),e.jsx("h3",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:U(u.totalReimbursePending)})]}),e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-400",children:e.jsx(ce,{size:24})})]})}),x==="ALL"&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Saldo Akhir"}),e.jsx("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:U(u.balance)})]}),e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(Ge,{size:24})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"Transaksi Terakhir"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:[e.jsx("th",{className:"pb-3 px-3",children:"Tanggal"}),e.jsx("th",{className:"pb-3 px-3",children:"Kategori"}),e.jsx("th",{className:"pb-3 px-3 text-right",children:"Nominal"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[a.filter(n=>x==="ALL"||x==="INCOME"&&n.type==="PEMASUKAN"||x==="EXPENSE"&&n.type==="PENGELUARAN").slice(0,5).map(n=>e.jsxs("tr",{onClick:()=>c(n),className:"text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"py-3 px-3 text-slate-600 dark:text-slate-300",children:ie(n.date)}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${n.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:n.category})}),e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${n.type==="PEMASUKAN"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:[n.type==="PEMASUKAN"?"+":"-"," ",U(n.grandTotal)]})]},n.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data transaksi"})})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:k()}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(kt,{width:"100%",height:"100%",children:e.jsxs(vt,{data:I,children:[e.jsx(wt,{strokeDasharray:"3 3",vertical:!1,stroke:i?"#334155":"#e2e8f0"}),e.jsx(yt,{dataKey:"name",fontSize:12,tickLine:!1,axisLine:!1,tick:{fill:i?"#94a3b8":"#64748b"}}),e.jsx(St,{fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:n=>`${n/1e3}k`,tick:{fill:i?"#94a3b8":"#64748b"}}),e.jsx(Et,{formatter:n=>U(n),cursor:{fill:i?"#334155":"#f8fafc"},contentStyle:{backgroundColor:i?"#1e293b":"#fff",borderColor:i?"#334155":"#e2e8f0",color:i?"#f1f5f9":"#1e293b"},itemStyle:{color:i?"#e2e8f0":"#1e293b"}}),e.jsx(Pt,{dataKey:"value",fill:x==="INCOME"?"#10b981":x==="EXPENSE"?"#f43f5e":"#3b82f6",radius:[4,4,0,0],children:I.map((n,h)=>e.jsx(At,{fill:x==="INCOME"?h%2===0?"#10b981":"#34d399":x==="EXPENSE"?h%2===0?"#f43f5e":"#fb7185":h%2===0?"#3b82f6":"#60a5fa"},`cell-${h}`))})]})})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",d.id]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),c(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(re,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${d.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[d.type==="PEMASUKAN"?e.jsx(be,{size:24}):e.jsx(xe,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[d.type," ",d.expenseType?`(${d.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:U(d.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ue,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:ie(d.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(xe,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:d.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:d.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:d.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(le,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:d.items.map((n,h)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:n.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:n.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:U(n.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:U(n.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:n.filePreviewUrl?e.jsxs("button",{onClick:()=>S(n.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(qe,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},h))})]})})]})]})]})}),v&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>S(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>S(null),children:e.jsx(re,{size:32})}),e.jsxs("div",{className:"relative",onClick:n=>n.stopPropagation(),children:[e.jsx("img",{src:v,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:n=>{var f;const h=n.target;h.onerror=null,h.style.display="none",(f=h.nextElementSibling)==null||f.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ce,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},Ae=({onAddTransaction:a,onUpdateTransaction:p,onDeleteTransaction:i,transactions:x,defaultType:d="PENGELUARAN",filterType:c,initialView:v="LIST",categories:S,authToken:u})=>{const[I,A]=s.useState(v),[k,n]=s.useState(!1),[h,f]=s.useState(null),[B,E]=s.useState(null),[R,D]=s.useState(new Date().toISOString().split("T")[0]),[y,w]=s.useState(d),[K,r]=s.useState("NORMAL"),[o,$]=s.useState(""),[F,G]=s.useState(""),[z,J]=s.useState(""),[N,C]=s.useState([]),[O,Y]=s.useState(null),[te,b]=s.useState(null);s.useEffect(()=>{A(v),w(d),d==="PENGELUARAN"&&r("NORMAL")},[v,d]);const V=s.useMemo(()=>c?x.filter(l=>l.type===c):x,[x,c]),_=()=>{const l=ve();C([...N,{id:l,name:"",qty:1,price:0,total:0}]),Y(l)},ae=l=>{C(N.filter(j=>j.id!==l)),O===l&&Y(null)},Z=l=>{const j=N.find(L=>L.id===l);if(j){if(!j.name.trim()||j.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}Y(null)}},g=(l,j,L)=>{C(N.map(Q=>{if(Q.id===l){const t={...Q,[j]:L};return(j==="qty"||j==="price")&&(t.total=Number(t.qty)*Number(t.price)),t}return Q}))},P=(l,j)=>{C(N.map(L=>{if(L.id===l){const Q=j?URL.createObjectURL(j):void 0;return{...L,file:j,filePreviewUrl:Q}}return L}))},M=()=>N.reduce((l,j)=>l+j.total,0),X=async l=>{if(!u)return alert("Sesi habis. Silakan login ulang."),"";const j=new FormData;j.append("file",l);try{const Q=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${u}`},body:j})).json();if(Q.status==="success")return Q.url;throw new Error(Q.message||"Upload gagal")}catch(L){return console.error("Upload Error:",L),""}},ee=async l=>{if(l.preventDefault(),O){const j=N.find(L=>L.id===O);if(j&&(!j.name.trim()||j.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(!o||!F||N.length===0){alert("Mohon lengkapi data wajib dan minimal 1 item.");return}n(!0);try{const j=await Promise.all(N.map(async Q=>{let t=Q.filePreviewUrl;if(Q.file){const H=await X(Q.file);H&&(t=H)}const{file:m,...T}=Q;return{...T,filePreviewUrl:t}})),L={id:B||ve(),date:R,type:y,expenseType:y==="PENGELUARAN"?K:void 0,category:o,activityName:F,description:z,items:j,grandTotal:M(),timestamp:Date.now()};B?(p(L),alert("Transaksi berhasil diperbarui")):a(L),A("LIST"),de()}catch(j){console.error("Gagal menyimpan transaksi:",j),alert("Terjadi kesalahan saat menyimpan transaksi.")}finally{n(!1)}},de=()=>{D(new Date().toISOString().split("T")[0]),$(""),G(""),J(""),C([]),Y(null),E(null)},je=(l,j)=>{l.stopPropagation(),E(j.id),D(j.date),w(j.type),r(j.expenseType||"NORMAL"),$(j.category),G(j.activityName),J(j.description),C(j.items.map(L=>({...L}))),A("FORM")},we=(l,j)=>{l.stopPropagation(),window.confirm("Apakah Anda yakin ingin menghapus transaksi ini? Data yang dihapus tidak dapat dikembalikan.")&&i(j)},me=()=>I==="FORM"?B?"Edit Transaksi":y==="PEMASUKAN"?"Tambah Pemasukan":"Tambah Pengeluaran":c==="PENGELUARAN"?"Data Pengeluaran":c==="PEMASUKAN"?"Data Pemasukan":"Daftar Jurnal Transaksi",ye=()=>c==="PENGELUARAN"?"+ Tambah Pengeluaran":c==="PEMASUKAN"?"+ Tambah Pemasukan":"+ Tambah Transaksi",Se=!!c;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:me()}),I==="LIST"?e.jsx("button",{onClick:()=>{de(),A("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:ye()}):e.jsx("button",{onClick:()=>{de(),A("LIST")},className:"bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),I==="FORM"?e.jsxs("form",{onSubmit:ee,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal"}),e.jsx("input",{type:"date",required:!0,value:R,onChange:l=>D(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"})]}),(!Se||B)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Transaksi"}),e.jsxs("select",{value:y,onChange:l=>w(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"})]})]}),y==="PENGELUARAN"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Pengeluaran"}),e.jsxs("select",{value:K,onChange:l=>r(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"NORMAL",children:"Normal"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori Kegiatan"}),e.jsxs("select",{required:!0,value:o,onChange:l=>$(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),S.map((l,j)=>e.jsx("option",{value:l,children:l},j))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,placeholder:"Contoh: Pembelian ATK Bulanan",value:F,onChange:l=>G(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan Tambahan"}),e.jsx("textarea",{rows:2,value:z,onChange:l=>J(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item"}),e.jsx("button",{type:"button",onClick:_,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsxs("div",{className:"space-y-4",children:[N.map(l=>{const j=O===l.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center relative transition-colors ${j?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Nama Item"}),e.jsx("input",{type:"text",placeholder:"Nama barang/jasa",value:l.name,onChange:L=>g(l.id,"name",L.target.value),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:l.qty,onChange:L=>g(l.id,"qty",parseInt(L.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga Satuan"}),e.jsx("input",{type:"number",min:"0",value:l.price,onChange:L=>g(l.id,"price",parseInt(L.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-between items-end",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 rounded border border-slate-200 dark:border-slate-600 text-sm font-medium text-slate-700 dark:text-slate-200",children:U(l.total)})]})}),e.jsxs("div",{className:"md:col-span-12 flex items-center justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(Ce,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:L=>P(l.id,L.target.files?L.target.files[0]:null)})]}),l.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:l.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ae(l.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ne,{size:16})}),e.jsx("button",{type:"button",onClick:()=>Z(l.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx(Je,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:l.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:l.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:U(l.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:U(l.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[l.filePreviewUrl&&e.jsx("button",{type:"button",onClick:L=>{L.preventDefault(),L.stopPropagation(),b(l.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(le,{size:16})}),e.jsx("button",{type:"button",onClick:()=>Y(l.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(he,{size:16})}),e.jsx("button",{type:"button",onClick:()=>ae(l.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ne,{size:16})})]})]})]})},l.id)}),N.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 dark:text-slate-500 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-lg",children:"Belum ada item ditambahkan"})]}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:U(M())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",disabled:k,onClick:()=>{de(),A("LIST")},className:"px-6 py-2.5 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:k,className:"px-6 py-2.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium shadow-sm shadow-blue-200 dark:shadow-none transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:k?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18})," ",B?"Update Transaksi":"Simpan Transaksi"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),!c&&e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:V.length>0?V.sort((l,j)=>j.timestamp-l.timestamp).map(l=>e.jsxs("tr",{onClick:()=>f(l),className:"hover:bg-blue-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer even:bg-slate-50 dark:even:bg-slate-800",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:ie(l.date)}),!c&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:l.type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:l.category}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"font-medium",children:l.activityName}),e.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[200px]",children:l.description})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[l.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-800 dark:text-slate-200 text-right",children:U(l.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:j=>je(j,l),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded transition-colors",title:"Edit",children:e.jsx(he,{size:16})}),e.jsx("button",{onClick:j=>we(j,l.id),className:"p-1.5 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Hapus",children:e.jsx(ne,{size:16})})]})})]},l.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:c?6:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:["Belum ada data ",c?c.toLowerCase():"jurnal"]})})})]})})}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",h.id]})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),f(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(re,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${h.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[h.type==="PEMASUKAN"?e.jsx(be,{size:24}):e.jsx(xe,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[h.type," ",h.expenseType?`(${h.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:U(h.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ue,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:ie(h.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(xe,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:h.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:h.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:h.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(le,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:h.items.map((l,j)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:l.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:l.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:U(l.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:U(l.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:l.filePreviewUrl?e.jsxs("button",{onClick:()=>b(l.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(qe,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},j))})]})})]})]})]})})]}),te&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>b(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>b(null),children:e.jsx(re,{size:32})}),e.jsxs("div",{className:"relative",onClick:l=>l.stopPropagation(),children:[e.jsx("img",{src:te,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:l=>{var L;const j=l.target;j.onerror=null,j.style.display="none",(L=j.nextElementSibling)==null||L.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ce,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},We=({reimbursements:a,onAddReimbursement:p,onUpdateReimbursement:i,onDeleteReimbursement:x,onUpdateReimbursementDetails:d,categories:c,authToken:v,isEmployeeView:S=!1,currentUser:u})=>{const[I,A]=s.useState("LIST"),[k,n]=s.useState(null),[h,f]=s.useState(!1),[B,E]=s.useState(null),[R,D]=s.useState(new Date().toISOString().split("T")[0]),[y,w]=s.useState(""),[K,r]=s.useState(""),[o,$]=s.useState(""),[F,G]=s.useState(""),[z,J]=s.useState([]),[N,C]=s.useState(null),[O,Y]=s.useState(null),[te,b]=s.useState(null),[V,_]=s.useState(""),[ae,Z]=s.useState(null),g=()=>{const t=ve();J([...z,{id:t,name:"",qty:1,price:0,total:0}]),C(t)},P=t=>{J(z.filter(m=>m.id!==t)),N===t&&C(null)},M=t=>{const m=z.find(T=>T.id===t);if(m){if(!m.name.trim()||m.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}C(null)}},X=(t,m,T)=>{J(z.map(H=>{if(H.id===t){const oe={...H,[m]:T};return(m==="qty"||m==="price")&&(oe.total=Number(oe.qty)*Number(oe.price)),oe}return H}))},ee=(t,m)=>{J(z.map(T=>T.id===t?{...T,file:m,filePreviewUrl:m?URL.createObjectURL(m):void 0}:T))},de=()=>z.reduce((t,m)=>t+m.total,0),je=async t=>{if(!v)return alert("Sesi habis. Silakan login ulang."),"";const m=new FormData;m.append("file",t);try{const H=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${v}`},body:m})).json();if(H.status==="success")return H.url;throw new Error(H.message||"Upload gagal")}catch(T){return console.error("Upload Error:",T),""}},we=async t=>{if(t.preventDefault(),N){const m=z.find(T=>T.id===N);if(m&&(!m.name.trim()||m.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(z.length===0)return alert("Minimal 1 item reimburse.");if(!K)return alert("Silakan pilih kategori.");f(!0);try{const m=await Promise.all(z.map(async H=>{let oe=H.filePreviewUrl;if(H.file){const Le=await je(H.file);Le&&(oe=Le)}const{file:Kt,...Ve}=H;return{...Ve,filePreviewUrl:oe}})),T={id:B||ve(),date:R,requestorName:y,category:K,activityName:o,description:F,items:m,grandTotal:de(),status:"PENDING",timestamp:Date.now()};B?(d(T),alert("Data reimburse berhasil diperbarui")):p(T),A("LIST"),me()}catch(m){console.error("Gagal menyimpan reimburse:",m),alert("Terjadi kesalahan.")}finally{f(!1)}},me=()=>{var t;if(n(null),E(null),D(new Date().toISOString().split("T")[0]),S&&u){const m=((t=u.details)==null?void 0:t.name)||u.full_name||u.username||"";w(m)}else w("");r(""),$(""),G(""),J([]),C(null),f(!1)},ye=(t,m)=>{if(t.stopPropagation(),m.status!=="PENDING"&&m.status!=="DITOLAK"){alert("Hanya pengajuan berstatus PENDING atau DITOLAK yang dapat diedit.");return}E(m.id),D(m.date),w(m.requestorName),r(m.category),$(m.activityName),G(m.description),J(m.items.map(T=>({...T}))),A("FORM")},Se=(t,m)=>{if(t.stopPropagation(),m.status!=="PENDING"){alert("Hanya pengajuan berstatus PENDING yang dapat dihapus.");return}window.confirm("Yakin ingin menghapus pengajuan reimburse ini?")&&x(m.id)},l=t=>{switch(t){case"PENDING":return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";case"PROSES":return"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300";case"BERHASIL":return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300";case"DITOLAK":return"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300";default:return"bg-slate-100 text-slate-800"}},j=t=>{switch(t){case"PENDING":return e.jsx(xt,{size:14,className:"mr-1"});case"PROSES":return e.jsx(De,{size:14,className:"mr-1 animate-spin-slow"});case"BERHASIL":return e.jsx(Xe,{size:14,className:"mr-1"});case"DITOLAK":return e.jsx(_e,{size:14,className:"mr-1"})}},L=t=>{n(t),Y(t.status),b(null),_(t.rejectionReason||"")},Q=async()=>{if(!(!k||!O)){if(O==="BERHASIL"&&!te&&!k.transferProofUrl){alert("Wajib upload bukti transfer untuk mengubah status menjadi Berhasil.");return}if(O==="DITOLAK"&&!V.trim()){alert("Wajib mengisi alasan penolakan jika status Ditolak.");return}f(!0);try{let t=k.transferProofUrl;if(te){const T=await je(te);T&&(t=T)}const m={...k,status:O,transferProofUrl:t,rejectionReason:O==="DITOLAK"?V:void 0};i(m),n(null)}catch{alert("Gagal update status")}finally{f(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Tambah Reimburse"}),I==="LIST"?e.jsxs("button",{onClick:()=>{me(),A("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:[e.jsx(be,{size:18})," Ajukan Reimburse"]}):e.jsx("button",{onClick:()=>{me(),A("LIST")},className:"bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),I==="FORM"?e.jsxs("form",{onSubmit:we,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal Pengajuan"}),e.jsx("input",{type:"date",required:!0,value:R,onChange:t=>D(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Pengaju"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,placeholder:"Nama Lengkap",value:y,onChange:t=>w(t.target.value),className:`w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 pl-10 focus:ring-blue-500 outline-none transition-colors ${S?"bg-slate-100 text-slate-500 cursor-not-allowed":""}`,readOnly:S})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori"}),e.jsxs("select",{required:!0,value:K,onChange:t=>r(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),c.map((t,m)=>e.jsx("option",{value:t,children:t},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,value:o,onChange:t=>$(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan"}),e.jsx("textarea",{rows:2,value:F,onChange:t=>G(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item Reimburse"}),e.jsx("button",{type:"button",onClick:g,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsx("div",{className:"space-y-4",children:z.map(t=>{const m=N===t.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center transition-colors ${m?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Keterangan Barang/Jasa"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:T=>X(t.id,"name",T.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",required:!0,min:"1",value:t.qty,onChange:T=>X(t.id,"qty",parseInt(T.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga"}),e.jsx("input",{type:"number",required:!0,min:"0",value:t.price,onChange:T=>X(t.id,"price",parseInt(T.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-200 rounded text-sm font-medium",children:U(t.total)})]}),e.jsxs("div",{className:"md:col-span-12 flex justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(Ce,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:T=>{var H;return ee(t.id,((H=T.target.files)==null?void 0:H[0])||null)}})]}),t.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:t.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>P(t.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ne,{size:16})}),e.jsx("button",{type:"button",onClick:()=>M(t.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx(Je,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:t.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:t.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:U(t.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:U(t.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[t.filePreviewUrl&&e.jsx("button",{type:"button",onClick:T=>{T.preventDefault(),T.stopPropagation(),Z(t.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(le,{size:16})}),e.jsx("button",{type:"button",onClick:()=>C(t.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(he,{size:16})}),e.jsx("button",{type:"button",onClick:()=>P(t.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ne,{size:16})})]})]})]})},t.id)})}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total Reimburse"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:U(de())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",disabled:h,onClick:()=>{me(),A("LIST")},className:"px-6 py-2.5 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:h,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm shadow-blue-200 dark:shadow-none transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:h?"Memproses...":e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18})," ",B?"Update Pengajuan":"Simpan Pengajuan"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px] md:min-w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Pengaju"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:a.length>0?a.sort((t,m)=>m.timestamp-t.timestamp).map(t=>e.jsxs("tr",{onClick:()=>L(t),className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:ie(t.date)}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-700 dark:text-slate-300",children:t.requestorName}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:[e.jsx("div",{children:t.activityName}),e.jsx("div",{className:"text-xs text-slate-400",children:t.category})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[t.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-slate-800 dark:text-slate-200",children:U(t.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${l(t.status)}`,children:[j(t.status)," ",t.status]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),L(t)},className:"text-blue-500 hover:text-blue-700 dark:hover:text-blue-400 p-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg transition-colors",title:"Lihat Detail",children:e.jsx(He,{size:18})}),(t.status==="PENDING"||t.status==="DITOLAK")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:m=>ye(m,t),className:"text-slate-500 hover:text-blue-600 p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Edit",children:e.jsx(he,{size:18})}),!S&&e.jsx("button",{onClick:m=>Se(m,t),className:"text-slate-500 hover:text-rose-600 p-1 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Hapus",children:e.jsx(ne,{size:18})})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data reimburse"})})})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:["Detail Reimburse",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold border ${l(k.status)}`,children:k.status})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",k.id]})]}),e.jsx("button",{onClick:()=>n(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(re,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[k.status==="DITOLAK"&&k.rejectionReason&&e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-200 dark:border-rose-800 flex gap-3",children:[e.jsx(ce,{className:"text-rose-600 dark:text-rose-400 shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-rose-700 dark:text-rose-300",children:"Pengajuan Ditolak"}),e.jsx("p",{className:"text-sm text-rose-600 dark:text-rose-400 mt-1",children:k.rejectionReason})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-700/30 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Pengaju"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:k.requestorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Tanggal"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:ie(k.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:k.activityName}),e.jsx("p",{className:"text-xs text-slate-500",children:k.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Keterangan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:k.description||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-white mb-3",children:"Item Pengajuan"}),e.jsx("div",{className:"border rounded-lg border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800",children:k.items.map((t,m)=>e.jsxs("tr",{className:"even:bg-slate-50 dark:even:bg-slate-700",children:[e.jsx("td",{className:"px-4 py-2 text-slate-700 dark:text-slate-300",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-600 dark:text-slate-400",children:t.qty}),e.jsx("td",{className:"px-4 py-2 text-right text-slate-600 dark:text-slate-400",children:U(t.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium text-slate-800 dark:text-slate-200",children:U(t.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:t.filePreviewUrl?e.jsx("button",{onClick:()=>Z(t.filePreviewUrl||null),className:"text-blue-500 hover:underline flex justify-center",children:e.jsx(le,{size:16})}):"-"})]},m))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700/50 font-bold text-slate-800 dark:text-white border-t border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Grand Total"}),e.jsx("td",{className:"px-4 py-3 text-right",children:U(k.grandTotal)}),e.jsx("td",{})]})})]})})]}),!S&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-5 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(se,{size:18})," Aksi Admin"]}),k.status==="BERHASIL"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 dark:text-emerald-400 font-medium p-3 bg-emerald-50 dark:bg-emerald-900/30 rounded-lg border border-emerald-200 dark:border-emerald-800",children:[e.jsx(ge,{size:18})," Status Final: BERHASIL"]}),e.jsx("p",{className:"text-xs text-slate-500 ml-1",children:"Data yang sudah berhasil tidak dapat diubah kembali."}),k.transferProofUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Bukti Transfer:"}),e.jsxs("button",{onClick:()=>Z(k.transferProofUrl||null),className:"inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(le,{size:16})," Lihat Bukti Transfer"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:["PENDING","PROSES","BERHASIL","DITOLAK"].map(t=>e.jsx("button",{onClick:()=>Y(t),className:`px-4 py-2 rounded-lg text-sm font-medium border transition-colors ${O===t?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:t},t))}),O==="BERHASIL"&&e.jsxs("div",{className:"animate-fade-in p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Upload Bukti Transfer ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm transition-colors shadow-sm font-medium",children:[e.jsx(Ce,{size:16})," Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:t=>b(t.target.files?t.target.files[0]:null)})]}),e.jsx("span",{className:"text-sm text-slate-500 truncate max-w-[200px]",children:te?te.name:k.transferProofUrl?"File sudah ada (ganti jika perlu)":"Belum ada file dipilih"})]})]}),O==="DITOLAK"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Alasan Penolakan ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("textarea",{value:V,onChange:t=>_(t.target.value),placeholder:"Contoh: Bukti struk kurang jelas / Nominal tidak sesuai.",rows:3,className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-3 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("button",{onClick:Q,disabled:h,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-sm transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[h?e.jsx(De,{size:18,className:"animate-spin"}):e.jsx(pe,{size:18})," Simpan Perubahan"]})})]})]})]})]})}),ae&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>Z(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>Z(null),children:e.jsx(re,{size:32})}),e.jsxs("div",{className:"relative",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:ae,alt:"Bukti Reimburse",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:t=>{var T;const m=t.target;m.onerror=null,m.style.display="none",(T=m.nextElementSibling)==null||T.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(ce,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})]})},Me=({transactions:a,reimbursements:p,fixedFilterType:i,categories:x})=>{const[d,c]=s.useState("ALL"),[v,S]=s.useState(""),[u,I]=s.useState(""),[A,k]=s.useState(""),[n,h]=s.useState(null),[f,B]=s.useState("ALL");s.useEffect(()=>{c(i||"ALL")},[i]);const E=s.useMemo(()=>{let r=[...a.map(o=>({id:o.id,date:o.date,type:o.type,subType:o.expenseType||"NORMAL",category:o.category,activity:o.activityName,total:o.grandTotal,desc:o.description,timestamp:o.timestamp,source:"JURNAL",raw:o})),...p.filter(o=>o.status==="BERHASIL").map(o=>({id:o.id,date:o.date,type:"PENGELUARAN",subType:"REIMBURSE",category:o.category,activity:o.activityName,total:o.grandTotal,desc:`Reimburse oleh: ${o.requestorName} - ${o.description}`,timestamp:o.timestamp,source:"REIMBURSE_MODULE",raw:o}))];return v&&(r=r.filter(o=>o.date>=v)),u&&(r=r.filter(o=>o.date<=u)),d!=="ALL"&&(r=r.filter(o=>o.type===d||d==="REIMBURSE"&&o.subType==="REIMBURSE")),i==="PENGELUARAN"&&f!=="ALL"&&(r=r.filter(o=>o.subType===f)),A&&(r=r.filter(o=>o.category===A)),r.sort((o,$)=>$.timestamp-o.timestamp)},[a,p,v,u,d,A,i,f]),R=s.useMemo(()=>({income:E.filter(r=>r.type==="PEMASUKAN").reduce((r,o)=>r+o.total,0),expense:E.filter(r=>r.type==="PENGELUARAN").reduce((r,o)=>r+o.total,0),reimburse:E.filter(r=>r.subType==="REIMBURSE").reduce((r,o)=>r+o.total,0)}),[E]),D=()=>{window.print()},y=()=>{const r=["Tanggal","Jenis","Sub Jenis","Kategori","Kegiatan","Deskripsi","Total"],o=E.map(z=>[z.date,z.type,z.subType,z.category,z.activity,`"${z.desc}"`,z.total]),$="data:text/csv;charset=utf-8,"+r.join(",")+`
`+o.map(z=>z.join(",")).join(`
`),F=encodeURI($),G=document.createElement("a");G.setAttribute("href",F),G.setAttribute("download",`laporan_keuangan_${new Date().toISOString()}.csv`),document.body.appendChild(G),G.click(),document.body.removeChild(G)},w=()=>i==="PENGELUARAN"?"Laporan Pengeluaran (Cash Out)":"Laporan Keuangan",K=()=>new Date().toLocaleString("id-ID",{dateStyle:"full",timeStyle:"medium"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1.5cm; }
          body { 
            background: white; 
            color: black; 
            font-size: 12px;
          }
          /* Hide non-printable areas */
          .no-print, nav, header, footer, .sidebar, button, input, select, .summary-cards {
            display: none !important;
          }
          /* Show print specific areas */
          .print-header, .print-footer {
            display: block !important;
          }
          /* Ensure table looks good */
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          thead { background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; }
          tr.even { background-color: #f9f9f9 !important; -webkit-print-color-adjust: exact; }
          
          /* Main container adjustment */
          .main-content { margin: 0; padding: 0; overflow: visible; }
        }
        /* Default hide print areas */
        .print-header, .print-footer { display: none; }
      `}),e.jsxs("div",{className:"print-header mb-6 text-center border-b-2 border-slate-800 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold uppercase tracking-wider text-slate-900",children:"System Informasi Finance"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:"Ruang Dimensi Records"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 no-print",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:w()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors",children:[e.jsx(mt,{size:18})," Excel"]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 bg-slate-800 dark:bg-slate-700 text-white px-4 py-2 rounded-lg hover:bg-slate-900 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(ut,{size:18})," Print / PDF"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 grid grid-cols-1 md:grid-cols-4 gap-4 transition-colors no-print",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Dari Tanggal"}),e.jsx("input",{type:"date",value:v,onChange:r=>S(r.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Sampai Tanggal"}),e.jsx("input",{type:"date",value:u,onChange:r=>I(r.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),i?i==="PENGELUARAN"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Jenis"}),e.jsxs("select",{value:f,onChange:r=>B(r.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua (Cash & Reimburse)"}),e.jsx("option",{value:"NORMAL",children:"Pengeluaran (Cash/Tunai)"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse (Ganti Uang)"})]})]}):null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Jenis Laporan"}),e.jsxs("select",{value:d,onChange:r=>c(r.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua Transaksi"}),e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"}),e.jsx("option",{value:"REIMBURSE",children:"Khusus Reimburse"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Kategori"}),e.jsxs("div",{className:"relative",children:[e.jsx(bt,{className:"absolute left-2.5 top-2.5 text-slate-400",size:14}),e.jsxs("select",{value:A,onChange:r=>k(r.target.value),className:"w-full p-2 pl-8 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500 appearance-none",children:[e.jsx("option",{value:"",children:"Semua Kategori"}),x.map((r,o)=>e.jsx("option",{value:r,children:r},o))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 summary-cards no-print",children:[(!i||i==="PEMASUKAN")&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg border border-emerald-100 dark:border-emerald-800",children:[e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold uppercase",children:"Total Pemasukan"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-300",children:U(R.income)})]}),(!i||i==="PENGELUARAN")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-100 dark:border-rose-800",children:[e.jsx("p",{className:"text-xs text-rose-600 dark:text-rose-400 font-semibold uppercase",children:"Total Pengeluaran (Cash)"}),e.jsx("p",{className:"text-xl font-bold text-rose-700 dark:text-rose-300",children:U(R.expense-R.reimburse)})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-100 dark:border-amber-800",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 font-semibold uppercase",children:"Total Reimburse (Cair)"}),e.jsx("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:U(R.reimburse)})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-semibold uppercase",children:"Total Cash Out"}),e.jsx("p",{className:"text-xl font-bold text-slate-700 dark:text-slate-200",children:U(R.expense)})]})]}),!i&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold uppercase",children:"Saldo Periode Ini"}),e.jsx("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:U(R.income-R.expense)})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori & Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:E.length>0?E.map((r,o)=>e.jsxs("tr",{onClick:()=>h(r),className:`hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer ${o%2===0?"even":"odd"}`,children:[e.jsx("td",{className:"px-6 py-3 text-sm text-slate-600 dark:text-slate-300 whitespace-nowrap",children:ie(r.date)}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase ${r.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:r.type}),r.subType==="REIMBURSE"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border border-amber-200 dark:border-amber-800",children:"REIMBURSE"}),r.subType==="NORMAL"&&r.type==="PENGELUARAN"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600",children:"TUNAI"})]})}),e.jsxs("td",{className:"px-6 py-3 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:r.activity}),e.jsx("div",{className:"text-xs text-slate-400",children:r.category})]}),e.jsx("td",{className:"px-6 py-3 text-sm text-slate-500 dark:text-slate-400 max-w-xs truncate",children:r.desc}),e.jsx("td",{className:`px-6 py-3 text-sm font-bold text-right ${r.type==="PEMASUKAN"?"text-emerald-700 dark:text-emerald-400":"text-rose-700 dark:text-rose-400"}`,children:U(r.total)})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Tidak ada data laporan yang sesuai filter"})})})]})})}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in no-print",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",n.id]})]}),e.jsx("button",{onClick:r=>{r.stopPropagation(),h(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(re,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${n.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[n.type==="PEMASUKAN"?e.jsx(be,{size:24}):e.jsx(xe,{size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[n.type,n.subType==="REIMBURSE"?" (REIMBURSE)":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total"}),e.jsx("p",{className:"font-bold text-lg",children:U(n.total)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ue,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:ie(n.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(xe,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:n.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:n.activity})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 dark:text-white bg-slate-50 dark:bg-slate-700 p-3 rounded-lg border border-slate-100 dark:border-slate-600",children:n.desc||"-"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Sumber Data"}),e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-mono bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:n.source})]})]}),n.raw&&n.raw.items&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(le,{size:16})," Items"]}),e.jsx("div",{className:"text-sm border rounded overflow-hidden dark:border-slate-600",children:n.raw.items.map((r,o)=>e.jsxs("div",{className:"flex justify-between p-2 border-b last:border-0 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50",children:[e.jsxs("span",{children:[r.name," ",e.jsxs("span",{className:"text-slate-400",children:["x",r.qty]})]}),e.jsx("span",{className:"font-medium",children:U(r.total)})]},o))})]})]})]})}),e.jsx("div",{className:"print-footer mt-10 pt-4 border-t border-slate-400 text-right text-sm text-slate-600",children:e.jsxs("p",{children:["Dicetak / Didownload Tanggal : ",K()]})})]})},Lt=({settings:a,onUpdateSettings:p,authToken:i})=>{const[x,d]=s.useState("GENERAL"),[c,v]=s.useState(""),[S,u]=s.useState(a.database),[I,A]=s.useState([]),[k,n]=s.useState(""),[h,f]=s.useState(""),[B,E]=s.useState(!1),[R,D]=s.useState(!1),[y,w]=s.useState(!1),[K,r]=s.useState(null);s.useEffect(()=>{x==="USERS"&&i&&o()},[x,i]);const o=async()=>{if(i)try{const C=await(await fetch(`${q}/api/users`,{headers:{Authorization:`Bearer ${i}`}})).json();Array.isArray(C)&&A(C)}catch{console.error("Failed to fetch users")}},$=async N=>{N.preventDefault();const C=c.trim();if(!(!C||a.categories.includes(C))){if(i){D(!0);try{const Y=await(await fetch(`${q}/api/categories`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({name:C})})).json();if(!Y.success){alert(Y.message||"Gagal menambahkan kategori ke server"),D(!1);return}}catch{alert("Gagal menghubungi server"),D(!1);return}D(!1)}p({...a,categories:[...a.categories,C]}),v("")}},F=async N=>{if(confirm(`Hapus kategori "${N}"?`)){if(i)try{if(!(await(await fetch(`${q}/api/categories/${encodeURIComponent(N)}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).json()).success){alert("Gagal menghapus kategori di server");return}}catch{alert("Gagal menghubungi server");return}p({...a,categories:a.categories.filter(C=>C!==N)})}},G=async N=>{if(N.preventDefault(),!(!k.trim()||!h.trim())){if(!i)return alert("Sesi habis");E(!0);try{const O=await(await fetch(`${q}/api/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({username:k,password:h})})).json();O.success?(n(""),f(""),o(),alert("User berhasil dibuat!")):alert(O.message)}catch{alert("Gagal membuat user")}finally{E(!1)}}},z=async N=>{if(confirm("Yakin ingin menghapus user ini?")){if(!i)return alert("Sesi habis");try{(await(await fetch(`${q}/api/users/${N}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).json()).success&&o()}catch{alert("Gagal hapus user")}}},J=async()=>{w(!0),r(null);try{const C=await(await fetch(`${q}/api/test-db`)).json();if(C.status==="success")u(O=>({...O,isConnected:!0})),r({type:"success",text:C.message}),p({...a,database:{...S,isConnected:!0}});else throw new Error(C.message)}catch(N){r({type:"error",text:N.message||"Gagal terkoneksi ke server."})}finally{w(!1)}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Pengaturan Aplikasi"}),e.jsxs("div",{className:"flex space-x-1 bg-slate-100 p-1 rounded-xl w-fit overflow-x-auto",children:[e.jsx("button",{onClick:()=>d("GENERAL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="GENERAL"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Kategori"}),e.jsx("button",{onClick:()=>d("USERS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="USERS"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Manajemen User"}),e.jsx("button",{onClick:()=>d("DATABASE"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x==="DATABASE"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Database"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[x==="GENERAL"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(xe,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Kategori Kegiatan"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Kelola kategori untuk dropdown input."})]})]}),e.jsxs("form",{onSubmit:$,className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Nama Kategori Baru...",value:c,onChange:N=>v(N.target.value),className:"flex-1 rounded-lg border-slate-300 bg-slate-50 text-slate-900 border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none",disabled:R}),e.jsxs("button",{type:"submit",disabled:!c.trim()||R,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[R?e.jsx(Ne,{size:18,className:"animate-spin"}):e.jsx(be,{size:18})," Tambah"]})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:a.categories.map((N,C)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100 group hover:border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-slate-700 font-medium",children:N}),e.jsx("button",{onClick:()=>F(N),className:"text-slate-400 hover:text-rose-500 p-1",children:e.jsx(ne,{size:16})})]},C))})]}),x==="USERS"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(Fe,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Manajemen User"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Tambah atau hapus akses pengguna sistem."})]})]}),e.jsxs("form",{onSubmit:G,className:"bg-slate-50 p-4 rounded-lg border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(ht,{size:16})," Tambah User Baru"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Username",required:!0,value:k,onChange:N=>n(N.target.value),className:"p-2 rounded border border-slate-300 text-sm"}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,value:h,onChange:N=>f(N.target.value),className:"p-2 rounded border border-slate-300 text-sm"})]}),e.jsx("button",{disabled:B,className:"w-full bg-blue-600 text-white py-2 rounded text-sm font-medium hover:bg-blue-700 transition",children:B?"Memproses...":"Buat User"})]}),e.jsx("div",{className:"overflow-hidden border border-slate-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-600 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Username"}),e.jsx("th",{className:"p-3",children:"Role"}),e.jsx("th",{className:"p-3 text-right",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:I.map((N,C)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"p-3 text-slate-800",children:N.username}),e.jsx("td",{className:"p-3 text-slate-500 uppercase text-xs font-bold",children:N.role}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>z(N.id),className:"text-rose-500 hover:text-rose-700 p-1",children:e.jsx(ne,{size:16})})})]},N.id))})]})})]}),x==="DATABASE"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(fe,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Koneksi MySQL"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Konfigurasi database server."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200 text-sm",children:[e.jsx("p",{className:"mb-2 font-semibold",children:"Status Koneksi:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${S.isConnected?"bg-emerald-500":"bg-rose-500"}`}),e.jsx("span",{className:"text-slate-700",children:S.isConnected?"Terhubung":"Terputus"})]})]}),K&&e.jsxs("div",{className:`p-3 rounded-lg text-sm flex items-center gap-2 ${K.type==="success"?"bg-emerald-100 text-emerald-800":"bg-rose-100 text-rose-800"}`,children:[K.type==="success"?e.jsx(Xe,{size:16}):e.jsx(_e,{size:16}),K.text]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{onClick:J,disabled:y,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white px-6 py-2.5 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[y?e.jsx(Ne,{size:18,className:"animate-spin"}):e.jsx(fe,{size:18}),"Test Koneksi"]})})]})]})]})})]})},Ke=({onLogin:a,isDbConnected:p=!0})=>{const[i,x]=s.useState(""),[d,c]=s.useState(""),[v,S]=s.useState(""),[u,I]=s.useState(!1),A=async n=>{if(n.preventDefault(),!!p){I(!0),S("");try{const f=await(await fetch(`${q}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:d})})).json();f.success&&f.token?a(f.user,f.token):S(f.message||"Login gagal")}catch{S("Gagal menghubungi server")}finally{I(!1)}}},k=()=>{window.location.reload()};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-slate-900",children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("img",{src:"https://ruangdimensirecords.com/img/bg.jpg",alt:"Background",className:"w-full h-full object-cover opacity-50"}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-[2px]"})]}),e.jsxs("div",{className:`absolute top-4 right-4 z-10 inline-flex items-center gap-2 px-4 py-2 rounded-full text-xs font-medium border shadow-sm transition-all duration-300 ${p?"bg-white text-emerald-700 border-emerald-100":"bg-white text-rose-700 border-rose-100"}`,children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${p?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),p?"Database Terhubung":"Database Offline"]}),!p&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center border-t-4 border-rose-500",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-6 text-rose-600 animate-pulse",children:e.jsx(fe,{size:40})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Koneksi Database Terputus"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"Sistem tidak dapat terhubung ke database server. Mohon periksa koneksi internet Anda atau hubungi Administrator Sistem."}),e.jsxs("button",{onClick:k,className:"px-6 py-3 rounded-xl bg-rose-600 text-white font-bold hover:bg-rose-700 shadow-lg shadow-rose-200 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(Ne,{size:20})," Coba Hubungkan Ulang"]})]})}),e.jsxs("div",{className:`relative z-10 bg-white/90 backdrop-blur-md p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100 transition-all duration-300 ${p?"":"filter blur-sm pointer-events-none"}`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"RDR Logo",className:"h-24 w-auto mx-auto mb-6 object-contain drop-shadow-md"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Selamat Datang"}),e.jsx("p",{className:"text-slate-500",children:"Sistem Informasi Keuangan RDR"})]}),v&&e.jsxs("div",{className:"mb-4 p-3 bg-rose-50 border border-rose-200 text-rose-600 text-sm rounded-lg text-center font-medium flex items-center justify-center gap-2",children:[e.jsx(ce,{size:16})," ",v]}),e.jsxs("form",{onSubmit:A,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"text",value:i,onChange:n=>x(n.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan username",required:!0,disabled:!p})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"password",value:d,onChange:n=>c(n.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan password",required:!0,disabled:!p})]})]}),e.jsx("button",{type:"submit",disabled:u||!p,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-all shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed",children:u?"Memproses...":"Masuk Sistem"})]}),e.jsxs("div",{className:"mt-6 text-center text-xs text-slate-400",children:["Â© ",new Date().getFullYear()," RDR Finance System"]})]})]})},zt=({authToken:a})=>{const[p,i]=s.useState([]),[x,d]=s.useState(!1),[c,v]=s.useState(!1),[S,u]=s.useState(!1),[I,A]=s.useState(""),[k,n]=s.useState(null),[h,f]=s.useState(null),[B,E]=s.useState(""),[R,D]=s.useState(""),[y,w]=s.useState(""),[K,r]=s.useState(""),[o,$]=s.useState(""),[F,G]=s.useState("");s.useEffect(()=>{a&&z()},[a]);const z=async()=>{n(null);try{const b=await fetch(`${q}/api/employees`,{headers:{Authorization:`Bearer ${a}`}});if(!b.ok){const _=await b.text();throw new Error(`Server Error (${b.status}): ${_.substring(0,100)}`)}const V=await b.json();Array.isArray(V)?i(V):i([])}catch(b){console.error("Gagal load pegawai",b),n(b.message||"Gagal memuat data pegawai.")}},J=()=>{E(""),D(""),w(""),r(""),$(""),G(""),f(null),v(!1)},N=()=>{J(),d(!0)},C=b=>{E(b.name),D(b.position),w(b.phone),r(b.email),$(b.username),G(""),f(b.id),v(!0),d(!0)},O=async b=>{if(b.preventDefault(),!a)return;u(!0);const V={name:B,position:R,phone:y,email:K,username:o,password:F};try{let _=`${q}/api/employees`,ae="POST";c&&h&&(_=`${q}/api/employees/${h}`,ae="PUT");const Z=await fetch(_,{method:ae,headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(V)});if(!Z.ok){const P=await Z.text();try{const M=JSON.parse(P);throw new Error(M.message||`Gagal menyimpan (${Z.status})`)}catch{throw new Error(`Server Error: ${P.substring(0,150)}...`)}}const g=await Z.json();g.success?(z(),d(!1),J(),alert(c?"Data berhasil diperbarui":"Pegawai berhasil ditambahkan")):alert(g.message||"Gagal menyimpan data.")}catch(_){console.error("Submit Error:",_),alert(_.message||"Terjadi kesalahan sistem saat menghubungi server.")}finally{u(!1)}},Y=async b=>{if(confirm("Yakin ingin menghapus data pegawai ini?")&&a)try{const _=await(await fetch(`${q}/api/employees/${b}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).json();_.success?z():alert(_.message||"Gagal menghapus")}catch{alert("Gagal menghubungi server untuk menghapus.")}},te=p.filter(b=>b.name.toLowerCase().includes(I.toLowerCase())||b.position.toLowerCase().includes(I.toLowerCase()));return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Data Pegawai"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Kelola akses dan informasi pegawai."})]}),e.jsxs("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm font-medium transition-colors",children:[e.jsx(be,{size:18})," Tambah Pegawai"]})]}),k&&e.jsxs("div",{className:"bg-rose-50 border border-rose-200 text-rose-700 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:20}),e.jsxs("span",{children:["Error: ",k]})]}),e.jsxs("button",{onClick:z,className:"text-sm font-bold underline hover:text-rose-900 flex items-center gap-1",children:[e.jsx(Ne,{size:14})," Coba Lagi"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pt,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Cari nama atau jabatan...",value:I,onChange:b=>A(b.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-100 transition-all"})]}),e.jsxs("div",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Total: ",p.length," Pegawai"]})]}),te.length===0&&!k?e.jsxs("div",{className:"text-center py-12 text-slate-400 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-200",children:[e.jsx(se,{size:48,className:"mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Belum ada data pegawai."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:te.map(b=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 group hover:border-blue-200 dark:hover:border-blue-800 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg",children:b.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>C(b),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-slate-50 rounded",children:e.jsx(he,{size:16})}),e.jsx("button",{onClick:()=>Y(b.id),className:"p-1.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded",children:e.jsx(ne,{size:16})})]})]}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white mb-1",children:b.name}),e.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-medium text-sm mb-4 flex items-center gap-1",children:[e.jsx(ke,{size:14})," ",b.position]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400 border-t border-slate-100 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{size:14,className:"text-slate-400"})," ",b.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{size:14,className:"text-slate-400"})," ",b.email]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{size:14,className:"text-slate-400"})," Login: ",e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-slate-900 px-1 rounded",children:b.username})]})]})]},b.id))}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:c?"Edit Data Pegawai":"Tambah Pegawai Baru"}),e.jsx("button",{onClick:()=>d(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(re,{size:24})})]}),e.jsxs("form",{onSubmit:O,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:B,onChange:b=>E(b.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jabatan"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:R,onChange:b=>D(b.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"No. HP / WA"}),e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:y,onChange:b=>w(b.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"email",required:!0,value:K,onChange:b=>r(b.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-4 mt-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:"Akses Login"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:o,onChange:b=>$(b.target.value),className:"w-full p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password ",c&&"(Opsional)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"password",required:!c,value:F,onChange:b=>G(b.target.value),placeholder:c?"Biarkan kosong jika tetap":"",className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Batal"}),e.jsx("button",{type:"submit",disabled:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:S?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18})," Simpan Data"]})})]})]})]})})]})},Rt=({user:a,authToken:p,categories:i,onLogout:x,onProfileClick:d})=>{const c=et(),S=Be().pathname.includes("/reimburse"),u=a.details,[I,A]=s.useState([]),[k,n]=s.useState([]);s.useEffect(()=>{f(),h()},[p]);const h=async()=>{if(p)try{const y=await fetch(`${q}/api/notifications`,{headers:{Authorization:`Bearer ${p}`}});if(y.ok){const w=await y.json();n(w.notifications)}}catch(y){console.error("Failed to fetch notifications",y)}},f=async()=>{if(p)try{const y=await fetch(`${q}/api/reimbursements`,{headers:{Authorization:`Bearer ${p}`}});if(y.ok){const w=await y.json();A(w)}}catch(y){console.error("Failed to fetch reimbursements",y)}},B=async y=>{try{const w=await fetch(`${q}/api/reimbursements`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(y)});if(w.ok)alert("Pengajuan berhasil disimpan"),f();else{const K=await w.json();alert("Gagal menyimpan: "+K.message)}}catch{alert("Terjadi kesalahan saat menyimpan")}},E=async y=>{try{const w=await fetch(`${q}/api/reimbursements/${y.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(y)});if(w.ok)alert("Pengajuan berhasil diupdate"),f();else{const K=await w.json();alert("Gagal update: "+K.message)}}catch{alert("Terjadi kesalahan saat update")}},R=y=>{console.warn("Employees cannot update status")},D=y=>{console.warn("Employees cannot delete reimbursements")};return S?e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-4 shadow-md sticky top-0 z-30 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c("/employee"),className:"p-1 hover:bg-white/20 rounded-full transition-colors",children:e.jsx(gt,{size:24})}),e.jsx("h1",{className:"text-lg font-bold",children:"Reimbursement"})]}),e.jsx("div",{className:"p-4",children:e.jsx(We,{reimbursements:I,onAddReimbursement:B,onUpdateReimbursement:R,onDeleteReimbursement:D,onUpdateReimbursementDetails:E,categories:i,authToken:p,isEmployeeView:!0,currentUser:a})})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(ke,{size:120})}),e.jsx("div",{className:"absolute top-6 left-6 z-20",children:e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"Logo",className:"h-8 w-auto brightness-0 invert"})}),e.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10 pt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm mb-1",children:Qe()}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Halo, ",(u==null?void 0:u.name)||a.username]}),e.jsx("p",{className:"text-blue-100 opacity-90",children:(u==null?void 0:u.position)||"Staff"})]}),e.jsx("button",{onClick:x,className:"bg-white/20 p-2 rounded-full hover:bg-white/30 backdrop-blur-sm transition-colors",children:e.jsx(Oe,{size:20})})]}),e.jsxs("div",{className:"flex gap-4 relative z-10",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1",children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"})," Aktif"]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1 relative",onClick:d,children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Notifikasi"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx($e,{size:16})," ",k.length>0?`${k.length} Baru`:"0 Baru"]}),k.length>0&&e.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-ping"})]})]})]}),e.jsxs("div",{className:"p-6 -mt-6 relative z-10 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center gap-4 cursor-pointer hover:shadow-md transition-shadow",onClick:d,children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-100 overflow-hidden border-2 border-white shadow-sm flex-shrink-0",children:a.photo_url?e.jsx("img",{src:`http://localhost:5000${a.photo_url}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:e.jsx(se,{size:32})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"font-bold text-slate-800",children:(u==null?void 0:u.name)||a.username}),e.jsx("p",{className:"text-sm text-slate-500",children:(u==null?void 0:u.position)||"Employee"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Edit Profil & Upload Foto"})]}),e.jsx("div",{className:"bg-slate-50 p-2 rounded-full text-slate-400",children:e.jsx(se,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>c("/employee/reimburse"),className:"bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 hover:bg-blue-50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx(jt,{size:24})}),e.jsx("span",{className:"font-semibold text-slate-700 group-hover:text-blue-700",children:"Reimbursement"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 opacity-50 cursor-not-allowed",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(ue,{size:24})}),e.jsx("span",{className:"font-semibold text-slate-400",children:"Absensi"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100 relative group",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(se,{size:18,className:"text-blue-600"})," Data Diri"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(ke,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Jabatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:(u==null?void 0:u.position)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600",children:e.jsx(Te,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telepon / WhatsApp"}),e.jsx("p",{className:"font-medium text-slate-800",children:(u==null?void 0:u.phone)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600",children:e.jsx(Ie,{size:18})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("p",{className:"font-medium text-slate-800 truncate",children:(u==null?void 0:u.email)||"-"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100",children:[e.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(le,{size:18,className:"text-amber-500"})," Informasi"]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl text-center text-slate-500 text-sm",children:[e.jsx(ue,{size:32,className:"mx-auto mb-2 text-slate-300"}),e.jsx("p",{children:"Belum ada pengumuman atau tugas khusus untuk Anda saat ini."})]})]})]})]})},Ut=({user:a,isOpen:p,onClose:i,onUpdateProfile:x})=>{const[d,c]=s.useState(""),[v,S]=s.useState(""),[u,I]=s.useState(""),[A,k]=s.useState(!1),[n,h]=s.useState(!1),[f,B]=s.useState(""),[E,R]=s.useState(!1);if(s.useEffect(()=>{var w;if(p&&a){const K=a.role==="employee"?(w=a.details)==null?void 0:w.name:a.full_name||"";c(K||""),S(""),I(""),B(a.photo_url||"")}},[p,a]),!p)return null;const D=async w=>{var o;const K=(o=w.target.files)==null?void 0:o[0];if(!K)return;const r=new FormData;r.append("file",K),R(!0);try{const F=await(await fetch(`${q}/api/upload`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("rdr_token")}`},body:r})).json();F.status==="success"?B(F.url):alert("Gagal upload foto: "+F.message)}catch($){console.error("Upload error:",$),alert("Gagal upload foto")}finally{R(!1)}},y=async w=>{if(w.preventDefault(),v&&v!==u){alert("Konfirmasi password tidak sesuai");return}h(!0);try{await x(d,v,f),i()}catch(K){console.error(K)}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(se,{size:24,className:"text-blue-600"})," Edit Profil"]}),e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(re,{size:24})})]}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsxs("div",{className:"w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center overflow-hidden mb-2 relative group",children:[f?e.jsx("img",{src:`${q}${f}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(se,{size:40,className:"text-slate-400"}),e.jsxs("label",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity",children:[e.jsx("span",{className:"text-white text-xs",children:"Ubah Foto"}),e.jsx("input",{type:"file",accept:"image/*",onChange:D,className:"hidden"})]})]}),E&&e.jsx("p",{className:"text-xs text-blue-500",children:"Mengupload..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a.username,disabled:!0,className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 dark:text-slate-400 cursor-not-allowed"}),e.jsx(ge,{size:16,className:"absolute left-3 top-3 text-slate-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Role"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a.role.toUpperCase(),disabled:!0,className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 dark:text-slate-400 cursor-not-allowed"}),e.jsx(ge,{size:16,className:"absolute left-3 top-3 text-slate-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsx("input",{type:"text",required:!0,value:d,onChange:w=>c(w.target.value),className:"w-full p-2.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-colors",placeholder:"Masukkan nama lengkap"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password Baru ",e.jsx("span",{className:"text-slate-400 font-normal text-xs",children:"(Kosongkan jika tidak diubah)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:A?"text":"password",value:v,onChange:w=>S(w.target.value),className:"w-full p-2.5 pr-10 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-colors",placeholder:"******"}),e.jsx("button",{type:"button",onClick:()=>k(!A),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:A?e.jsx(ft,{size:18}):e.jsx(He,{size:18})})]})]}),v&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Konfirmasi Password"}),e.jsx("input",{type:"password",value:u,onChange:w=>I(w.target.value),className:`w-full p-2.5 bg-white dark:bg-slate-800 border rounded-lg text-slate-900 dark:text-white focus:ring-2 outline-none transition-colors ${v===u?"border-emerald-500 focus:ring-emerald-500":"border-rose-500 focus:ring-rose-500"}`,placeholder:"Ulangi password baru"}),u&&v!==u&&e.jsx("p",{className:"text-xs text-rose-500 mt-1",children:"Password tidak cocok"})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",disabled:n||v!==""&&v!==u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm disabled:opacity-70 disabled:cursor-not-allowed transition-colors",children:n?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18})," Simpan Perubahan"]})})]})]})]})})},Dt=()=>{const[a,p]=s.useState(!1),[i,x]=s.useState(null),[d,c]=s.useState(null),[v,S]=s.useState(!1),[u,I]=s.useState(!1),[A,k]=s.useState(!0),[n,h]=s.useState(!1);s.useEffect(()=>{const g=localStorage.getItem("rdr_user"),P=localStorage.getItem("rdr_token");g&&P&&(x(JSON.parse(g)),c(P),p(!0))},[]);const f=async()=>{try{const M=(await(await fetch(`${q}/api/test-db`)).json()).status==="success";return k(M),M}catch{return k(!1),!1}};s.useEffect(()=>{f();const g=setInterval(async()=>{!await f()&&a&&E()},3e4);return()=>clearInterval(g)},[a]);const B=(g,P)=>{x(g),c(P),p(!0),localStorage.setItem("rdr_user",JSON.stringify(g)),localStorage.setItem("rdr_token",P)},E=()=>{localStorage.removeItem("rdr_user"),localStorage.removeItem("rdr_token"),p(!1),x(null),c(null),S(!1)},R=async(g,P,M)=>{const X=await D("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:g,password:P,photoUrl:M})});if(X&&X.ok){const ee=await X.json();ee.user&&(x(ee.user),localStorage.setItem("rdr_user",JSON.stringify(ee.user))),alert("Profil berhasil diperbarui!")}else alert("Gagal memperbarui profil.")},D=async(g,P={})=>{if(!d)return null;const M={...P.headers,Authorization:`Bearer ${d}`};try{const X=g.startsWith("/api")?`${q}${g}`:g,ee=await fetch(X,{...P,headers:M});return ee.status===401||ee.status===403?(E(),null):ee}catch(X){return console.error("Fetch Error:",X),null}},[y,w]=s.useState({categories:[],database:{host:"",user:"",password:"",name:"",port:"3306",isConnected:!1}}),K=g=>w(g),[r,o]=s.useState([]),[$,F]=s.useState([]),G=async g=>{const P=await D(g);if(!P)return null;const M=await P.text();try{return JSON.parse(M)}catch{return null}};s.useEffect(()=>{a&&A&&d&&(i==null?void 0:i.role)!=="employee"&&(async()=>{const P=await G("/api/transactions");Array.isArray(P)&&o(P);const M=await G("/api/reimbursements");Array.isArray(M)&&F(M);const X=await G("/api/categories");await G("/api/settings"),w(ee=>({...ee,categories:Array.isArray(X)?X:[],database:{...ee.database,isConnected:!0}}))})()},[a,A,d,i]);const z=async g=>{o(P=>[g,...P]),await D("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},J=async g=>{o(P=>P.filter(M=>M.id!==g)),await D(`/api/transactions/${g}`,{method:"DELETE"})},N=async g=>{o(P=>P.map(M=>M.id===g.id?g:M)),await D(`/api/transactions/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},C=async g=>{F(P=>[g,...P]),await D("/api/reimbursements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},O=async g=>{F(P=>P.filter(M=>M.id!==g)),await D(`/api/reimbursements/${g}`,{method:"DELETE"})},Y=async g=>{F(P=>P.map(M=>M.id===g.id?g:M)),await D(`/api/reimbursements/${g.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},te=async g=>{F(P=>P.map(M=>M.id===g.id?g:M)),await D(`/api/reimbursements/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:g.status,rejectionReason:g.rejectionReason})})},b={authToken:d},V=()=>e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 text-slate-900 font-sans",children:[e.jsx(Ct,{user:i,onLogoutClick:()=>S(!0),toggleSidebar:()=>h(!n),isDbConnected:A,onProfileClick:()=>I(!0)}),e.jsxs("div",{className:"flex flex-1 pt-16 overflow-hidden",children:[e.jsx(It,{isOpen:n,setIsOpen:h}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(tt,{})})}),e.jsx("div",{className:"shrink-0 z-20",children:e.jsx(Tt,{})})]})]}),e.jsx(ae,{})]}),_=()=>e.jsxs(e.Fragment,{children:[e.jsx(Rt,{user:i,authToken:d,categories:y.categories,onLogout:()=>S(!0),onProfileClick:()=>I(!0)}),e.jsx(ae,{})]}),ae=()=>e.jsxs(e.Fragment,{children:[v&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-600",children:e.jsx(Nt,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Apakah Anda yakin ingin keluar dari sistem?"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:E,className:"px-5 py-2.5 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-md shadow-rose-200 transition-colors",children:"Ya, Keluar"})]})]})}),e.jsx(Ut,{user:i,isOpen:u,onClose:()=>I(!1),onUpdateProfile:R})]});if(!a)return e.jsx(ze,{children:e.jsx(Re,{children:e.jsx(W,{path:"*",element:e.jsx(Ke,{onLogin:B,isDbConnected:A})})})});const Z=()=>(i==null?void 0:i.role)==="employee"?e.jsx(Ee,{to:"/employee",replace:!0}):e.jsx(Ee,{to:"/dashboard",replace:!0});return e.jsx(ze,{children:e.jsxs(Re,{children:[e.jsx(W,{path:"/login",element:a?e.jsx(Ee,{to:"/"}):e.jsx(Ke,{onLogin:B,isDbConnected:A})}),(i==null?void 0:i.role)==="employee"&&e.jsx(W,{path:"/employee/*",element:e.jsx(_,{})}),(i==null?void 0:i.role)!=="employee"&&e.jsxs(W,{element:e.jsx(V,{}),children:[e.jsx(W,{path:"/dashboard",element:e.jsx(Pe,{transactions:r,reimbursements:$,isDarkMode:!1,filterType:"ALL"})}),e.jsx(W,{path:"/jurnal",element:e.jsx(Ae,{onAddTransaction:z,onDeleteTransaction:J,onUpdateTransaction:N,transactions:r,defaultType:"PENGELUARAN",initialView:"LIST",categories:y.categories,...b})}),e.jsx(W,{path:"/laporan",element:e.jsx(Me,{transactions:r,reimbursements:$,categories:y.categories})}),e.jsx(W,{path:"/pengeluaran/dashboard",element:e.jsx(Pe,{transactions:r,reimbursements:$,isDarkMode:!1,filterType:"EXPENSE"})}),e.jsx(W,{path:"/pengeluaran/tambah",element:e.jsx(Ae,{onAddTransaction:z,onDeleteTransaction:J,onUpdateTransaction:N,transactions:r,defaultType:"PENGELUARAN",filterType:"PENGELUARAN",initialView:"LIST",categories:y.categories,...b})}),e.jsx(W,{path:"/reimburse",element:e.jsx(We,{reimbursements:$,onAddReimbursement:C,onDeleteReimbursement:O,onUpdateReimbursementDetails:Y,onUpdateReimbursement:te,categories:y.categories,...b})}),e.jsx(W,{path:"/pengeluaran/laporan",element:e.jsx(Me,{transactions:r,reimbursements:$,fixedFilterType:"PENGELUARAN",categories:y.categories})}),e.jsx(W,{path:"/pemasukan/tambah",element:e.jsx(Ae,{onAddTransaction:z,onDeleteTransaction:J,onUpdateTransaction:N,transactions:r,defaultType:"PEMASUKAN",filterType:"PEMASUKAN",initialView:"LIST",categories:y.categories,...b})}),e.jsx(W,{path:"/pemasukan/statistik",element:e.jsx(Pe,{transactions:r,reimbursements:$,isDarkMode:!1,filterType:"INCOME"})}),e.jsx(W,{path:"/pegawai",element:e.jsx(zt,{...b})}),e.jsx(W,{path:"/pengaturan",element:e.jsx(Lt,{settings:y,onUpdateSettings:K,...b})})]}),e.jsx(W,{path:"*",element:e.jsx(Z,{})})]})})},Ye=document.getElementById("root");if(!Ye)throw new Error("Could not find root element to mount to");const Mt=st.createRoot(Ye);Mt.render(e.jsx(at.StrictMode,{children:e.jsx(Dt,{})}));
