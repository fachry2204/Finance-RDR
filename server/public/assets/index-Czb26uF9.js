import{r as s,j as e,u as Ue,L as st,b as He,B as Me,d as Be,e as W,N as Ae,O as at,f as lt,R as rt}from"./react-vendor-D6nftT1D.js";import{C as be,D as Ne,B as de,U as ae,L as Ie,X as ne,a as nt,b as it,F as le,P as Ke,c as dt,R as ot,W as _e,d as De,S as ct,T as xt,e as mt,A as re,f as he,g as me,h as Xe,i as Te,j as ie,k as Qe,l as pe,m as ge,E as We,n as je,o as Oe,p as Ye,q as ve,r as ut,s as bt,t as ht,u as pt,v as ke,w as gt,x as jt,y as ye,z as Le,M as Re,G as ft,H as Nt,I as vt,J as Ge,K as Fe,N as kt}from"./lucide-vendor-DyV8GpGp.js";import{R as yt,B as wt,C as St,X as Et,Y as Pt,T as At,a as Ct,b as zt}from"./vendor-Ab_lsx1n.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const x of d)if(x.type==="childList")for(const k of x.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&c(k)}).observe(document,{childList:!0,subtree:!0});function i(d){const x={};return d.integrity&&(x.integrity=d.integrity),d.referrerPolicy&&(x.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?x.credentials="include":d.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function c(d){if(d.ep)return;d.ep=!0;const x=i(d);fetch(d.href,x)}})();const D=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),oe=a=>{if(!a)return"-";const p=a.split("-");if(p.length===3){const c=p[0],d=parseInt(p[1])-1,x=p[2],k=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];if(k[d])return`${x} ${k[d]} ${c}`}const i={day:"numeric",month:"long",year:"numeric"};return new Date(a).toLocaleDateString("id-ID",i)},Ve=()=>{const a={weekday:"long",day:"numeric",month:"long",year:"numeric"};return new Date().toLocaleDateString("id-ID",a)},we=()=>Math.random().toString(36).substr(2,9),q="",It=({user:a,onLogoutClick:p,toggleSidebar:i,isDbConnected:c,onProfileClick:d})=>{var m;const[x,k]=s.useState(0);s.useEffect(()=>{(a==null?void 0:a.role)==="admin"&&S()},[a]);const S=async()=>{try{const I=await fetch(`${q}/api/notifications`,{headers:{Authorization:`Bearer ${localStorage.getItem("rdr_token")}`}});if(I.ok){const P=await I.json();k(P.count)}}catch{console.error("Failed to fetch admin notifications")}};return e.jsxs("header",{className:"h-16 bg-white border-b border-slate-200 fixed top-0 left-0 right-0 z-40 px-4 md:px-6 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:i,className:"md:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"RDR Finance",className:"h-10 w-auto object-contain"}),e.jsxs("span",{className:"font-bold text-lg text-slate-800 tracking-tight hidden md:block",children:["KEUANGAN ",e.jsx("span",{className:"text-blue-600",children:"RDR"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-xs font-medium text-slate-500 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100",children:[e.jsx(be,{size:14,className:"text-slate-400"}),Ve()]}),e.jsxs("div",{className:`hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border text-xs font-medium ${c?"bg-emerald-50 border-emerald-100 text-emerald-700":"bg-rose-50 border-rose-100 text-rose-700"}`,title:c?"Database Terhubung":"Database Terputus",children:[e.jsx(Ne,{size:14}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${c?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),c?"DB Online":"DB Offline"]})]}),(a==null?void 0:a.role)==="admin"&&e.jsxs("div",{className:"relative p-2 text-slate-500 hover:bg-slate-100 rounded-lg cursor-pointer",children:[e.jsx(de,{size:20}),x>0&&e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"})]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-3 px-3 py-1.5 rounded-full bg-slate-50 border border-slate-100 hover:bg-blue-50 hover:border-blue-100 transition-colors cursor-pointer group",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors overflow-hidden",children:a!=null&&a.photo_url?e.jsx("img",{src:`${q}${a.photo_url}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(ae,{size:16})}),e.jsxs("div",{className:"hidden md:block pr-2 text-left",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700 group-hover:text-blue-700 transition-colors",children:(a==null?void 0:a.role)==="employee"?(m=a.details)==null?void 0:m.name:(a==null?void 0:a.full_name)||(a==null?void 0:a.username)||"Admin"}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase leading-none group-hover:text-blue-500 transition-colors",children:(a==null?void 0:a.role)||"User"})]})]}),e.jsx("button",{onClick:p,className:"p-2 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Keluar Sistem",children:e.jsx(Ie,{size:20})})]})]})},Tt=()=>e.jsx("footer",{className:"bg-white border-t border-slate-200 py-4 px-6 text-center md:text-left",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center text-sm text-slate-500",children:[e.jsxs("p",{children:["Â© ",new Date().getFullYear()," ",e.jsx("span",{className:"font-semibold text-slate-700",children:"RDR Finance"}),". All rights reserved."]}),e.jsx("p",{className:"mt-1 md:mt-0",children:"Build in Garuda Cyber"})]})}),Lt=({isOpen:a,setIsOpen:p})=>{const c=Ue().pathname,d=[{title:"Menu Utama",items:[{path:"/dashboard",label:"Dashboard",icon:nt},{path:"/jurnal",label:"Semua Jurnal",icon:it},{path:"/laporan",label:"Laporan Umum",icon:le}]},{title:"Pengeluaran",items:[{path:"/pengeluaran/dashboard",label:"Dashboard Cash Out",icon:Ke},{path:"/pengeluaran/tambah",label:"Tambah Pengeluaran",icon:dt},{path:"/reimburse",label:"Tambah Reimburse",icon:ot},{path:"/pengeluaran/laporan",label:"Laporan Pengeluaran",icon:le}]},{title:"Pemasukan",items:[{path:"/pemasukan/tambah",label:"Tambah Pemasukan",icon:_e},{path:"/pemasukan/statistik",label:"Statistik Pemasukan",icon:Ke}]},{title:"Lainnya",items:[{path:"/pegawai",label:"Data Pegawai",icon:De},{path:"/notifikasi",label:"Notifikasi",icon:de},{path:"/pengaturan",label:"Pengaturan",icon:ct}]}];return e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden",onClick:()=>p(!1)}),e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-slate-200 text-slate-700 transform transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:inset-0 ${a?"translate-x-0":"-translate-x-full"} flex flex-col pt-0`,children:[e.jsx("div",{className:"flex md:hidden items-center justify-end p-4 border-b border-slate-100",children:e.jsx("button",{onClick:()=>p(!1),className:"text-slate-500 hover:text-slate-800",children:e.jsx(ne,{size:24})})}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-6 px-4 space-y-6",children:d.map((x,k)=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3 px-2",children:x.title}),e.jsx("div",{className:"space-y-1",children:x.items.map(S=>{const m=S.icon,I=c===S.path;return e.jsxs(st,{to:S.path,onClick:()=>p(!1),className:`w-full flex items-center gap-3 px-4 py-2.5 rounded-lg transition-all duration-200 text-sm ${I?"bg-blue-600 text-white shadow-md shadow-blue-200":"text-slate-600 hover:bg-blue-50 hover:text-blue-600"}`,children:[e.jsx(m,{size:18}),e.jsx("span",{className:"font-medium",children:S.label})]},S.path)})})]},k))})]})]})},Ce=({transactions:a,reimbursements:p,isDarkMode:i,filterType:c="ALL"})=>{const[d,x]=s.useState(null),[k,S]=s.useState(null),m=s.useMemo(()=>{const r=a.filter(j=>j.type==="PEMASUKAN").reduce((j,A)=>j+A.grandTotal,0),b=a.filter(j=>j.type==="PENGELUARAN").reduce((j,A)=>j+A.grandTotal,0),N=p.filter(j=>j.status==="PENDING").reduce((j,A)=>j+A.grandTotal,0),B=r-b;return{totalIncome:r,totalExpense:b,totalReimbursePending:N,balance:B}},[a,p]),I=s.useMemo(()=>{let r=a;c==="INCOME"?r=a.filter(N=>N.type==="PEMASUKAN"):c==="EXPENSE"&&(r=a.filter(N=>N.type==="PENGELUARAN"));const b={};return r.forEach(N=>{b[N.category]||(b[N.category]=0),b[N.category]+=N.grandTotal}),Object.keys(b).map(N=>({name:N,value:b[N]})).slice(0,5)},[a,c]),P=()=>c==="INCOME"?"Statistik Pemasukan":c==="EXPENSE"?"Statistik Pengeluaran":"Dashboard Ringkasan",y=()=>c==="INCOME"?"Pemasukan per Kategori":c==="EXPENSE"?"Pengeluaran per Kategori":"Transaksi per Kategori";return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:P()}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(c==="ALL"||c==="INCOME")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pemasukan"}),e.jsx("h3",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:D(m.totalIncome)})]}),e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg text-emerald-600 dark:text-emerald-400",children:e.jsx(xt,{size:24})})]})}),(c==="ALL"||c==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Pengeluaran"}),e.jsx("h3",{className:"text-2xl font-bold text-rose-600 dark:text-rose-400",children:D(m.totalExpense)})]}),e.jsx("div",{className:"p-2 bg-rose-100 dark:bg-rose-900/30 rounded-lg text-rose-600 dark:text-rose-400",children:e.jsx(mt,{size:24})})]})}),(c==="ALL"||c==="EXPENSE")&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Total Reimburse (Pending)"}),e.jsx("h3",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:D(m.totalReimbursePending)})]}),e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg text-amber-600 dark:text-amber-400",children:e.jsx(re,{size:24})})]})}),c==="ALL"&&e.jsx("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 relative overflow-hidden transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Saldo Akhir"}),e.jsx("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:D(m.balance)})]}),e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400",children:e.jsx(_e,{size:24})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:"Transaksi Terakhir"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:[e.jsx("th",{className:"pb-3 px-3",children:"Tanggal"}),e.jsx("th",{className:"pb-3 px-3",children:"Kategori"}),e.jsx("th",{className:"pb-3 px-3 text-right",children:"Nominal"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[a.filter(r=>c==="ALL"||c==="INCOME"&&r.type==="PEMASUKAN"||c==="EXPENSE"&&r.type==="PENGELUARAN").slice(0,5).map(r=>e.jsxs("tr",{onClick:()=>x(r),className:"text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"py-3 px-3 text-slate-600 dark:text-slate-300",children:oe(r.date)}),e.jsx("td",{className:"py-3 px-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${r.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:r.category})}),e.jsxs("td",{className:`py-3 px-3 text-right font-medium ${r.type==="PEMASUKAN"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:[r.type==="PEMASUKAN"?"+":"-"," ",D(r.grandTotal)]})]},r.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-4 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data transaksi"})})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 transition-colors",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-4",children:y()}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(yt,{width:"100%",height:"100%",children:e.jsxs(wt,{data:I,children:[e.jsx(St,{strokeDasharray:"3 3",vertical:!1,stroke:i?"#334155":"#e2e8f0"}),e.jsx(Et,{dataKey:"name",fontSize:12,tickLine:!1,axisLine:!1,tick:{fill:i?"#94a3b8":"#64748b"}}),e.jsx(Pt,{fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:r=>`${r/1e3}k`,tick:{fill:i?"#94a3b8":"#64748b"}}),e.jsx(At,{formatter:r=>D(r),cursor:{fill:i?"#334155":"#f8fafc"},contentStyle:{backgroundColor:i?"#1e293b":"#fff",borderColor:i?"#334155":"#e2e8f0",color:i?"#f1f5f9":"#1e293b"},itemStyle:{color:i?"#e2e8f0":"#1e293b"}}),e.jsx(Ct,{dataKey:"value",fill:c==="INCOME"?"#10b981":c==="EXPENSE"?"#f43f5e":"#3b82f6",radius:[4,4,0,0],children:I.map((r,b)=>e.jsx(zt,{fill:c==="INCOME"?b%2===0?"#10b981":"#34d399":c==="EXPENSE"?b%2===0?"#f43f5e":"#fb7185":b%2===0?"#3b82f6":"#60a5fa"},`cell-${b}`))})]})})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",d.id]})]}),e.jsx("button",{onClick:r=>{r.stopPropagation(),x(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(ne,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${d.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[d.type==="PEMASUKAN"?e.jsx(he,{size:24}):e.jsx(me,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[d.type," ",d.expenseType?`(${d.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:D(d.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(be,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:oe(d.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(me,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:d.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:d.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:d.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(le,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:d.items.map((r,b)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:r.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:r.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:D(r.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:D(r.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:r.filePreviewUrl?e.jsxs("button",{onClick:()=>S(r.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(Xe,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},b))})]})})]})]})]})}),k&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>S(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>S(null),children:e.jsx(ne,{size:32})}),e.jsxs("div",{className:"relative",onClick:r=>r.stopPropagation(),children:[e.jsx("img",{src:k,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:r=>{var N;const b=r.target;b.onerror=null,b.style.display="none",(N=b.nextElementSibling)==null||N.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(re,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},ze=({onAddTransaction:a,onUpdateTransaction:p,onDeleteTransaction:i,transactions:c,defaultType:d="PENGELUARAN",filterType:x,initialView:k="LIST",categories:S,authToken:m})=>{const[I,P]=s.useState(k),[y,r]=s.useState(!1),[b,N]=s.useState(null),[B,j]=s.useState(null),[A,R]=s.useState(new Date().toISOString().split("T")[0]),[h,E]=s.useState(d),[M,n]=s.useState("NORMAL"),[o,K]=s.useState(""),[G,F]=s.useState(""),[U,J]=s.useState(""),[w,z]=s.useState([]),[O,V]=s.useState(null),[te,X]=s.useState(null);s.useEffect(()=>{P(k),E(d),d==="PENGELUARAN"&&n("NORMAL")},[k,d]);const v=s.useMemo(()=>x?c.filter(l=>l.type===x):c,[c,x]),ee=()=>{const l=we();z([...w,{id:l,name:"",qty:1,price:0,total:0}]),V(l)},_=l=>{z(w.filter(f=>f.id!==l)),O===l&&V(null)},se=l=>{const f=w.find(L=>L.id===l);if(f){if(!f.name.trim()||f.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}V(null)}},g=(l,f,L)=>{z(w.map(Y=>{if(Y.id===l){const t={...Y,[f]:L};return(f==="qty"||f==="price")&&(t.total=Number(t.qty)*Number(t.price)),t}return Y}))},C=(l,f)=>{z(w.map(L=>{if(L.id===l){const Y=f?URL.createObjectURL(f):void 0;return{...L,file:f,filePreviewUrl:Y}}return L}))},$=()=>w.reduce((l,f)=>l+f.total,0),H=async l=>{if(!m)return alert("Sesi habis. Silakan login ulang."),"";const f=new FormData;f.append("file",l);try{const Y=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${m}`},body:f})).json();if(Y.status==="success")return Y.url;throw new Error(Y.message||"Upload gagal")}catch(L){return console.error("Upload Error:",L),""}},Z=async l=>{if(l.preventDefault(),O){const f=w.find(L=>L.id===O);if(f&&(!f.name.trim()||f.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(!o||!G||w.length===0){alert("Mohon lengkapi data wajib dan minimal 1 item.");return}r(!0);try{const f=await Promise.all(w.map(async Y=>{let t=Y.filePreviewUrl;if(Y.file){const Q=await H(Y.file);Q&&(t=Q)}const{file:u,...T}=Y;return{...T,filePreviewUrl:t}})),L={id:B||we(),date:A,type:h,expenseType:h==="PENGELUARAN"?M:void 0,category:o,activityName:G,description:U,items:f,grandTotal:$(),timestamp:Date.now()};B?(p(L),alert("Transaksi berhasil diperbarui")):a(L),P("LIST"),ce()}catch(f){console.error("Gagal menyimpan transaksi:",f),alert("Terjadi kesalahan saat menyimpan transaksi.")}finally{r(!1)}},ce=()=>{R(new Date().toISOString().split("T")[0]),K(""),F(""),J(""),z([]),V(null),j(null)},fe=(l,f)=>{l.stopPropagation(),j(f.id),R(f.date),E(f.type),n(f.expenseType||"NORMAL"),K(f.category),F(f.activityName),J(f.description),z(f.items.map(L=>({...L}))),P("FORM")},Se=(l,f)=>{l.stopPropagation(),window.confirm("Apakah Anda yakin ingin menghapus transaksi ini? Data yang dihapus tidak dapat dikembalikan.")&&i(f)},ue=()=>I==="FORM"?B?"Edit Transaksi":h==="PEMASUKAN"?"Tambah Pemasukan":"Tambah Pengeluaran":x==="PENGELUARAN"?"Data Pengeluaran":x==="PEMASUKAN"?"Data Pemasukan":"Daftar Jurnal Transaksi",Ee=()=>x==="PENGELUARAN"?"+ Tambah Pengeluaran":x==="PEMASUKAN"?"+ Tambah Pemasukan":"+ Tambah Transaksi",Pe=!!x;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:ue()}),I==="LIST"?e.jsx("button",{onClick:()=>{ce(),P("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:Ee()}):e.jsx("button",{onClick:()=>{ce(),P("LIST")},className:"bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),I==="FORM"?e.jsxs("form",{onSubmit:Z,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal"}),e.jsx("input",{type:"date",required:!0,value:A,onChange:l=>R(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-colors"})]}),(!Pe||B)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Transaksi"}),e.jsxs("select",{value:h,onChange:l=>E(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"})]})]}),h==="PENGELUARAN"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jenis Pengeluaran"}),e.jsxs("select",{value:M,onChange:l=>n(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"NORMAL",children:"Normal"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori Kegiatan"}),e.jsxs("select",{required:!0,value:o,onChange:l=>K(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),S.map((l,f)=>e.jsx("option",{value:l,children:l},f))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,placeholder:"Contoh: Pembelian ATK Bulanan",value:G,onChange:l=>F(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan Tambahan"}),e.jsx("textarea",{rows:2,value:U,onChange:l=>J(l.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item"}),e.jsx("button",{type:"button",onClick:ee,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsxs("div",{className:"space-y-4",children:[w.map(l=>{const f=O===l.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center relative transition-colors ${f?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Nama Item"}),e.jsx("input",{type:"text",placeholder:"Nama barang/jasa",value:l.name,onChange:L=>g(l.id,"name",L.target.value),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:l.qty,onChange:L=>g(l.id,"qty",parseInt(L.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga Satuan"}),e.jsx("input",{type:"number",min:"0",value:l.price,onChange:L=>g(l.id,"price",parseInt(L.target.value)||0),className:"w-full p-2 rounded border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white text-sm outline-none focus:border-blue-500 transition-colors"})]}),e.jsx("div",{className:"md:col-span-3 flex justify-between items-end",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 rounded border border-slate-200 dark:border-slate-600 text-sm font-medium text-slate-700 dark:text-slate-200",children:D(l.total)})]})}),e.jsxs("div",{className:"md:col-span-12 flex items-center justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(Te,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:L=>C(l.id,L.target.files?L.target.files[0]:null)})]}),l.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:l.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>_(l.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ie,{size:16})}),e.jsx("button",{type:"button",onClick:()=>se(l.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx(Qe,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:l.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:l.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:D(l.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:D(l.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[l.filePreviewUrl&&e.jsx("button",{type:"button",onClick:L=>{L.preventDefault(),L.stopPropagation(),X(l.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(le,{size:16})}),e.jsx("button",{type:"button",onClick:()=>V(l.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(pe,{size:16})}),e.jsx("button",{type:"button",onClick:()=>_(l.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ie,{size:16})})]})]})]})},l.id)}),w.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 dark:text-slate-500 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-lg",children:"Belum ada item ditambahkan"})]}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:D($())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx("button",{type:"button",disabled:y,onClick:()=>{ce(),P("LIST")},className:"px-6 py-2.5 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 font-medium transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:y,className:"px-6 py-2.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium shadow-sm shadow-blue-200 dark:shadow-none transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:y?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:18})," ",B?"Update Transaksi":"Simpan Transaksi"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),!x&&e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:v.length>0?v.sort((l,f)=>f.timestamp-l.timestamp).map(l=>e.jsxs("tr",{onClick:()=>N(l),className:"hover:bg-blue-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer even:bg-slate-50 dark:even:bg-slate-800",title:"Klik untuk melihat detail",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:oe(l.date)}),!x&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:l.type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:l.category}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("div",{className:"font-medium",children:l.activityName}),e.jsx("div",{className:"text-xs text-slate-400 truncate max-w-[200px]",children:l.description})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[l.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-800 dark:text-slate-200 text-right",children:D(l.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:f=>fe(f,l),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded transition-colors",title:"Edit",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:f=>Se(f,l.id),className:"p-1.5 text-slate-500 hover:text-rose-600 hover:bg-rose-50 rounded transition-colors",title:"Hapus",children:e.jsx(ie,{size:16})})]})})]},l.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:x?6:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:["Belum ada data ",x?x.toLowerCase():"jurnal"]})})})]})})}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",b.id]})]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),N(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(ne,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${b.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[b.type==="PEMASUKAN"?e.jsx(he,{size:24}):e.jsx(me,{size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[b.type," ",b.expenseType?`(${b.expenseType})`:""]})]}),e.jsxs("div",{className:"ml-auto text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total Nilai"}),e.jsx("p",{className:"font-bold text-lg",children:D(b.grandTotal)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(be,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800",children:oe(b.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(me,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800",children:b.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:b.activityName})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 bg-slate-50 p-3 rounded-lg border border-slate-100",children:b.description||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(le,{size:18})," Detail Item"]}),e.jsx("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:b.items.map((l,f)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-2",children:l.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:l.qty}),e.jsx("td",{className:"px-4 py-2 text-right",children:D(l.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium",children:D(l.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:l.filePreviewUrl?e.jsxs("button",{onClick:()=>X(l.filePreviewUrl||null),className:"text-blue-600 hover:text-blue-800 inline-flex items-center gap-1",children:[e.jsx(Xe,{size:14})," Lihat"]}):e.jsx("span",{className:"text-slate-300",children:"-"})})]},f))})]})})]})]})]})})]}),te&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>X(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>X(null),children:e.jsx(ne,{size:32})}),e.jsxs("div",{className:"relative",onClick:l=>l.stopPropagation(),children:[e.jsx("img",{src:te,alt:"Bukti Transaksi",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:l=>{var L;const f=l.target;f.onerror=null,f.style.display="none",(L=f.nextElementSibling)==null||L.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(re,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})},Ze=({reimbursements:a,onAddReimbursement:p,onUpdateReimbursement:i,onDeleteReimbursement:c,onUpdateReimbursementDetails:d,categories:x,authToken:k,isEmployeeView:S=!1,currentUser:m})=>{const[I,P]=s.useState("LIST"),[y,r]=s.useState(null),[b,N]=s.useState(!1),[B,j]=s.useState(null),[A,R]=s.useState(new Date().toISOString().split("T")[0]),[h,E]=s.useState(""),[M,n]=s.useState(""),[o,K]=s.useState(""),[G,F]=s.useState(""),[U,J]=s.useState([]),[w,z]=s.useState(null),[O,V]=s.useState(null),[te,X]=s.useState(null),[v,ee]=s.useState(""),[_,se]=s.useState(null),g=()=>{const t=we();J([...U,{id:t,name:"",qty:1,price:0,total:0}]),z(t)},C=t=>{J(U.filter(u=>u.id!==t)),w===t&&z(null)},$=t=>{const u=U.find(T=>T.id===t);if(u){if(!u.name.trim()||u.qty<=0){alert("Mohon lengkapi nama item dan quantity minimal 1");return}z(null)}},H=(t,u,T)=>{J(U.map(Q=>{if(Q.id===t){const xe={...Q,[u]:T};return(u==="qty"||u==="price")&&(xe.total=Number(xe.qty)*Number(xe.price)),xe}return Q}))},Z=(t,u)=>{J(U.map(T=>T.id===t?{...T,file:u,filePreviewUrl:u?URL.createObjectURL(u):void 0}:T))},ce=()=>U.reduce((t,u)=>t+u.total,0),fe=async t=>{if(!k)return alert("Sesi habis. Silakan login ulang."),"";const u=new FormData;u.append("file",t);try{const Q=await(await fetch("/api/upload",{method:"POST",headers:{Authorization:`Bearer ${k}`},body:u})).json();if(Q.status==="success")return Q.url;throw new Error(Q.message||"Upload gagal")}catch(T){return console.error("Upload Error:",T),""}},Se=async t=>{if(t.preventDefault(),w){const u=U.find(T=>T.id===w);if(u&&(!u.name.trim()||u.qty<=0)){alert("Mohon lengkapi Nama Item dan Qty pada baris yang sedang diedit.");return}}if(U.length===0)return alert("Minimal 1 item reimburse.");if(!M)return alert("Silakan pilih kategori.");N(!0);try{const u=await Promise.all(U.map(async Q=>{let xe=Q.filePreviewUrl;if(Q.file){const $e=await fe(Q.file);$e&&(xe=$e)}const{file:Ot,...tt}=Q;return{...tt,filePreviewUrl:xe}})),T={id:B||we(),date:A,requestorName:h,category:M,activityName:o,description:G,items:u,grandTotal:ce(),status:"PENDING",timestamp:Date.now()};B?(d(T),alert("Data reimburse berhasil diperbarui")):p(T),P("LIST"),ue()}catch(u){console.error("Gagal menyimpan reimburse:",u),alert("Terjadi kesalahan.")}finally{N(!1)}},ue=()=>{var t;if(r(null),j(null),R(new Date().toISOString().split("T")[0]),S&&m){const u=((t=m.details)==null?void 0:t.name)||m.full_name||m.username||"";E(u)}else E("");n(""),K(""),F(""),J([]),z(null),N(!1)},Ee=(t,u)=>{if(t.stopPropagation(),u.status!=="PENDING"&&u.status!=="DITOLAK"){alert("Hanya pengajuan berstatus PENDING atau DITOLAK yang dapat diedit.");return}j(u.id),R(u.date),E(u.requestorName),n(u.category),K(u.activityName),F(u.description),J(u.items.map(T=>({...T}))),P("FORM")},Pe=(t,u)=>{if(t.stopPropagation(),u.status!=="PENDING"){alert("Hanya pengajuan berstatus PENDING yang dapat dihapus.");return}window.confirm("Yakin ingin menghapus pengajuan reimburse ini?")&&c(u.id)},l=t=>{switch(t){case"PENDING":return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";case"PROSES":return"bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-300";case"BERHASIL":return"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300";case"DITOLAK":return"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300";default:return"bg-slate-100 text-slate-800"}},f=t=>{switch(t){case"PENDING":return e.jsx(ut,{size:14,className:"mr-1"});case"PROSES":return e.jsx(Oe,{size:14,className:"mr-1 animate-spin-slow"});case"BERHASIL":return e.jsx(ve,{size:14,className:"mr-1"});case"DITOLAK":return e.jsx(Ye,{size:14,className:"mr-1"})}},L=t=>{r(t),V(t.status),X(null),ee(t.rejectionReason||"")},Y=async()=>{if(!(!y||!O)){if(O==="BERHASIL"&&!te&&!y.transferProofUrl){alert("Wajib upload bukti transfer untuk mengubah status menjadi Berhasil.");return}if(O==="DITOLAK"&&!v.trim()){alert("Wajib mengisi alasan penolakan jika status Ditolak.");return}N(!0);try{let t=y.transferProofUrl;if(te){const T=await fe(te);T&&(t=T)}const u={...y,status:O,transferProofUrl:t,rejectionReason:O==="DITOLAK"?v:void 0};i(u),r(null)}catch{alert("Gagal update status")}finally{N(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Tambah Reimburse"}),I==="LIST"?e.jsxs("button",{onClick:()=>{ue(),P("FORM")},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-sm font-medium",children:[e.jsx(he,{size:18})," Ajukan Reimburse"]}):e.jsx("button",{onClick:()=>{ue(),P("LIST")},className:"bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600 px-4 py-2 rounded-lg transition-colors font-medium",children:"Kembali"})]}),I==="FORM"?e.jsxs("form",{onSubmit:Se,className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 space-y-6 animate-fade-in transition-colors",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tanggal Pengajuan"}),e.jsx("input",{type:"date",required:!0,value:A,onChange:t=>R(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Pengaju"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,placeholder:"Nama Lengkap",value:h,onChange:t=>E(t.target.value),className:`w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 pl-10 focus:ring-blue-500 outline-none transition-colors ${S?"bg-slate-100 text-slate-500 cursor-not-allowed":""}`,readOnly:S})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Kategori"}),e.jsxs("select",{required:!0,value:M,onChange:t=>n(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors",children:[e.jsx("option",{value:"",disabled:!0,children:"Pilih Kategori"}),x.map((t,u)=>e.jsx("option",{value:t,children:t},u))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Kegiatan"}),e.jsx("input",{type:"text",required:!0,value:o,onChange:t=>K(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Keterangan"}),e.jsx("textarea",{rows:2,value:G,onChange:t=>F(t.target.value),className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-2.5 outline-none transition-colors"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"Detail Item Reimburse"}),e.jsx("button",{type:"button",onClick:g,className:"text-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 font-medium transition-colors",children:"+ Tambah Item"})]}),e.jsx("div",{className:"space-y-4",children:U.map(t=>{const u=w===t.id;return e.jsx("div",{className:`p-4 rounded-lg border border-slate-200 dark:border-slate-600 grid grid-cols-1 md:grid-cols-12 gap-4 items-center transition-colors ${u?"bg-white dark:bg-slate-700 shadow-md ring-1 ring-blue-500/30":"even:bg-slate-50 dark:even:bg-slate-700/50 bg-white dark:bg-slate-800"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Keterangan Barang/Jasa"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:T=>H(t.id,"name",T.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500",autoFocus:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Qty"}),e.jsx("input",{type:"number",required:!0,min:"1",value:t.qty,onChange:T=>H(t.id,"qty",parseInt(T.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Harga"}),e.jsx("input",{type:"number",required:!0,min:"0",value:t.price,onChange:T=>H(t.id,"price",parseInt(T.target.value)||0),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Total"}),e.jsx("div",{className:"w-full p-2 bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-600 text-slate-900 dark:text-slate-200 rounded text-sm font-medium",children:D(t.total)})]}),e.jsxs("div",{className:"md:col-span-12 flex justify-between pt-2 border-t border-slate-100 dark:border-slate-600 border-dashed mt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-xs font-medium transition-colors shadow-sm",children:[e.jsx(Te,{size:14}),"Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:T=>{var Q;return Z(t.id,((Q=T.target.files)==null?void 0:Q[0])||null)}})]}),t.file&&e.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium truncate max-w-[150px]",children:t.file.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>C(t.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ie,{size:16})}),e.jsx("button",{type:"button",onClick:()=>$(t.id),className:"p-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 shadow-sm",title:"Simpan Item",children:e.jsx(Qe,{size:16})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Item"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:t.name})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Qty"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:t.qty})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Harga"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300",children:D(t.price)})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-0.5",children:"Total"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:D(t.total)})]}),e.jsxs("div",{className:"flex gap-2",children:[t.filePreviewUrl&&e.jsx("button",{type:"button",onClick:T=>{T.preventDefault(),T.stopPropagation(),se(t.filePreviewUrl||null)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded",title:"Lihat Bukti",children:e.jsx(le,{size:16})}),e.jsx("button",{type:"button",onClick:()=>z(t.id),className:"p-1.5 text-slate-500 hover:text-blue-600 hover:bg-slate-100 rounded",title:"Edit",children:e.jsx(pe,{size:16})}),e.jsx("button",{type:"button",onClick:()=>C(t.id),className:"p-1.5 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded",title:"Hapus",children:e.jsx(ie,{size:16})})]})]})]})},t.id)})}),e.jsx("div",{className:"flex justify-end mt-6 pt-4 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Grand Total Reimburse"}),e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:D(ce())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",disabled:b,onClick:()=>{ue(),P("LIST")},className:"px-6 py-2.5 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm shadow-blue-200 dark:shadow-none transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:b?"Memproses...":e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:18})," ",B?"Update Pengajuan":"Simpan Pengajuan"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px] md:min-w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Pengaju"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-center",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:a.length>0?a.sort((t,u)=>u.timestamp-t.timestamp).map(t=>e.jsxs("tr",{onClick:()=>L(t),className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors even:bg-slate-50 dark:even:bg-slate-800 cursor-pointer",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:oe(t.date)}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-700 dark:text-slate-300",children:t.requestorName}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-300",children:[e.jsx("div",{children:t.activityName}),e.jsx("div",{className:"text-xs text-slate-400",children:t.category})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-500 dark:text-slate-400",children:[t.items.length," Item"]}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-slate-800 dark:text-slate-200",children:D(t.grandTotal)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${l(t.status)}`,children:[f(t.status)," ",t.status]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),L(t)},className:"text-blue-500 hover:text-blue-700 dark:hover:text-blue-400 p-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg transition-colors",title:"Lihat Detail",children:e.jsx(We,{size:18})}),(t.status==="PENDING"||t.status==="DITOLAK")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u=>Ee(u,t),className:"text-slate-500 hover:text-blue-600 p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"Edit",children:e.jsx(pe,{size:18})}),!S&&e.jsx("button",{onClick:u=>Pe(u,t),className:"text-slate-500 hover:text-rose-600 p-1 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Hapus",children:e.jsx(ie,{size:18})})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Belum ada data reimburse"})})})]})}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:["Detail Reimburse",e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold border ${l(y.status)}`,children:y.status})]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",y.id]})]}),e.jsx("button",{onClick:()=>r(null),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(ne,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[y.status==="DITOLAK"&&y.rejectionReason&&e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-200 dark:border-rose-800 flex gap-3",children:[e.jsx(re,{className:"text-rose-600 dark:text-rose-400 shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-rose-700 dark:text-rose-300",children:"Pengajuan Ditolak"}),e.jsx("p",{className:"text-sm text-rose-600 dark:text-rose-400 mt-1",children:y.rejectionReason})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-700/30 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Pengaju"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:y.requestorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Tanggal"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:oe(y.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:y.activityName}),e.jsx("p",{className:"text-xs text-slate-500",children:y.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold",children:"Keterangan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:y.description||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-white mb-3",children:"Item Pengajuan"}),e.jsx("div",{className:"border rounded-lg border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Item"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Harga"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Bukti"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700 bg-white dark:bg-slate-800",children:y.items.map((t,u)=>e.jsxs("tr",{className:"even:bg-slate-50 dark:even:bg-slate-700",children:[e.jsx("td",{className:"px-4 py-2 text-slate-700 dark:text-slate-300",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-600 dark:text-slate-400",children:t.qty}),e.jsx("td",{className:"px-4 py-2 text-right text-slate-600 dark:text-slate-400",children:D(t.price)}),e.jsx("td",{className:"px-4 py-2 text-right font-medium text-slate-800 dark:text-slate-200",children:D(t.total)}),e.jsx("td",{className:"px-4 py-2 text-center",children:t.filePreviewUrl?e.jsx("button",{onClick:()=>se(t.filePreviewUrl||null),className:"text-blue-500 hover:underline flex justify-center",children:e.jsx(le,{size:16})}):"-"})]},u))}),e.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700/50 font-bold text-slate-800 dark:text-white border-t border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right",children:"Grand Total"}),e.jsx("td",{className:"px-4 py-3 text-right",children:D(y.grandTotal)}),e.jsx("td",{})]})})]})})]}),!S&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-5 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ae,{size:18})," Aksi Admin"]}),y.status==="BERHASIL"?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 dark:text-emerald-400 font-medium p-3 bg-emerald-50 dark:bg-emerald-900/30 rounded-lg border border-emerald-200 dark:border-emerald-800",children:[e.jsx(je,{size:18})," Status Final: BERHASIL"]}),e.jsx("p",{className:"text-xs text-slate-500 ml-1",children:"Data yang sudah berhasil tidak dapat diubah kembali."}),y.transferProofUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Bukti Transfer:"}),e.jsxs("button",{onClick:()=>se(y.transferProofUrl||null),className:"inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(le,{size:16})," Lihat Bukti Transfer"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:["PENDING","PROSES","BERHASIL","DITOLAK"].map(t=>e.jsx("button",{onClick:()=>V(t),className:`px-4 py-2 rounded-lg text-sm font-medium border transition-colors ${O===t?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:t},t))}),O==="BERHASIL"&&e.jsxs("div",{className:"animate-fade-in p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Upload Bukti Transfer ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm transition-colors shadow-sm font-medium",children:[e.jsx(Te,{size:16})," Upload Bukti",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:t=>X(t.target.files?t.target.files[0]:null)})]}),e.jsx("span",{className:"text-sm text-slate-500 truncate max-w-[200px]",children:te?te.name:y.transferProofUrl?"File sudah ada (ganti jika perlu)":"Belum ada file dipilih"})]})]}),O==="DITOLAK"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Alasan Penolakan ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("textarea",{value:v,onChange:t=>ee(t.target.value),placeholder:"Contoh: Bukti struk kurang jelas / Nominal tidak sesuai.",rows:3,className:"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border p-3 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsxs("button",{onClick:Y,disabled:b,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-sm transition-colors flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[b?e.jsx(Oe,{size:18,className:"animate-spin"}):e.jsx(ge,{size:18})," Simpan Perubahan"]})})]})]})]})]})}),_&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm animate-fade-in",onClick:()=>se(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",onClick:()=>se(null),children:e.jsx(ne,{size:32})}),e.jsxs("div",{className:"relative",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:_,alt:"Bukti Reimburse",className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white",onError:t=>{var T;const u=t.target;u.onerror=null,u.style.display="none",(T=u.nextElementSibling)==null||T.classList.remove("hidden")}}),e.jsxs("div",{className:"hidden flex flex-col items-center justify-center p-10 bg-white rounded-lg shadow-xl text-slate-500 min-w-[300px] min-h-[200px]",children:[e.jsx(re,{size:48,className:"text-rose-400 mb-3"}),e.jsx("p",{className:"font-medium text-lg text-slate-700",children:"Gambar Tidak Ditemukan"}),e.jsx("p",{className:"text-sm mt-1",children:"File mungkin telah dihapus atau path salah."})]})]})]})]})]})},qe=({transactions:a,reimbursements:p,fixedFilterType:i,categories:c})=>{const[d,x]=s.useState("ALL"),[k,S]=s.useState(""),[m,I]=s.useState(""),[P,y]=s.useState(""),[r,b]=s.useState(null),[N,B]=s.useState("ALL");s.useEffect(()=>{x(i||"ALL")},[i]);const j=s.useMemo(()=>{let n=[...a.map(o=>({id:o.id,date:o.date,type:o.type,subType:o.expenseType||"NORMAL",category:o.category,activity:o.activityName,total:o.grandTotal,desc:o.description,timestamp:o.timestamp,source:"JURNAL",raw:o})),...p.filter(o=>o.status==="BERHASIL").map(o=>({id:o.id,date:o.date,type:"PENGELUARAN",subType:"REIMBURSE",category:o.category,activity:o.activityName,total:o.grandTotal,desc:`Reimburse oleh: ${o.requestorName} - ${o.description}`,timestamp:o.timestamp,source:"REIMBURSE_MODULE",raw:o}))];return k&&(n=n.filter(o=>o.date>=k)),m&&(n=n.filter(o=>o.date<=m)),d!=="ALL"&&(n=n.filter(o=>o.type===d||d==="REIMBURSE"&&o.subType==="REIMBURSE")),i==="PENGELUARAN"&&N!=="ALL"&&(n=n.filter(o=>o.subType===N)),P&&(n=n.filter(o=>o.category===P)),n.sort((o,K)=>K.timestamp-o.timestamp)},[a,p,k,m,d,P,i,N]),A=s.useMemo(()=>({income:j.filter(n=>n.type==="PEMASUKAN").reduce((n,o)=>n+o.total,0),expense:j.filter(n=>n.type==="PENGELUARAN").reduce((n,o)=>n+o.total,0),reimburse:j.filter(n=>n.subType==="REIMBURSE").reduce((n,o)=>n+o.total,0)}),[j]),R=()=>{window.print()},h=()=>{const n=["Tanggal","Jenis","Sub Jenis","Kategori","Kegiatan","Deskripsi","Total"],o=j.map(U=>[U.date,U.type,U.subType,U.category,U.activity,`"${U.desc}"`,U.total]),K="data:text/csv;charset=utf-8,"+n.join(",")+`
`+o.map(U=>U.join(",")).join(`
`),G=encodeURI(K),F=document.createElement("a");F.setAttribute("href",G),F.setAttribute("download",`laporan_keuangan_${new Date().toISOString()}.csv`),document.body.appendChild(F),F.click(),document.body.removeChild(F)},E=()=>i==="PENGELUARAN"?"Laporan Pengeluaran (Cash Out)":"Laporan Keuangan",M=()=>new Date().toLocaleString("id-ID",{dateStyle:"full",timeStyle:"medium"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 1.5cm; }
          body { 
            background: white; 
            color: black; 
            font-size: 12px;
          }
          /* Hide non-printable areas */
          .no-print, nav, header, footer, .sidebar, button, input, select, .summary-cards {
            display: none !important;
          }
          /* Show print specific areas */
          .print-header, .print-footer {
            display: block !important;
          }
          /* Ensure table looks good */
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          thead { background-color: #f0f0f0 !important; -webkit-print-color-adjust: exact; }
          tr.even { background-color: #f9f9f9 !important; -webkit-print-color-adjust: exact; }
          
          /* Main container adjustment */
          .main-content { margin: 0; padding: 0; overflow: visible; }
        }
        /* Default hide print areas */
        .print-header, .print-footer { display: none; }
      `}),e.jsxs("div",{className:"print-header mb-6 text-center border-b-2 border-slate-800 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold uppercase tracking-wider text-slate-900",children:"System Informasi Finance"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:"Ruang Dimensi Records"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 no-print",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:E()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors",children:[e.jsx(bt,{size:18})," Excel"]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 bg-slate-800 dark:bg-slate-700 text-white px-4 py-2 rounded-lg hover:bg-slate-900 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(ht,{size:18})," Print / PDF"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 grid grid-cols-1 md:grid-cols-4 gap-4 transition-colors no-print",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Dari Tanggal"}),e.jsx("input",{type:"date",value:k,onChange:n=>S(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Sampai Tanggal"}),e.jsx("input",{type:"date",value:m,onChange:n=>I(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500"})]}),i?i==="PENGELUARAN"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Jenis"}),e.jsxs("select",{value:N,onChange:n=>B(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua (Cash & Reimburse)"}),e.jsx("option",{value:"NORMAL",children:"Pengeluaran (Cash/Tunai)"}),e.jsx("option",{value:"REIMBURSE",children:"Reimburse (Ganti Uang)"})]})]}):null:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Jenis Laporan"}),e.jsxs("select",{value:d,onChange:n=>x(n.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500",children:[e.jsx("option",{value:"ALL",children:"Semua Transaksi"}),e.jsx("option",{value:"PEMASUKAN",children:"Pemasukan"}),e.jsx("option",{value:"PENGELUARAN",children:"Pengeluaran"}),e.jsx("option",{value:"REIMBURSE",children:"Khusus Reimburse"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1 block",children:"Filter Kategori"}),e.jsxs("div",{className:"relative",children:[e.jsx(pt,{className:"absolute left-2.5 top-2.5 text-slate-400",size:14}),e.jsxs("select",{value:P,onChange:n=>y(n.target.value),className:"w-full p-2 pl-8 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white rounded-lg text-sm outline-none focus:border-blue-500 appearance-none",children:[e.jsx("option",{value:"",children:"Semua Kategori"}),c.map((n,o)=>e.jsx("option",{value:n,children:n},o))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 summary-cards no-print",children:[(!i||i==="PEMASUKAN")&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg border border-emerald-100 dark:border-emerald-800",children:[e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold uppercase",children:"Total Pemasukan"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-300",children:D(A.income)})]}),(!i||i==="PENGELUARAN")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 p-4 rounded-lg border border-rose-100 dark:border-rose-800",children:[e.jsx("p",{className:"text-xs text-rose-600 dark:text-rose-400 font-semibold uppercase",children:"Total Pengeluaran (Cash)"}),e.jsx("p",{className:"text-xl font-bold text-rose-700 dark:text-rose-300",children:D(A.expense-A.reimburse)})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border border-amber-100 dark:border-amber-800",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 font-semibold uppercase",children:"Total Reimburse (Cair)"}),e.jsx("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:D(A.reimburse)})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-semibold uppercase",children:"Total Cash Out"}),e.jsx("p",{className:"text-xl font-bold text-slate-700 dark:text-slate-200",children:D(A.expense)})]})]}),!i&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold uppercase",children:"Saldo Periode Ini"}),e.jsx("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:D(A.income-A.expense)})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Tanggal"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Kategori & Kegiatan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:j.length>0?j.map((n,o)=>e.jsxs("tr",{onClick:()=>b(n),className:`hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer ${o%2===0?"even":"odd"}`,children:[e.jsx("td",{className:"px-6 py-3 text-sm text-slate-600 dark:text-slate-300 whitespace-nowrap",children:oe(n.date)}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex flex-col gap-1 items-start",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase ${n.type==="PEMASUKAN"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-300":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-300"}`,children:n.type}),n.subType==="REIMBURSE"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300 border border-amber-200 dark:border-amber-800",children:"REIMBURSE"}),n.subType==="NORMAL"&&n.type==="PENGELUARAN"&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600",children:"TUNAI"})]})}),e.jsxs("td",{className:"px-6 py-3 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-300",children:n.activity}),e.jsx("div",{className:"text-xs text-slate-400",children:n.category})]}),e.jsx("td",{className:"px-6 py-3 text-sm text-slate-500 dark:text-slate-400 max-w-xs truncate",children:n.desc}),e.jsx("td",{className:`px-6 py-3 text-sm font-bold text-right ${n.type==="PEMASUKAN"?"text-emerald-700 dark:text-emerald-400":"text-rose-700 dark:text-rose-400"}`,children:D(n.total)})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-slate-400 dark:text-slate-500",children:"Tidak ada data laporan yang sesuai filter"})})})]})})}),r&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm animate-fade-in no-print",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Detail Transaksi"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["ID: ",r.id]})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),b(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(ne,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 border ${r.type==="PEMASUKAN"?"bg-emerald-50 border-emerald-100 text-emerald-800":"bg-rose-50 border-rose-100 text-rose-800"}`,children:[r.type==="PEMASUKAN"?e.jsx(he,{size:24}):e.jsx(me,{size:24}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Jenis Transaksi"}),e.jsxs("p",{className:"font-bold text-lg",children:[r.type,r.subType==="REIMBURSE"?" (REIMBURSE)":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70",children:"Total"}),e.jsx("p",{className:"font-bold text-lg",children:D(r.total)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(be,{size:14})," Tanggal"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:oe(r.date)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(me,{size:14})," Kategori"]}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:r.category})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Nama Kegiatan"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:r.activity})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Keterangan"}),e.jsx("p",{className:"text-slate-800 dark:text-white bg-slate-50 dark:bg-slate-700 p-3 rounded-lg border border-slate-100 dark:border-slate-600",children:r.desc||"-"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Sumber Data"}),e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-mono bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:r.source})]})]}),r.raw&&r.raw.items&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx(le,{size:16})," Items"]}),e.jsx("div",{className:"text-sm border rounded overflow-hidden dark:border-slate-600",children:r.raw.items.map((n,o)=>e.jsxs("div",{className:"flex justify-between p-2 border-b last:border-0 dark:border-slate-600 bg-slate-50 dark:bg-slate-700/50",children:[e.jsxs("span",{children:[n.name," ",e.jsxs("span",{className:"text-slate-400",children:["x",n.qty]})]}),e.jsx("span",{className:"font-medium",children:D(n.total)})]},o))})]})]})]})}),e.jsx("div",{className:"print-footer mt-10 pt-4 border-t border-slate-400 text-right text-sm text-slate-600",children:e.jsxs("p",{children:["Dicetak / Didownload Tanggal : ",M()]})})]})},Rt=({settings:a,onUpdateSettings:p,authToken:i})=>{const[c,d]=s.useState("GENERAL"),[x,k]=s.useState(""),[S,m]=s.useState(a.database),[I,P]=s.useState([]),[y,r]=s.useState(""),[b,N]=s.useState(""),[B,j]=s.useState(!1),[A,R]=s.useState(!1),[h,E]=s.useState(!1),[M,n]=s.useState(null);s.useEffect(()=>{c==="USERS"&&i&&o()},[c,i]);const o=async()=>{if(i)try{const z=await(await fetch(`${q}/api/users`,{headers:{Authorization:`Bearer ${i}`}})).json();Array.isArray(z)&&P(z)}catch{console.error("Failed to fetch users")}},K=async w=>{w.preventDefault();const z=x.trim();if(!(!z||a.categories.includes(z))){if(i){R(!0);try{const V=await(await fetch(`${q}/api/categories`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({name:z})})).json();if(!V.success){alert(V.message||"Gagal menambahkan kategori ke server"),R(!1);return}}catch{alert("Gagal menghubungi server"),R(!1);return}R(!1)}p({...a,categories:[...a.categories,z]}),k("")}},G=async w=>{if(confirm(`Hapus kategori "${w}"?`)){if(i)try{if(!(await(await fetch(`${q}/api/categories/${encodeURIComponent(w)}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).json()).success){alert("Gagal menghapus kategori di server");return}}catch{alert("Gagal menghubungi server");return}p({...a,categories:a.categories.filter(z=>z!==w)})}},F=async w=>{if(w.preventDefault(),!(!y.trim()||!b.trim())){if(!i)return alert("Sesi habis");j(!0);try{const O=await(await fetch(`${q}/api/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({username:y,password:b})})).json();O.success?(r(""),N(""),o(),alert("User berhasil dibuat!")):alert(O.message)}catch{alert("Gagal membuat user")}finally{j(!1)}}},U=async w=>{if(confirm("Yakin ingin menghapus user ini?")){if(!i)return alert("Sesi habis");try{(await(await fetch(`${q}/api/users/${w}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}})).json()).success&&o()}catch{alert("Gagal hapus user")}}},J=async()=>{E(!0),n(null);try{const z=await(await fetch(`${q}/api/test-db`)).json();if(z.status==="success")m(O=>({...O,isConnected:!0})),n({type:"success",text:z.message}),p({...a,database:{...S,isConnected:!0}});else throw new Error(z.message)}catch(w){n({type:"error",text:w.message||"Gagal terkoneksi ke server."})}finally{E(!1)}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Pengaturan Aplikasi"}),e.jsxs("div",{className:"flex space-x-1 bg-slate-100 p-1 rounded-xl w-fit overflow-x-auto",children:[e.jsx("button",{onClick:()=>d("GENERAL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${c==="GENERAL"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Kategori"}),e.jsx("button",{onClick:()=>d("USERS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${c==="USERS"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Manajemen User"}),e.jsx("button",{onClick:()=>d("DATABASE"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${c==="DATABASE"?"bg-white text-blue-600 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Database"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[c==="GENERAL"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(me,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Kategori Kegiatan"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Kelola kategori untuk dropdown input."})]})]}),e.jsxs("form",{onSubmit:K,className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Nama Kategori Baru...",value:x,onChange:w=>k(w.target.value),className:"flex-1 rounded-lg border-slate-300 bg-slate-50 text-slate-900 border p-2.5 focus:ring-2 focus:ring-blue-500 outline-none",disabled:A}),e.jsxs("button",{type:"submit",disabled:!x.trim()||A,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[A?e.jsx(ke,{size:18,className:"animate-spin"}):e.jsx(he,{size:18})," Tambah"]})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:a.categories.map((w,z)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100 group hover:border-blue-200 transition-colors",children:[e.jsx("span",{className:"text-slate-700 font-medium",children:w}),e.jsx("button",{onClick:()=>G(w),className:"text-slate-400 hover:text-rose-500 p-1",children:e.jsx(ie,{size:16})})]},z))})]}),c==="USERS"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(De,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Manajemen User"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Tambah atau hapus akses pengguna sistem."})]})]}),e.jsxs("form",{onSubmit:F,className:"bg-slate-50 p-4 rounded-lg border border-slate-200 mb-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(gt,{size:16})," Tambah User Baru"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsx("input",{type:"text",placeholder:"Username",required:!0,value:y,onChange:w=>r(w.target.value),className:"p-2 rounded border border-slate-300 text-sm"}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,value:b,onChange:w=>N(w.target.value),className:"p-2 rounded border border-slate-300 text-sm"})]}),e.jsx("button",{disabled:B,className:"w-full bg-blue-600 text-white py-2 rounded text-sm font-medium hover:bg-blue-700 transition",children:B?"Memproses...":"Buat User"})]}),e.jsx("div",{className:"overflow-hidden border border-slate-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-100 text-slate-600 font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Username"}),e.jsx("th",{className:"p-3",children:"Role"}),e.jsx("th",{className:"p-3 text-right",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:I.map((w,z)=>e.jsxs("tr",{className:"even:bg-slate-50",children:[e.jsx("td",{className:"p-3 text-slate-800",children:w.username}),e.jsx("td",{className:"p-3 text-slate-500 uppercase text-xs font-bold",children:w.role}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>U(w.id),className:"text-rose-500 hover:text-rose-700 p-1",children:e.jsx(ie,{size:16})})})]},w.id))})]})})]}),c==="DATABASE"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(Ne,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Koneksi MySQL"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Konfigurasi database server."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-lg border border-slate-200 text-sm",children:[e.jsx("p",{className:"mb-2 font-semibold",children:"Status Koneksi:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${S.isConnected?"bg-emerald-500":"bg-rose-500"}`}),e.jsx("span",{className:"text-slate-700",children:S.isConnected?"Terhubung":"Terputus"})]})]}),M&&e.jsxs("div",{className:`p-3 rounded-lg text-sm flex items-center gap-2 ${M.type==="success"?"bg-emerald-100 text-emerald-800":"bg-rose-100 text-rose-800"}`,children:[M.type==="success"?e.jsx(ve,{size:16}):e.jsx(Ye,{size:16}),M.text]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{onClick:J,disabled:h,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white px-6 py-2.5 rounded-lg flex items-center gap-2 transition-colors font-medium",children:[h?e.jsx(ke,{size:18,className:"animate-spin"}):e.jsx(Ne,{size:18}),"Test Koneksi"]})})]})]})]})})]})},Je=({onLogin:a,isDbConnected:p=!0})=>{const[i,c]=s.useState(""),[d,x]=s.useState(""),[k,S]=s.useState(""),[m,I]=s.useState(!1),P=async r=>{if(r.preventDefault(),!!p){I(!0),S("");try{const N=await(await fetch(`${q}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,password:d})})).json();N.success&&N.token?a(N.user,N.token):S(N.message||"Login gagal")}catch{S("Gagal menghubungi server")}finally{I(!1)}}},y=()=>{window.location.reload()};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-slate-900",children:[e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("img",{src:"https://ruangdimensirecords.com/img/bg.jpg",alt:"Background",className:"w-full h-full object-cover opacity-50"}),e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-[2px]"})]}),e.jsxs("div",{className:`absolute top-4 right-4 z-10 inline-flex items-center gap-2 px-4 py-2 rounded-full text-xs font-medium border shadow-sm transition-all duration-300 ${p?"bg-white text-emerald-700 border-emerald-100":"bg-white text-rose-700 border-rose-100"}`,children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${p?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),p?"Database Terhubung":"Database Offline"]}),!p&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 text-center border-t-4 border-rose-500",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-6 text-rose-600 animate-pulse",children:e.jsx(Ne,{size:40})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Koneksi Database Terputus"}),e.jsx("p",{className:"text-slate-600 mb-8",children:"Sistem tidak dapat terhubung ke database server. Mohon periksa koneksi internet Anda atau hubungi Administrator Sistem."}),e.jsxs("button",{onClick:y,className:"px-6 py-3 rounded-xl bg-rose-600 text-white font-bold hover:bg-rose-700 shadow-lg shadow-rose-200 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(ke,{size:20})," Coba Hubungkan Ulang"]})]})}),e.jsxs("div",{className:`relative z-10 bg-white/90 backdrop-blur-md p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100 transition-all duration-300 ${p?"":"filter blur-sm pointer-events-none"}`,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"RDR Logo",className:"h-24 w-auto mx-auto mb-6 object-contain drop-shadow-md"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Selamat Datang"}),e.jsx("p",{className:"text-slate-500",children:"Sistem Informasi Keuangan RDR"})]}),k&&e.jsxs("div",{className:"mb-4 p-3 bg-rose-50 border border-rose-200 text-rose-600 text-sm rounded-lg text-center font-medium flex items-center justify-center gap-2",children:[e.jsx(re,{size:16})," ",k]}),e.jsxs("form",{onSubmit:P,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"text",value:i,onChange:r=>c(r.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan username",required:!0,disabled:!p})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1.5",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{type:"password",value:d,onChange:r=>x(r.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"Masukkan password",required:!0,disabled:!p})]})]}),e.jsx("button",{type:"submit",disabled:m||!p,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-all shadow-md hover:shadow-lg disabled:opacity-70 disabled:cursor-not-allowed",children:m?"Memproses...":"Masuk Sistem"})]}),e.jsxs("div",{className:"mt-6 text-center text-xs text-slate-400",children:["Â© ",new Date().getFullYear()," RDR Finance System"]})]})]})},Ut=({authToken:a})=>{const p=He(),[i,c]=s.useState([]),[d,x]=s.useState(!1),[k,S]=s.useState(!1),[m,I]=s.useState(!1),[P,y]=s.useState(""),[r,b]=s.useState(null),[N,B]=s.useState(null),[j,A]=s.useState(""),[R,h]=s.useState(""),[E,M]=s.useState(""),[n,o]=s.useState(""),[K,G]=s.useState(""),[F,U]=s.useState("");s.useEffect(()=>{a&&J()},[a]);const J=async()=>{b(null);try{const v=await fetch(`${q}/api/employees`,{headers:{Authorization:`Bearer ${a}`}});if(!v.ok){const _=await v.text();throw new Error(`Server Error (${v.status}): ${_.substring(0,100)}`)}const ee=await v.json();Array.isArray(ee)?c(ee):c([])}catch(v){console.error("Gagal load pegawai",v),b(v.message||"Gagal memuat data pegawai.")}},w=()=>{A(""),h(""),M(""),o(""),G(""),U(""),B(null),S(!1)},z=()=>{w(),x(!0)},O=v=>{A(v.name),h(v.position),M(v.phone),o(v.email),G(v.username),U(""),B(v.id),S(!0),x(!0)},V=async v=>{if(v.preventDefault(),!a)return;I(!0);const ee={name:j,position:R,phone:E,email:n,username:K,password:F};try{let _=`${q}/api/employees`,se="POST";k&&N&&(_=`${q}/api/employees/${N}`,se="PUT");const g=await fetch(_,{method:se,headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(ee)});if(!g.ok){const $=await g.text();try{const H=JSON.parse($);throw new Error(H.message||`Gagal menyimpan (${g.status})`)}catch{throw new Error(`Server Error: ${$.substring(0,150)}...`)}}const C=await g.json();C.success?(J(),x(!1),w(),alert(k?"Data berhasil diperbarui":"Pegawai berhasil ditambahkan")):alert(C.message||"Gagal menyimpan data.")}catch(_){console.error("Submit Error:",_),alert(_.message||"Terjadi kesalahan sistem saat menghubungi server.")}finally{I(!1)}},te=async v=>{if(confirm("Yakin ingin menghapus data pegawai ini?")&&a)try{const _=await(await fetch(`${q}/api/employees/${v}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).json();_.success?J():alert(_.message||"Gagal menghapus")}catch{alert("Gagal menghubungi server untuk menghapus.")}},X=i.filter(v=>v.name.toLowerCase().includes(P.toLowerCase())||v.position.toLowerCase().includes(P.toLowerCase()));return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Data Pegawai"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Kelola akses dan informasi pegawai."})]}),e.jsxs("button",{onClick:z,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm font-medium transition-colors",children:[e.jsx(he,{size:18})," Tambah Pegawai"]})]}),r&&e.jsxs("div",{className:"bg-rose-50 border border-rose-200 text-rose-700 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{size:20}),e.jsxs("span",{children:["Error: ",r]})]}),e.jsxs("button",{onClick:J,className:"text-sm font-bold underline hover:text-rose-900 flex items-center gap-1",children:[e.jsx(ke,{size:14})," Coba Lagi"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(jt,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Cari nama atau jabatan...",value:P,onChange:v=>y(v.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-100 transition-all"})]}),e.jsxs("div",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:["Total: ",i.length," Pegawai"]})]}),X.length===0&&!r?e.jsxs("div",{className:"text-center py-12 text-slate-400 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-200",children:[e.jsx(ae,{size:48,className:"mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Belum ada data pegawai."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:X.map(v=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md border border-slate-100 dark:border-slate-700 group hover:border-blue-200 dark:hover:border-blue-800 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg",children:v.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>p(`/notifikasi?userId=${v.id}`),className:"p-1.5 text-slate-400 hover:text-amber-500 hover:bg-slate-50 rounded",title:"Kirim Notifikasi",children:e.jsx(de,{size:16})}),e.jsx("button",{onClick:()=>O(v),className:"p-1.5 text-slate-400 hover:text-blue-600 hover:bg-slate-50 rounded",children:e.jsx(pe,{size:16})}),e.jsx("button",{onClick:()=>te(v.id),className:"p-1.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded",children:e.jsx(ie,{size:16})})]})]}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white mb-1",children:v.name}),e.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-medium text-sm mb-4 flex items-center gap-1",children:[e.jsx(ye,{size:14})," ",v.position]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400 border-t border-slate-100 dark:border-slate-700 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-slate-400"})," ",v.phone]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{size:14,className:"text-slate-400"})," ",v.email]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:14,className:"text-slate-400"})," Login: ",e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-slate-900 px-1 rounded",children:v.username})]})]})]},v.id))}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:k?"Edit Data Pegawai":"Tambah Pegawai Baru"}),e.jsx("button",{onClick:()=>x(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(ne,{size:24})})]}),e.jsxs("form",{onSubmit:V,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:j,onChange:v=>A(v.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Jabatan"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:R,onChange:v=>h(v.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"No. HP / WA"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",required:!0,value:E,onChange:v=>M(v.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"email",required:!0,value:n,onChange:v=>o(v.target.value),className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-4 mt-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:"Akses Login"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:K,onChange:v=>G(v.target.value),className:"w-full p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password ",k&&"(Opsional)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"password",required:!k,value:F,onChange:v=>U(v.target.value),placeholder:k?"Biarkan kosong jika tetap":"",className:"w-full pl-10 p-2.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg",children:"Batal"}),e.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:m?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:18})," Simpan Data"]})})]})]})]})})]})},Dt=({user:a,authToken:p,categories:i,onLogout:c,onProfileClick:d})=>{const x=He(),S=Ue().pathname.includes("/reimburse"),m=a.details,[I,P]=s.useState([]),[y,r]=s.useState([]);s.useEffect(()=>{N(),b()},[p]);const b=async()=>{if(p)try{const h=await fetch(`${q}/api/notifications`,{headers:{Authorization:`Bearer ${p}`}});if(h.ok){const E=await h.json();r(E.notifications)}}catch(h){console.error("Failed to fetch notifications",h)}},N=async()=>{if(p)try{const h=await fetch(`${q}/api/reimbursements`,{headers:{Authorization:`Bearer ${p}`}});if(h.ok){const E=await h.json();P(E)}}catch(h){console.error("Failed to fetch reimbursements",h)}},B=async h=>{try{const E=await fetch(`${q}/api/reimbursements`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(h)});if(E.ok)alert("Pengajuan berhasil disimpan"),N();else{const M=await E.json();alert("Gagal menyimpan: "+M.message)}}catch{alert("Terjadi kesalahan saat menyimpan")}},j=async h=>{try{const E=await fetch(`${q}/api/reimbursements/${h.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify(h)});if(E.ok)alert("Pengajuan berhasil diupdate"),N();else{const M=await E.json();alert("Gagal update: "+M.message)}}catch{alert("Terjadi kesalahan saat update")}},A=h=>{console.warn("Employees cannot update status")},R=h=>{console.warn("Employees cannot delete reimbursements")};return S?e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-4 shadow-md sticky top-0 z-30 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>x("/employee"),className:"p-1 hover:bg-white/20 rounded-full transition-colors",children:e.jsx(ft,{size:24})}),e.jsx("h1",{className:"text-lg font-bold",children:"Reimbursement"})]}),e.jsx("div",{className:"p-4",children:e.jsx(Ze,{reimbursements:I,onAddReimbursement:B,onUpdateReimbursement:A,onDeleteReimbursement:R,onUpdateReimbursementDetails:j,categories:i,authToken:p,isEmployeeView:!0,currentUser:a})})]}):e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans pb-20",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-6 pb-12 rounded-b-[2.5rem] shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(ye,{size:120})}),e.jsx("div",{className:"absolute top-6 left-6 z-20",children:e.jsx("img",{src:"https://ruangdimensirecords.com/img/logo.png",alt:"Logo",className:"h-8 w-auto brightness-0 invert"})}),e.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10 pt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm mb-1",children:Ve()}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Halo, ",(m==null?void 0:m.name)||a.username]}),e.jsx("p",{className:"text-blue-100 opacity-90",children:(m==null?void 0:m.position)||"Staff"})]}),e.jsx("button",{onClick:c,className:"bg-white/20 p-2 rounded-full hover:bg-white/30 backdrop-blur-sm transition-colors",children:e.jsx(Ie,{size:20})})]}),e.jsxs("div",{className:"flex gap-4 relative z-10",children:[e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1",children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"})," Aktif"]})]}),e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-xl p-3 flex-1 relative",onClick:()=>{var h;return(h=document.getElementById("info-section"))==null?void 0:h.scrollIntoView({behavior:"smooth"})},children:[e.jsx("p",{className:"text-xs text-blue-100 mb-1",children:"Notifikasi"}),e.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[e.jsx(de,{size:16})," ",y.length>0?`${y.length} Baru`:"0 Baru"]}),y.length>0&&e.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-ping"})]})]})]}),e.jsxs("div",{className:"p-6 -mt-6 relative z-10 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex items-center gap-4 cursor-pointer hover:shadow-md transition-shadow",onClick:d,children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-100 overflow-hidden border-2 border-white shadow-sm flex-shrink-0",children:a.photo_url?e.jsx("img",{src:`http://localhost:5000${a.photo_url}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-400",children:e.jsx(ae,{size:32})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"font-bold text-slate-800",children:(m==null?void 0:m.name)||a.username}),e.jsx("p",{className:"text-sm text-slate-500",children:(m==null?void 0:m.position)||"Employee"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Edit Profil & Upload Foto"})]}),e.jsx("div",{className:"bg-slate-50 p-2 rounded-full text-slate-400",children:e.jsx(ae,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>x("/employee/reimburse"),className:"bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 hover:bg-blue-50 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx(Nt,{size:24})}),e.jsx("span",{className:"font-semibold text-slate-700 group-hover:text-blue-700",children:"Reimbursement"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex flex-col items-center justify-center gap-3 opacity-50 cursor-not-allowed",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(be,{size:24})}),e.jsx("span",{className:"font-semibold text-slate-400",children:"Absensi"})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100 relative group",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ae,{size:18,className:"text-blue-600"})," Data Diri"]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:e.jsx(ye,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Jabatan"}),e.jsx("p",{className:"font-medium text-slate-800",children:(m==null?void 0:m.position)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600",children:e.jsx(Le,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telepon / WhatsApp"}),e.jsx("p",{className:"font-medium text-slate-800",children:(m==null?void 0:m.phone)||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600",children:e.jsx(Re,{size:18})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("p",{className:"font-medium text-slate-800 truncate",children:(m==null?void 0:m.email)||"-"})]})]})]})]}),e.jsxs("div",{id:"info-section",className:"bg-white p-5 rounded-2xl shadow-md border border-slate-100",children:[e.jsxs("h3",{className:"font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(de,{size:18,className:"text-amber-500"})," Pemberitahuan"]}),e.jsx("div",{className:"space-y-3",children:y.length>0?y.map((h,E)=>e.jsxs("div",{className:`p-3 rounded-xl border flex gap-3 ${h.type==="success"?"bg-emerald-50 border-emerald-100 text-emerald-800":h.type==="error"?"bg-red-50 border-red-100 text-red-800":h.type==="warning"?"bg-amber-50 border-amber-100 text-amber-800":"bg-blue-50 border-blue-100 text-blue-800"}`,children:[e.jsx("div",{className:`mt-0.5 p-1.5 rounded-full shrink-0 ${h.type==="success"?"bg-emerald-100 text-emerald-600":h.type==="error"?"bg-red-100 text-red-600":h.type==="warning"?"bg-amber-100 text-amber-600":"bg-blue-100 text-blue-600"}`,children:h.type==="success"?e.jsx(le,{size:14}):h.type==="error"?e.jsx(Ie,{size:14}):e.jsx(de,{size:14})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:h.message}),h.timestamp&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:new Date(h.timestamp).toLocaleString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]})]},E)):e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl text-center text-slate-500 text-sm",children:[e.jsx(be,{size:32,className:"mx-auto mb-2 text-slate-300"}),e.jsx("p",{children:"Belum ada pemberitahuan baru."})]})})]})]})]})},$t=({user:a,isOpen:p,onClose:i,onUpdateProfile:c})=>{const[d,x]=s.useState(""),[k,S]=s.useState(""),[m,I]=s.useState(""),[P,y]=s.useState(!1),[r,b]=s.useState(!1),[N,B]=s.useState(""),[j,A]=s.useState(!1);if(s.useEffect(()=>{var E;if(p&&a){const M=a.role==="employee"?(E=a.details)==null?void 0:E.name:a.full_name||"";x(M||""),S(""),I(""),B(a.photo_url||"")}},[p,a]),!p)return null;const R=async E=>{var o;const M=(o=E.target.files)==null?void 0:o[0];if(!M)return;const n=new FormData;n.append("file",M),A(!0);try{const G=await(await fetch(`${q}/api/upload`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("rdr_token")}`},body:n})).json();G.status==="success"?B(G.url):alert("Gagal upload foto: "+G.message)}catch(K){console.error("Upload error:",K),alert("Gagal upload foto")}finally{A(!1)}},h=async E=>{if(E.preventDefault(),k&&k!==m){alert("Konfirmasi password tidak sesuai");return}b(!0);try{await c(d,k,N),i()}catch(M){console.error(M)}finally{b(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md overflow-hidden border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{size:24,className:"text-blue-600"})," Edit Profil"]}),e.jsx("button",{onClick:i,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(ne,{size:24})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsxs("div",{className:"w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center overflow-hidden mb-2 relative group",children:[N?e.jsx("img",{src:`${q}${N}`,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(ae,{size:40,className:"text-slate-400"}),e.jsxs("label",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity",children:[e.jsx("span",{className:"text-white text-xs",children:"Ubah Foto"}),e.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"hidden"})]})]}),j&&e.jsx("p",{className:"text-xs text-blue-500",children:"Mengupload..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a.username,disabled:!0,className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 dark:text-slate-400 cursor-not-allowed"}),e.jsx(je,{size:16,className:"absolute left-3 top-3 text-slate-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Role"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a.role.toUpperCase(),disabled:!0,className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-500 dark:text-slate-400 cursor-not-allowed"}),e.jsx(je,{size:16,className:"absolute left-3 top-3 text-slate-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nama Lengkap"}),e.jsx("input",{type:"text",required:!0,value:d,onChange:E=>x(E.target.value),className:"w-full p-2.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-colors",placeholder:"Masukkan nama lengkap"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["Password Baru ",e.jsx("span",{className:"text-slate-400 font-normal text-xs",children:"(Kosongkan jika tidak diubah)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:P?"text":"password",value:k,onChange:E=>S(E.target.value),className:"w-full p-2.5 pr-10 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-colors",placeholder:"******"}),e.jsx("button",{type:"button",onClick:()=>y(!P),className:"absolute right-3 top-3 text-slate-400 hover:text-slate-600",children:P?e.jsx(vt,{size:18}):e.jsx(We,{size:18})})]})]}),k&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Konfirmasi Password"}),e.jsx("input",{type:"password",value:m,onChange:E=>I(E.target.value),className:`w-full p-2.5 bg-white dark:bg-slate-800 border rounded-lg text-slate-900 dark:text-white focus:ring-2 outline-none transition-colors ${k===m?"border-emerald-500 focus:ring-emerald-500":"border-rose-500 focus:ring-rose-500"}`,placeholder:"Ulangi password baru"}),m&&k!==m&&e.jsx("p",{className:"text-xs text-rose-500 mt-1",children:"Password tidak cocok"})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",disabled:r||k!==""&&k!==m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-sm disabled:opacity-70 disabled:cursor-not-allowed transition-colors",children:r?"Menyimpan...":e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:18})," Simpan Perubahan"]})})]})]})]})})},Mt=({authToken:a})=>{const[p,i]=s.useState([]),[c,d]=s.useState("all"),[x,k]=s.useState(""),[S,m]=s.useState("info"),[I,P]=s.useState(!1),[y,r]=s.useState(null),b=Ue();s.useEffect(()=>{const A=new URLSearchParams(b.search).get("userId");A&&d(A)},[b]),s.useEffect(()=>{N()},[a]);const N=async()=>{if(a)try{const j=await fetch(`${q}/api/employees`,{headers:{Authorization:`Bearer ${a}`}});if(j.ok){const A=await j.json();i(A)}}catch(j){console.error("Failed to fetch employees",j)}},B=async j=>{if(j.preventDefault(),P(!0),r(null),!x.trim()){r({type:"error",message:"Pesan tidak boleh kosong"}),P(!1);return}try{const A={userId:c==="all"?null:parseInt(c),message:x,type:S},R=await fetch(`${q}/api/notifications`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(A)}),h=await R.json();R.ok?(r({type:"success",message:"Notifikasi berhasil dikirim!"}),k(""),d("all"),m("info")):r({type:"error",message:h.message||"Gagal mengirim notifikasi"})}catch{r({type:"error",message:"Terjadi kesalahan jaringan"})}finally{P(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-blue-600 rounded-xl text-white shadow-lg shadow-blue-200",children:e.jsx(de,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Manajemen Notifikasi"}),e.jsx("p",{className:"text-slate-500",children:"Kirim pemberitahuan ke pegawai"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-slate-100",children:[e.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(Ge,{size:20,className:"text-blue-600"})," Buat Pesan Baru"]}),y&&e.jsxs("div",{className:`p-4 rounded-xl mb-6 flex items-center gap-3 ${y.type==="success"?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-red-50 text-red-700 border border-red-100"}`,children:[y.type==="success"?e.jsx(ve,{size:20}):e.jsx(re,{size:20}),y.message]}),e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tujuan Penerima"}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsxs("select",{value:c,onChange:j=>d(j.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",children:[e.jsx("option",{value:"all",children:"Semua Pegawai (Broadcast)"}),e.jsx("optgroup",{label:"Pilih Pegawai Tertentu",children:p.map(j=>e.jsxs("option",{value:j.id,children:[j.name," - ",j.position]},j.id))})]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1 ml-1",children:c==="all"?"Pesan akan dikirim ke seluruh pegawai aktif.":"Pesan hanya akan dikirim ke pegawai yang dipilih."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Jenis Notifikasi"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>m("info"),className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${S==="info"?"bg-blue-50 border-blue-200 text-blue-700 ring-1 ring-blue-500":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[e.jsx(Fe,{size:18})," Info"]}),e.jsxs("button",{type:"button",onClick:()=>m("success"),className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${S==="success"?"bg-emerald-50 border-emerald-200 text-emerald-700 ring-1 ring-emerald-500":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[e.jsx(ve,{size:18})," Sukses"]}),e.jsxs("button",{type:"button",onClick:()=>m("warning"),className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${S==="warning"?"bg-amber-50 border-amber-200 text-amber-700 ring-1 ring-amber-500":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[e.jsx(re,{size:18})," Peringatan"]}),e.jsxs("button",{type:"button",onClick:()=>m("error"),className:`flex items-center justify-center gap-2 p-3 rounded-xl border transition-all ${S==="error"?"bg-red-50 border-red-200 text-red-700 ring-1 ring-red-500":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[e.jsx(re,{size:18})," Penting"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Isi Pesan"}),e.jsx("textarea",{value:x,onChange:j=>k(j.target.value),placeholder:"Tulis pesan pemberitahuan di sini...",rows:4,className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{type:"submit",disabled:I,className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-200 transition-all active:scale-95 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2",children:I?"Mengirim...":e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:18})," Kirim Notifikasi"]})})})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 text-white shadow-lg",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(Fe,{size:18,className:"text-blue-400"})," Preview Tampilan"]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Dashboard Pegawai"}),e.jsxs("div",{className:"p-3 rounded-lg flex items-start gap-3 bg-white text-slate-800 shadow-sm",children:[e.jsx("div",{className:`p-2 rounded-full shrink-0 ${S==="info"?"bg-blue-100 text-blue-600":S==="success"?"bg-emerald-100 text-emerald-600":S==="warning"?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:e.jsx(de,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:x||"Contoh pesan notifikasi..."}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Baru saja"})]})]})]}),e.jsx("div",{className:"mt-4 text-sm text-slate-300",children:e.jsx("p",{children:"Notifikasi ini akan muncul di dashboard pegawai yang dipilih."})})]})})]})]})},Bt=()=>{const[a,p]=s.useState(!1),[i,c]=s.useState(null),[d,x]=s.useState(null),[k,S]=s.useState(!1),[m,I]=s.useState(!1),[P,y]=s.useState(!0),[r,b]=s.useState(!1);s.useEffect(()=>{const g=localStorage.getItem("rdr_user"),C=localStorage.getItem("rdr_token");g&&C&&(c(JSON.parse(g)),x(C),p(!0))},[]);const N=async()=>{try{const $=(await(await fetch(`${q}/api/test-db`)).json()).status==="success";return y($),$}catch{return y(!1),!1}};s.useEffect(()=>{N();const g=setInterval(async()=>{!await N()&&a&&j()},3e4);return()=>clearInterval(g)},[a]);const B=(g,C)=>{c(g),x(C),p(!0),localStorage.setItem("rdr_user",JSON.stringify(g)),localStorage.setItem("rdr_token",C)},j=()=>{localStorage.removeItem("rdr_user"),localStorage.removeItem("rdr_token"),p(!1),c(null),x(null),S(!1)},A=async(g,C,$)=>{const H=await R("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:g,password:C,photoUrl:$})});if(H&&H.ok){const Z=await H.json();Z.user&&(c(Z.user),localStorage.setItem("rdr_user",JSON.stringify(Z.user))),alert("Profil berhasil diperbarui!")}else alert("Gagal memperbarui profil.")},R=async(g,C={})=>{if(!d)return null;const $={...C.headers,Authorization:`Bearer ${d}`};try{const H=g.startsWith("/api")?`${q}${g}`:g,Z=await fetch(H,{...C,headers:$});return Z.status===401||Z.status===403?(j(),null):Z}catch(H){return console.error("Fetch Error:",H),null}},[h,E]=s.useState({categories:[],database:{host:"",user:"",password:"",name:"",port:"3306",isConnected:!1}}),M=g=>E(g),[n,o]=s.useState([]),[K,G]=s.useState([]),F=async g=>{const C=await R(g);if(!C)return null;const $=await C.text();try{return JSON.parse($)}catch{return null}};s.useEffect(()=>{a&&P&&d&&(i==null?void 0:i.role)!=="employee"&&(async()=>{const C=await F("/api/transactions");Array.isArray(C)&&o(C);const $=await F("/api/reimbursements");Array.isArray($)&&G($);const H=await F("/api/categories");await F("/api/settings"),E(Z=>({...Z,categories:Array.isArray(H)?H:[],database:{...Z.database,isConnected:!0}}))})()},[a,P,d,i]);const U=async g=>{o(C=>[g,...C]),await R("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},J=async g=>{o(C=>C.filter($=>$.id!==g)),await R(`/api/transactions/${g}`,{method:"DELETE"})},w=async g=>{o(C=>C.map($=>$.id===g.id?g:$)),await R(`/api/transactions/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},z=async g=>{G(C=>[g,...C]),await R("/api/reimbursements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},O=async g=>{G(C=>C.filter($=>$.id!==g)),await R(`/api/reimbursements/${g}`,{method:"DELETE"})},V=async g=>{G(C=>C.map($=>$.id===g.id?g:$)),await R(`/api/reimbursements/${g.id}/details`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})},te=async g=>{G(C=>C.map($=>$.id===g.id?g:$)),await R(`/api/reimbursements/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:g.status,rejectionReason:g.rejectionReason})})},X={authToken:d},v=()=>e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 text-slate-900 font-sans",children:[e.jsx(It,{user:i,onLogoutClick:()=>S(!0),toggleSidebar:()=>b(!r),isDbConnected:P,onProfileClick:()=>I(!0)}),e.jsxs("div",{className:"flex flex-1 pt-16 overflow-hidden",children:[e.jsx(Lt,{isOpen:r,setIsOpen:b}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8 scrollbar-thin",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(at,{})})}),e.jsx("div",{className:"shrink-0 z-20",children:e.jsx(Tt,{})})]})]}),e.jsx(_,{})]}),ee=()=>e.jsxs(e.Fragment,{children:[e.jsx(Dt,{user:i,authToken:d,categories:h.categories,onLogout:()=>S(!0),onProfileClick:()=>I(!0)}),e.jsx(_,{})]}),_=()=>e.jsxs(e.Fragment,{children:[k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-600",children:e.jsx(kt,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Konfirmasi Keluar"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Apakah Anda yakin ingin keluar dari sistem?"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-5 py-2.5 rounded-xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50 transition-colors",children:"Batal"}),e.jsx("button",{onClick:j,className:"px-5 py-2.5 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700 shadow-md shadow-rose-200 transition-colors",children:"Ya, Keluar"})]})]})}),i&&e.jsx($t,{user:i,isOpen:m,onClose:()=>I(!1),onUpdateProfile:A})]});if(!a)return e.jsx(Me,{children:e.jsx(Be,{children:e.jsx(W,{path:"*",element:e.jsx(Je,{onLogin:B,isDbConnected:P})})})});const se=()=>(i==null?void 0:i.role)==="employee"?e.jsx(Ae,{to:"/employee",replace:!0}):e.jsx(Ae,{to:"/dashboard",replace:!0});return e.jsx(Me,{children:e.jsxs(Be,{children:[e.jsx(W,{path:"/login",element:a?e.jsx(Ae,{to:"/"}):e.jsx(Je,{onLogin:B,isDbConnected:P})}),(i==null?void 0:i.role)==="employee"&&e.jsx(W,{path:"/employee/*",element:e.jsx(ee,{})}),(i==null?void 0:i.role)!=="employee"&&e.jsxs(W,{element:e.jsx(v,{}),children:[e.jsx(W,{path:"/dashboard",element:e.jsx(Ce,{transactions:n,reimbursements:K,isDarkMode:!1,filterType:"ALL"})}),e.jsx(W,{path:"/jurnal",element:e.jsx(ze,{onAddTransaction:U,onDeleteTransaction:J,onUpdateTransaction:w,transactions:n,defaultType:"PENGELUARAN",initialView:"LIST",categories:h.categories,...X})}),e.jsx(W,{path:"/laporan",element:e.jsx(qe,{transactions:n,reimbursements:K,categories:h.categories})}),e.jsx(W,{path:"/pengeluaran/dashboard",element:e.jsx(Ce,{transactions:n,reimbursements:K,isDarkMode:!1,filterType:"EXPENSE"})}),e.jsx(W,{path:"/pengeluaran/tambah",element:e.jsx(ze,{onAddTransaction:U,onDeleteTransaction:J,onUpdateTransaction:w,transactions:n,defaultType:"PENGELUARAN",filterType:"PENGELUARAN",initialView:"LIST",categories:h.categories,...X})}),e.jsx(W,{path:"/reimburse",element:e.jsx(Ze,{reimbursements:K,onAddReimbursement:z,onDeleteReimbursement:O,onUpdateReimbursementDetails:V,onUpdateReimbursement:te,categories:h.categories,...X})}),e.jsx(W,{path:"/pengeluaran/laporan",element:e.jsx(qe,{transactions:n,reimbursements:K,fixedFilterType:"PENGELUARAN",categories:h.categories})}),e.jsx(W,{path:"/pemasukan/tambah",element:e.jsx(ze,{onAddTransaction:U,onDeleteTransaction:J,onUpdateTransaction:w,transactions:n,defaultType:"PEMASUKAN",filterType:"PEMASUKAN",initialView:"LIST",categories:h.categories,...X})}),e.jsx(W,{path:"/pemasukan/statistik",element:e.jsx(Ce,{transactions:n,reimbursements:K,isDarkMode:!1,filterType:"INCOME"})}),e.jsx(W,{path:"/pegawai",element:e.jsx(Ut,{...X})}),e.jsx(W,{path:"/notifikasi",element:e.jsx(Mt,{...X})}),e.jsx(W,{path:"/pengaturan",element:e.jsx(Rt,{settings:h,onUpdateSettings:M,...X})})]}),e.jsx(W,{path:"*",element:e.jsx(se,{})})]})})},et=document.getElementById("root");if(!et)throw new Error("Could not find root element to mount to");const Kt=lt.createRoot(et);Kt.render(e.jsx(rt.StrictMode,{children:e.jsx(Bt,{})}));
